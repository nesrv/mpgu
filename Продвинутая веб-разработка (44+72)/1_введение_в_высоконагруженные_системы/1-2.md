## Практическая часть (2 часа)

### Практическое задание 1: Анализ архитектуры популярных сервисов (45 мин)

**Задача:** Проанализировать архитектуру 3 популярных веб-сервисов

**Сервисы для анализа:**

1. **Rutube** - видеохостинг
2. **ВКонтакте** - социальная сеть
3. **Яндекс.Такси** - сервис такси

**Шаблон анализа для каждого сервиса:**

```markdown
## Анализ архитектуры [Название сервиса]

### Основные характеристики нагрузки:
- Количество пользователей: 
- RPS (примерно):
- Тип данных:
- Географическое распределение:

### Архитектурные компоненты:
- Frontend:
- Backend:
- Базы данных:
- Кэширование:
- CDN:
- Load Balancers:

### Особенности масштабирования:
- Горизонтальное масштабирование:
- Микросервисы:
- Кэширование:
- Репликация данных:

### Потенциальные узкие места:
1.
2.
3.

### Решения для высокой нагрузки:
1.
2.
3.
```

### Практическое задание 2: Измерение производительности веб-сайта (30 мин)

**Инструменты:**

- Chrome DevTools
- GTmetrix (gtmetrix.com)
- PageSpeed Insights (pagespeed.web.dev)

**Задача:** Измерить метрики производительности 5 различных сайтов

**Популярные российские сайты для тестирования:**

1. yandex.ru - поисковая система
2. vk.com - социальная сеть
3. mail.ru - почтовый сервис и портал
4. avito.ru - доска объявлений
5. ozon.ru - интернет-магазин

**Подробная таблица результатов с пояснениями:**

| Сайт  | Load Time (ms) | First Paint (ms) | DOM Ready (ms) | Page Size (MB) | Requests Count | LCP (ms) | CLS | FID (ms) |
| --------- | -------------- | ---------------- | -------------- | -------------- | -------------- | -------- | --- | -------- |
| yandex.ru |                |                  |                |                |                |          |     |          |
| vk.com    |                |                  |                |                |                |          |     |          |
| mail.ru   |                |                  |                |                |                |          |     |          |
| avito.ru  |                |                  |                |                |                |          |     |          |
| ozon.ru   |                |                  |                |                |                |          |     |          |

**Пояснения к метрикам:**

- **Load Time** - полное время загрузки страницы
- **First Paint** - время до первого отображения контента
- **DOM Ready** - время готовности DOM для взаимодействия
- **Page Size** - общий размер загруженных ресурсов
- **Requests Count** - количество HTTP-запросов
- **LCP** (Largest Contentful Paint) - время загрузки основного контента
- **CLS** (Cumulative Layout Shift) - стабильность макета (0-1)
- **FID** (First Input Delay) - время отклика на первое взаимодействие

### Практическое задание 3: Создание простого нагрузочного теста (45 мин)

**Инструмент:** Apache Bench (ab) или curl

**Задача:** Протестировать производительность простого веб-сервера

**Шаг 1:** Создать простой HTTP сервер

```javascript
// server.js
const http = require('http');

const server = http.createServer((req, res) => {
  // Имитация обработки данных
  const delay = Math.random() * 100;
  
  setTimeout(() => {
    res.writeHead(200, {'Content-Type': 'application/json'});
    res.end(JSON.stringify({
      message: 'Hello World',
      timestamp: new Date().toISOString(),
      delay: delay
    }));
  }, delay);
});

server.listen(3000, () => {
  console.log('Server running on port 3000');
});
```

**Шаг 2:** Запустить сервер

```bash
node server.js
```

**Шаг 3:** Провести нагрузочное тестирование

```bash
# Тест 1: 100 запросов, 10 одновременных
ab -n 100 -c 10 http://localhost:3000/

# Тест 2: 1000 запросов, 50 одновременных  
ab -n 1000 -c 50 http://localhost:3000/

# Тест 3: 1000 запросов, 100 одновременных
ab -n 1000 -c 100 http://localhost:3000/
```

**Шаг 4:** Заполнить таблицу результатов

| Тест | Requests | Concurrency | RPS | Avg Response Time (ms) | Failed Requests |
| -------- | -------- | ----------- | --- | ---------------------- | --------------- |
| 1        | 100      | 10          |     |                        |                 |
| 2        | 1000     | 50          |     |                        |                 |
| 3        | 1000     | 100         |     |                        |                 |

**Вопросы для анализа:**

1. Как изменяется RPS при увеличении concurrency?
2. Какой уровень concurrency показал лучший результат?
3. При каком уровне нагрузки начинают появляться ошибки?

---

## Решения практических заданий

### Решение задания 1: Анализ архитектуры

**Как найти информацию для анализа:**

**Основные характеристики нагрузки:**

- **Количество пользователей:** ищите в отчетах компании, новостях, Similarweb.com
- **RPS:** оценивайте по формуле: DAU × среднее кол-во действий / 86400 сек
- **Тип данных:** анализируйте основной контент сайта
- **География:** смотрите в описании компании, языки сайта

**Архитектурные компоненты:**

- **Frontend:** используйте DevTools браузера, смотрите вкладку Sources
- **Backend:** читайте технические блоги компаний, вакансии
- **Базы данных:** информация из докладов на конференциях
- **CDN:** проверяйте через nslookup, смотрите Network вкладку

**Особенности масштабирования:**

- **Микросервисы:** анализируйте API endpoints, разные поддомены
- **Кэширование:** смотрите HTTP заголовки Cache-Control, ETag
- **Репликация:** информация из технических докладов

**Полезные ресурсы:**

- Технические блоги: habr.com, medium.com
- Конференции: HighLoad++, Яндекс.Субботник
- Вакансии на hh.ru - часто указывают технологии
- GitHub репозитории компаний

#### Пример анализа: Rutube - видеохостинг

**Основные характеристики нагрузки:**

- Количество пользователей: ~30 млн в месяц
- RPS (примерно): 10,000-50,000
- Тип данных: видеофайлы, метаданные, комментарии
- Географическое распределение: Россия, СНГ

**Архитектурные компоненты:**

- Frontend: React/Vue.js SPA
- Backend: микросервисы на Java/Python
- Базы данных: PostgreSQL (метаданные), MongoDB (логи)
- Кэширование: Redis, Memcached
- CDN: собственная CDN сеть
- Load Balancers: Nginx, HAProxy

**Особенности масштабирования:**

- Горизонтальное масштабирование: кластеры серверов
- Микросервисы: отдельные сервисы для загрузки, обработки, стриминга
- Кэширование: многоуровневое (браузер, CDN, приложение)
- Репликация данных: master-slave репликация БД

#### ВКонтакте - социальная сеть

**Основные характеристики нагрузки:**

- Количество пользователей: >100 млн активных
- RPS (примерно): 100,000+
- Тип данных: посты, сообщения, медиа, профили
- Географическое распределение: глобальная

**Архитектурные компоненты:**

- Frontend: собственный фреймворк VKUI
- Backend: C++, PHP, Python микросервисы
- Базы данных: MySQL кластеры, Tarantool
- Кэширование: многоуровневое с Redis
- CDN: глобальная CDN сеть
- Load Balancers: собственные решения

#### Яндекс.Такси - сервис такси

**Основные характеристики нагрузки:**

- Количество пользователей: ~20 млн в месяц
- RPS (примерно): 50,000-100,000
- Тип данных: заказы, геолокация, маршруты
- Географическое распределение: Россия, СНГ, международные рынки

**Архитектурные компоненты:**

- Frontend: React Native мобильные приложения
- Backend: Go, Python микросервисы
- Базы данных: ClickHouse (аналитика), PostgreSQL
- Кэширование: Redis для сессий и геоданных
- CDN: Яндекс.Облако CDN
- Load Balancers: собственные балансировщики

### Решение задания 2: Примерные результаты тестирования

**Как получить эти метрики:**

**Chrome DevTools:**

1. Откройте сайт в Chrome
2. F12 → Network вкладка
3. Обновите страницу (Ctrl+F5)
4. Посмотрите внизу: Requests, Size, Load Time
5. Lighthouse вкладка → Generate report → получите LCP, CLS, FID

**PageSpeed Insights:**

1. Перейдите на pagespeed.web.dev
2. Введите URL сайта
3. Нажмите "Анализировать"
4. Получите все Core Web Vitals метрики

**GTmetrix:**

1. Регистрация на gtmetrix.com
2. Ввод URL и запуск теста
3. Получение детального отчета

| Сайт  | Load Time (ms) | First Paint (ms) | DOM Ready (ms) | Page Size (MB) | Requests Count | LCP (ms) | CLS  | FID (ms) |
| --------- | -------------- | ---------------- | -------------- | -------------- | -------------- | -------- | ---- | -------- |
| yandex.ru | 850            | 320              | 650            | 1.2            | 45             | 580      | 0.05 | 12       |
| vk.com    | 1200           | 450              | 900            | 2.8            | 78             | 720      | 0.12 | 18       |
| mail.ru   | 1100           | 380              | 850            | 2.1            | 62             | 650      | 0.08 | 15       |
| avito.ru  | 1400           | 520              | 1100           | 3.2            | 89             | 890      | 0.15 | 22       |
| ozon.ru   | 1600           | 600              | 1200           | 4.1            | 112            | 980      | 0.18 | 28       |

**Анализ результатов:**

- **yandex.ru** показывает лучшие результаты благодаря оптимизации поисковой страницы
- **vk.com** имеет средние показатели для социальной сети с большим количеством контента
- **ozon.ru** показывает худшие результаты из-за сложности e-commerce страниц

### Решение задания 3: Примерные результаты нагрузочного тестирования

**Как читать результаты Apache Bench:**

**Пример вывода ab:**

```
Requests per second: 420.15 [#/sec] (mean)
Time per request: 119.04 [ms] (mean)
Time per request: 2.38 [ms] (mean, across all concurrent requests)
Failed requests: 0
```

**Объяснение параметров:**

- **Requests per second** = RPS (запросов в секунду)
- **Time per request (mean)** = среднее время ответа
- **Failed requests** = количество ошибок

**Как анализировать:**

- Если RPS растет при увеличении concurrency - хорошо
- Если RPS падает - достигнут предел
- Если появляются Failed requests - система перегружена

| Тест | Requests | Concurrency | RPS | Avg Response Time (ms) | Failed Requests |
| -------- | -------- | ----------- | --- | ---------------------- | --------------- |
| 1        | 100      | 10          | 85  | 118                    | 0               |
| 2        | 1000     | 50          | 420 | 119                    | 0               |
| 3        | 1000     | 100         | 380 | 263                    | 5               |

**Анализ результатов:**

1. **RPS увеличивается до определенного предела** - максимум достигнут при concurrency=50
2. **Лучший результат при concurrency=50** - оптимальный баланс между нагрузкой и производительностью
3. **При concurrency=100 появляются ошибки** - система начинает перегружаться, время ответа растет

**Выводы:**

- Простой Node.js сервер эффективно работает до 50 одновременных соединений
- При превышении лимита начинают появляться таймауты и ошибки
- Для повышения производительности нужно оптимизировать код или масштабировать горизонтально

---

## Домашнее задание

1. **Исследование:** Найти информацию об архитектуре одного крупного российского интернет-сервиса (Яндекс, Mail.ru, Ozon, Wildberries)
2. **Практика:** Установить и настроить инструмент мониторинга производительности (например, New Relic free tier или Google Analytics)
3. **Подготовка:** Изучить основы работы с Docker для следующего занятия

## Критерии оценки

**Отлично (5):**

- Выполнены все практические задания
- Правильно интерпретированы результаты тестов
- Даны развернутые ответы на вопросы анализа

**Хорошо (4):**

- Выполнено 2 из 3 практических заданий
- Результаты тестов интерпретированы с незначительными ошибками

**Удовлетворительно (3):**

- Выполнено 1 из 3 практических заданий
- Показано понимание основных концепций

## Материалы для изучения

**Обязательные:**

- High Performance Web Sites (Steve Souders) - Chapter 1
- Designing Data-Intensive Applications (Martin Kleppmann) - Chapter 1

**Дополнительные:**

- highscalability.com - архитектуры известных систем
- Блог Netflix Tech Blog
- AWS Architecture Center
