<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SQL ORM SQLAlchemy</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,sans-serif;background:#1a1a1a;overflow:hidden}
.reveal{width:100%;height:100vh;position:relative}
.slides{width:100%;height:100%;position:relative}
section{display:none;position:absolute;width:100%;height:100%;padding:40px;color:#fff;overflow-y:auto}
section.present{display:flex;flex-direction:column;justify-content:center;align-items:center;animation:fadeIn .5s}
section>*{max-width:1200px;width:100%}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
h1{font-size:3.5em;margin-bottom:40px;color:#4A90E2;text-align:center}
h2{font-size:2.8em;margin:0 0 30px;color:#4A90E2;text-align:center}
h3{font-size:2em;margin:25px 0 15px;color:#64B5F6}
.fragment{opacity:0;transition:opacity .5s}
.fragment.visible{opacity:1}
p,li{font-size:1.4em;line-height:1.8;margin:10px 0}
ul{margin-left:30px}
pre{background:#2d2d2d;padding:20px;border-radius:8px;overflow-x:auto;margin:15px 0;border-left:4px solid #4A90E2}
code{font-family:'Courier New',monospace;font-size:1.1em;color:#f8f8f2}
code .k{color:#ff79c6}
code .s{color:#f1fa8c}
code .c{color:#50fa7b}
code .n{color:#8be9fd}
.navigation{position:fixed;bottom:20px;left:20px;display:flex;gap:8px;z-index:100;overflow-x:auto;max-width:calc(100vw - 40px)}
.nav-dot{width:32px;height:32px;background:rgba(74,144,226,.3);border:2px solid #4A90E2;border-radius:5px;color:#fff;font-size:12px;cursor:pointer;transition:.3s;display:flex;align-items:center;justify-content:center;font-weight:bold}
.nav-dot:hover{background:rgba(74,144,226,.6);transform:scale(1.1)}
.nav-dot.active{background:#4A90E2;box-shadow:0 0 10px #4A90E2}
.highlight{color:#ffd700}
.check{color:#4caf50}
.cross{color:#f44336}
</style>

</head>
<body>
<div class="reveal">
<div class="slides">

<section class="present">
<h1>üêç SQL ORM SQLAlchemy üóÑÔ∏è</h1>
<p style="font-size:1.3em;margin-top:30px">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö<br>(–∏–ª–∏ –∫–∞–∫ –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –ø–∏—Å–∞—Ç—å SQL —Ä—É–∫–∞–º–∏ üòÖ)</p>
</section>

<section>
<h2>üìö –£—á–µ–±–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–Ω—è—Ç–∏—è</h2>
<div class="fragment"><h3>üéØ –£—á–µ–±–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã:</h3>
<ul>
<li>üî∞ –û—Å–Ω–æ–≤—ã —Ä–∞–±–æ—Ç—ã —Å SQLAlchemy ORM</li>
<li>‚ö° –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î</li>
<li>‚úèÔ∏è CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ (Create, Read, Update, Delete)</li>
<li>üîó –û—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏</li>
<li>üöÄ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ SQL –æ–ø–µ—Ä–∞—Ü–∏–∏</li>
</ul></div>
<div class="fragment"><h3>üó∫Ô∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–Ω—è—Ç–∏—è:</h3>
<ul>
<li>üëã –í–≤–µ–¥–µ–Ω–∏–µ –≤ SQLAlchemy (–ø–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã)</li>
<li>üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (sync/async)</li>
<li>üèóÔ∏è –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü</li>
<li>‚úèÔ∏è CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏</li>
<li>ü§ù –û—Ç–Ω–æ—à–µ–Ω–∏—è: –æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º, –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º</li>
<li>üéì –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: MERGE, UNION, JOIN, JSON</li>
</ul></div>
</section>

<section>
<h2>‚öñÔ∏è –ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã SQLAlchemy</h2>
<div class="fragment"><h3><span class="check">‚úÖ</span> –ü–ª—é—Å—ã (–ø–æ—á–µ–º—É –º—ã –µ–≥–æ –ª—é–±–∏–º üíö):</h3>
<ul>
<li>üîÑ –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –°–£–ë–î (PostgreSQL, MySQL, SQLite - –≤—Å—ë —Ä–∞–≤–Ω–æ!)</li>
<li>üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–∑–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π - Bobby Tables –Ω–µ –ø—Ä–æ–π–¥—ë—Ç!)</li>
<li>üêç –£–¥–æ–±–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ Python (–ø–∏—à–µ–º –∫–æ–¥, –∞ –Ω–µ SQL)</li>
<li>ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è SQL (–º–∞–≥–∏—è!)</li>
<li>üì¶ –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã</li>
<li>üîó –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏</li>
</ul></div>
<div class="fragment"><h3><span class="cross">‚ùå</span> –ú–∏–Ω—É—Å—ã (–∑–∞ –≤—Å—ë –Ω–∞–¥–æ –ø–ª–∞—Ç–∏—Ç—å üí∏):</h3>
<ul>
<li>üêå –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∏–∂–µ —á–∏—Å—Ç–æ–≥–æ SQL (–Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)</li>
<li>üìö –°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–∑—É—á–µ–Ω–∏—è (–∫—Ä–∏–≤–∞—è –æ–±—É—á–µ–Ω–∏—è –∫–∞–∫ —É React)</li>
<li>üéí Overhead –ø—Ä–∏ –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö (–∑–∞—á–µ–º ORM –¥–ª—è SELECT *?)</li>
<li>üîç –°–ª–æ–∂–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (—á—Ç–æ —Ç—ã —Ç–∞–º –Ω–∞–∫–æ–ª–¥–æ–≤–∞–ª?)</li>
<li>üöß –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö –°–£–ë–î</li>
</ul></div>
</section>

<section>
<h2>üîå –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h2>
<div class="fragment"><h3>–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:</h3>
<pre><code><span class="k">from</span> sqlalchemy <span class="k">import</span> create_engine
<span class="k">from</span> sqlalchemy.orm <span class="k">import</span> sessionmaker

engine = create_engine(<span class="s">'postgresql://user:pass@localhost/db'</span>)
<span class="n">Session</span> = sessionmaker(bind=engine)
session = <span class="n">Session</span>()</code></pre></div>
<div class="fragment"><h3>–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:</h3>
<pre><code><span class="k">from</span> sqlalchemy.ext.asyncio <span class="k">import</span> create_async_engine, <span class="n">AsyncSession</span>
<span class="k">from</span> sqlalchemy.orm <span class="k">import</span> sessionmaker

engine = create_async_engine(<span class="s">'postgresql+asyncpg://user:pass@localhost/db'</span>)
async_session = sessionmaker(engine, class_=<span class="n">AsyncSession</span>, 
                             expire_on_commit=<span class="k">False</span>)

<span class="k">async with</span> async_session() <span class="k">as</span> session:
    <span class="k">pass</span></code></pre></div>
</section>

<section>
<h2>‚ö° –ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã</h2>
<div class="fragment"><h3>üê¢ –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (—Å—Ç–∞—Ä–∞—è –¥–æ–±—Ä–∞—è –∫–ª–∞—Å—Å–∏–∫–∞):</h3>
<p><span class="check">‚úÖ</span> –ü—Ä–æ—Å—Ç–æ—Ç–∞, –ø–æ–Ω—è—Ç–Ω–æ—Å—Ç—å, –ª–µ–≥–∫–∞—è –æ—Ç–ª–∞–¥–∫–∞, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</p>
<p><span class="cross">‚ùå</span> –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–∞, –Ω–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ I/O (–∂–¥—ë–º-—Å...)</p></div>
<div class="fragment"><h3>üöÄ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (–¥–ª—è –∫—Ä—É—Ç—ã—Ö –ø–∞—Ä–Ω–µ–π):</h3>
<p><span class="check">‚úÖ</span> –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (–ª–µ—Ç–∞–µ–º!)</p>
<p><span class="cross">‚ùå</span> –°–ª–æ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞, —Å–ª–æ–∂–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞, —Ç—Ä–µ–±—É–µ—Ç async-–¥—Ä–∞–π–≤–µ—Ä–æ–≤ (await await await...)</p></div>
<div class="fragment"><h3>ü§î –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</h3>
<ul>
<li><strong>Sync üê¢:</strong> –°–∫—Ä–∏–ø—Ç—ã, CLI, –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∫–æ–≥–¥–∞ —Å–ø–µ—à–∏—Ç—å –Ω–µ–∫—É–¥–∞)</li>
<li><strong>Async üöÄ:</strong> –í–µ–±-—Å–µ—Ä–≤–∏—Å—ã, –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã, –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã (–∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å!)</li>
</ul></div>
</section>

<section>
<h2>üèóÔ∏è –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="k">from</span> sqlalchemy <span class="k">import</span> <span class="n">Column</span>, <span class="n">Integer</span>, <span class="n">String</span>, create_engine
<span class="k">from</span> sqlalchemy.ext.declarative <span class="k">import</span> declarative_base

<span class="n">Base</span> = declarative_base()

<span class="k">class</span> <span class="n">User</span>(<span class="n">Base</span>):
    __tablename__ = <span class="s">'users'</span>
    id = <span class="n">Column</span>(<span class="n">Integer</span>, primary_key=<span class="k">True</span>)
    name = <span class="n">Column</span>(<span class="n">String</span>(50), nullable=<span class="k">False</span>)
    email = <span class="n">Column</span>(<span class="n">String</span>(100), unique=<span class="k">True</span>)

engine = create_engine(<span class="s">'postgresql://user:pass@localhost/db'</span>)
<span class="n">Base</span>.metadata.create_all(engine)</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code>CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE
);</code></pre></div>
</section>

<section>
<h2>üé´ –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ (–±–∏–ª–µ—Ç –≤ –ë–î)</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="k">from</span> sqlalchemy.orm <span class="k">import</span> sessionmaker, <span class="n">Session</span>

<span class="n">SessionLocal</span> = sessionmaker(bind=engine)

session = <span class="n">SessionLocal</span>()
<span class="k">try</span>:
    session.commit()
<span class="k">except</span>:
    session.rollback()
<span class="k">finally</span>:
    session.close()

<span class="c"># –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±</span>
<span class="k">with</span> <span class="n">Session</span>(engine) <span class="k">as</span> session:
    session.commit()</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="k">BEGIN</span>;
<span class="c">-- SQL –æ–ø–µ—Ä–∞—Ü–∏–∏</span>
<span class="k">COMMIT</span>; <span class="c">-- –∏–ª–∏ ROLLBACK;</span></code></pre></div>
</section>

<section>
<h2>‚ûï CREATE - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="c"># –°–æ–∑–¥–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞</span>
user = <span class="n">User</span>(name=<span class="s">'–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤'</span>, email=<span class="s">'ivan@example.com'</span>)
session.add(user)
session.commit()

<span class="c"># –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤</span>
users = [
    <span class="n">User</span>(name=<span class="s">'–ê–ª–∏—Å–∞'</span>, email=<span class="s">'alice@example.com'</span>),
    <span class="n">User</span>(name=<span class="s">'–ë–æ—Ä–∏—Å'</span>, email=<span class="s">'boris@example.com'</span>)
]
session.add_all(users)
session.commit()</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="k">INSERT</span> <span class="k">INTO</span> users (name, email) 
<span class="k">VALUES</span> (<span class="s">'–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤'</span>, <span class="s">'ivan@example.com'</span>);

<span class="k">INSERT</span> <span class="k">INTO</span> users (name, email) 
<span class="k">VALUES</span> (<span class="s">'–ê–ª–∏—Å–∞'</span>, <span class="s">'alice@example.com'</span>),
       (<span class="s">'–ë–æ—Ä–∏—Å'</span>, <span class="s">'boris@example.com'</span>);</code></pre></div>
</section>

<section>
<h2>üëÄ READ - –ß—Ç–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π (–ø–æ–¥–≥–ª—è–¥—ã–≤–∞–µ–º –≤ –ë–î)</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="c"># –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏</span>
users = session.query(<span class="n">User</span>).all()

<span class="c"># –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å</span>
user = session.query(<span class="n">User</span>).first()

<span class="c"># –ü–æ–ª—É—á–∏—Ç—å –ø–æ ID</span>
user = session.query(<span class="n">User</span>).get(1)

<span class="c"># –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è</span>
users = session.query(<span class="n">User</span>).filter(<span class="n">User</span>.name == <span class="s">'–ò–≤–∞–Ω'</span>).all()

<span class="c"># –ù–µ—Å–∫–æ–ª—å–∫–æ —É—Å–ª–æ–≤–∏–π</span>
users = session.query(<span class="n">User</span>).filter(
    <span class="n">User</span>.name.like(<span class="s">'%–ò–≤–∞–Ω%'</span>),
    <span class="n">User</span>.id > 5
).all()</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="k">SELECT</span> * <span class="k">FROM</span> users;
<span class="k">SELECT</span> * <span class="k">FROM</span> users <span class="k">WHERE</span> name = <span class="s">'–ò–≤–∞–Ω'</span>;
<span class="k">SELECT</span> * <span class="k">FROM</span> users <span class="k">WHERE</span> name <span class="k">LIKE</span> <span class="s">'%–ò–≤–∞–Ω%'</span> <span class="k">AND</span> id > 5;</code></pre></div>
</section>

<section>
<h2>‚úèÔ∏è UPDATE - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π (–∏—Å–ø—Ä–∞–≤–ª—è–µ–º –∫–æ—Å—è–∫–∏)</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="c"># –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞</span>
user = session.query(<span class="n">User</span>).filter(<span class="n">User</span>.id == 1).first()
user.name = <span class="s">'–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞'</span>
session.commit()

<span class="c"># –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
session.query(<span class="n">User</span>).filter(<span class="n">User</span>.name == <span class="s">'–ò–≤–∞–Ω'</span>).update({
    <span class="s">'email'</span>: <span class="s">'newemail@example.com'</span>
})
session.commit()</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="k">UPDATE</span> users <span class="k">SET</span> name = <span class="s">'–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞'</span> <span class="k">WHERE</span> id = 1;

<span class="k">UPDATE</span> users <span class="k">SET</span> email = <span class="s">'newemail@example.com'</span> <span class="k">WHERE</span> name = <span class="s">'–ò–≤–∞–Ω'</span>;</code></pre></div>
</section>

<section>
<h2>üóëÔ∏è DELETE - –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π (–ø—Ä–æ—â–∞–π, –¥–∞–Ω–Ω—ã–µ!)</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="c"># –£–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞</span>
user = session.query(<span class="n">User</span>).filter(<span class="n">User</span>.id == 1).first()
session.delete(user)
session.commit()

<span class="c"># –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ</span>
session.query(<span class="n">User</span>).filter(<span class="n">User</span>.name == <span class="s">'–ò–≤–∞–Ω'</span>).delete()
session.commit()</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="k">DELETE</span> <span class="k">FROM</span> users <span class="k">WHERE</span> id = 1;
<span class="k">DELETE</span> <span class="k">FROM</span> users <span class="k">WHERE</span> name = <span class="s">'–ò–≤–∞–Ω'</span>;</code></pre></div>
</section>

<section>
<h2>üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ READ</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="c"># –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</span>
users = session.query(<span class="n">User</span>).order_by(<span class="n">User</span>.name).all()

<span class="c"># –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ</span>
users = session.query(<span class="n">User</span>).limit(10).all()

<span class="c"># –°–º–µ—â–µ–Ω–∏–µ + –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ</span>
users = session.query(<span class="n">User</span>).offset(5).limit(10).all()

<span class="c"># –ü–æ–¥—Å—á–µ—Ç</span>
count = session.query(<span class="n">User</span>).count()

<span class="c"># –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è</span>
exists = session.query(<span class="n">User</span>).filter(<span class="n">User</span>.id == 1).exists()</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="k">SELECT</span> * <span class="k">FROM</span> users <span class="k">ORDER BY</span> name;
<span class="k">SELECT</span> * <span class="k">FROM</span> users <span class="k">LIMIT</span> 10;
<span class="k">SELECT</span> * <span class="k">FROM</span> users <span class="k">OFFSET</span> 5 <span class="k">LIMIT</span> 10;</code></pre></div>
</section>

<section>
<h2>üë®‚Äçüëß‚Äçüë¶ –û—Ç–Ω–æ—à–µ–Ω–∏–µ –æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º (–æ–¥–∏–Ω —Ä–æ–¥–∏—Ç–µ–ª—å - –º–Ω–æ–≥–æ –¥–µ—Ç–µ–π)</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="k">from</span> sqlalchemy <span class="k">import</span> <span class="n">ForeignKey</span>
<span class="k">from</span> sqlalchemy.orm <span class="k">import</span> relationship

<span class="k">class</span> <span class="n">User</span>(<span class="n">Base</span>):
    __tablename__ = <span class="s">'users'</span>
    id = <span class="n">Column</span>(<span class="n">Integer</span>, primary_key=<span class="k">True</span>)
    name = <span class="n">Column</span>(<span class="n">String</span>(50))
    posts = relationship(<span class="s">'Post'</span>, back_populates=<span class="s">'author'</span>)

<span class="k">class</span> <span class="n">Post</span>(<span class="n">Base</span>):
    __tablename__ = <span class="s">'posts'</span>
    id = <span class="n">Column</span>(<span class="n">Integer</span>, primary_key=<span class="k">True</span>)
    title = <span class="n">Column</span>(<span class="n">String</span>(100))
    user_id = <span class="n">Column</span>(<span class="n">Integer</span>, <span class="n">ForeignKey</span>(<span class="s">'users.id'</span>))
    author = relationship(<span class="s">'User'</span>, back_populates=<span class="s">'posts'</span>)</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="k">CREATE TABLE</span> users (id <span class="k">SERIAL PRIMARY KEY</span>, name <span class="k">VARCHAR</span>(50));
<span class="k">CREATE TABLE</span> posts (
    id <span class="k">SERIAL PRIMARY KEY</span>,
    title <span class="k">VARCHAR</span>(100),
    user_id <span class="k">INTEGER REFERENCES</span> users(id)
);</code></pre></div>
</section>

<section>
<h2>‚úèÔ∏è CRUD –¥–ª—è –æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="c"># –°–æ–∑–¥–∞–Ω–∏–µ —Å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º</span>
user = <span class="n">User</span>(name=<span class="s">'–ò–≤–∞–Ω'</span>)
post1 = <span class="n">Post</span>(title=<span class="s">'–ü–µ—Ä–≤–∞—è —Å—Ç–∞—Ç—å—è'</span>, author=user)
post2 = <span class="n">Post</span>(title=<span class="s">'–í—Ç–æ—Ä–∞—è —Å—Ç–∞—Ç—å—è'</span>, author=user)
session.add(user)
session.commit()

<span class="c"># –ß—Ç–µ–Ω–∏–µ</span>
user = session.query(<span class="n">User</span>).filter(<span class="n">User</span>.id == 1).first()
posts = user.posts

<span class="c"># –û–±—Ä–∞—Ç–Ω–æ–µ —á—Ç–µ–Ω–∏–µ</span>
post = session.query(<span class="n">Post</span>).first()
author = post.author</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="k">INSERT INTO</span> users (name) <span class="k">VALUES</span> (<span class="s">'–ò–≤–∞–Ω'</span>) <span class="k">RETURNING</span> id;
<span class="k">INSERT INTO</span> posts (title, user_id) <span class="k">VALUES</span> 
    (<span class="s">'–ü–µ—Ä–≤–∞—è —Å—Ç–∞—Ç—å—è'</span>, 1), (<span class="s">'–í—Ç–æ—Ä–∞—è —Å—Ç–∞—Ç—å—è'</span>, 1);</code></pre></div>
</section>

<section>
<h2>üë• –û—Ç–Ω–æ—à–µ–Ω–∏–µ –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º (–≤—Å–µ —Å–æ –≤—Å–µ–º–∏ –¥—Ä—É–∂–∞—Ç)</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="k">from</span> sqlalchemy <span class="k">import</span> <span class="n">Table</span>

student_course = <span class="n">Table</span>(<span class="s">'student_course'</span>, <span class="n">Base</span>.metadata,
    <span class="n">Column</span>(<span class="s">'student_id'</span>, <span class="n">Integer</span>, <span class="n">ForeignKey</span>(<span class="s">'students.id'</span>)),
    <span class="n">Column</span>(<span class="s">'course_id'</span>, <span class="n">Integer</span>, <span class="n">ForeignKey</span>(<span class="s">'courses.id'</span>))
)

<span class="k">class</span> <span class="n">Student</span>(<span class="n">Base</span>):
    __tablename__ = <span class="s">'students'</span>
    id = <span class="n">Column</span>(<span class="n">Integer</span>, primary_key=<span class="k">True</span>)
    name = <span class="n">Column</span>(<span class="n">String</span>(50))
    courses = relationship(<span class="s">'Course'</span>, secondary=student_course, 
                          back_populates=<span class="s">'students'</span>)

<span class="k">class</span> <span class="n">Course</span>(<span class="n">Base</span>):
    __tablename__ = <span class="s">'courses'</span>
    id = <span class="n">Column</span>(<span class="n">Integer</span>, primary_key=<span class="k">True</span>)
    title = <span class="n">Column</span>(<span class="n">String</span>(100))
    students = relationship(<span class="n">'Student'</span>, secondary=student_course, 
                           back_populates=<span class="s">'courses'</span>)</code></pre></div>
</section>

<section>
<h2>‚úèÔ∏è CRUD –¥–ª—è –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="c"># –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏</span>
student = <span class="n">Student</span>(name=<span class="s">'–ê–ª–∏—Å–∞'</span>)
course1 = <span class="n">Course</span>(title=<span class="s">'–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'</span>)
course2 = <span class="n">Course</span>(title=<span class="s">'–§–∏–∑–∏–∫–∞'</span>)
student.courses.extend([course1, course2])
session.add(student)
session.commit()

<span class="c"># –ß—Ç–µ–Ω–∏–µ</span>
student = session.query(<span class="n">Student</span>).first()
courses = student.courses

<span class="c"># –£–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∏</span>
student.courses.remove(course1)
session.commit()</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="k">INSERT INTO</span> students (name) <span class="k">VALUES</span> (<span class="s">'–ê–ª–∏—Å–∞'</span>);
<span class="k">INSERT INTO</span> courses (title) <span class="k">VALUES</span> (<span class="s">'–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'</span>), (<span class="s">'–§–∏–∑–∏–∫–∞'</span>);
<span class="k">INSERT INTO</span> student_course (student_id, course_id) 
<span class="k">VALUES</span> (1, 1), (1, 2);</code></pre></div>
</section>

<section>
<h2>üîÄ –û–ø–µ—Ä–∞—Ü–∏—è MERGE (UPSERT) - –æ–±–Ω–æ–≤–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="k">from</span> sqlalchemy.dialects.postgresql <span class="k">import</span> insert

stmt = insert(<span class="n">User</span>).values(id=1, name=<span class="s">'John'</span>, email=<span class="s">'john@example.com'</span>)
stmt = stmt.on_conflict_do_update(
    index_elements=[<span class="s">'id'</span>],
    set_=dict(name=<span class="s">'John Updated'</span>, email=<span class="s">'john@example.com'</span>)
)
session.execute(stmt)
session.commit()

<span class="c"># –ò–ª–∏ —á–µ—Ä–µ–∑ merge</span>
user = <span class="n">User</span>(id=1, name=<span class="s">'John'</span>, email=<span class="s">'john@example.com'</span>)
session.merge(user)
session.commit()</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="k">INSERT INTO</span> users (id, name, email) 
<span class="k">VALUES</span> (1, <span class="s">'John'</span>, <span class="s">'john@example.com'</span>)
<span class="k">ON CONFLICT</span> (id) 
<span class="k">DO UPDATE SET</span> name = <span class="s">'John Updated'</span>, email = <span class="s">'john@example.com'</span>;</code></pre></div>
</section>

<section>
<h2>ü§î –ß—Ç–æ —Ç–∞–∫–æ–µ MERGE?</h2>
<div class="fragment"><p><span class="k">MERGE</span> (—Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ UPSERT) –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ - –≤—Å—Ç–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤ –æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏. üéØ<br><br>–ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è: "–ï—Å–ª–∏ –µ—Å—Ç—å - –æ–±–Ω–æ–≤–∏, –µ—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–π" (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–æ–ª–¥–∞—Ç –ë–î! üí™)</p></div>
<div class="fragment"><h3>–°–∏–Ω—Ç–∞–∫—Å–∏—Å:</h3>
<pre><code><span class="k">MERGE INTO</span> target_table 
<span class="k">USING</span> source_table 
<span class="k">ON</span> condition
<span class="k">WHEN MATCHED THEN</span>
    <span class="k">UPDATE SET</span> column = value
<span class="k">WHEN NOT MATCHED THEN</span>
    <span class="k">INSERT</span> (columns) <span class="k">VALUES</span> (values);</code></pre></div>
<div class="fragment"><h3>–ü—Ä–∏–º–µ—Ä MERGE:</h3>
<pre><code><span class="c">-- –û–±–Ω–æ–≤–ª—è–µ–º –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫—É—Ä—Å—ã –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞</span>
<span class="k">MERGE INTO</span> courses <span class="k">AS</span> target
<span class="k">USING</span> (<span class="k">VALUES</span> (1, <span class="s">'–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'</span>, 95)) <span class="k">AS</span> source(student_id, course_name, grade)
<span class="k">ON</span> target.student_id = source.student_id <span class="k">AND</span> target.course_name = source.course_name
<span class="k">WHEN MATCHED THEN</span>
    <span class="k">UPDATE SET</span> grade = source.grade
<span class="k">WHEN NOT MATCHED THEN</span>
    <span class="k">INSERT</span> (student_id, course_name, grade) 
    <span class="k">VALUES</span> (source.student_id, source.course_name, source.grade);</code></pre></div>
</section>

<section>
<h2>üîó –û–ø–µ—Ä–∞—Ü–∏–∏ UNION, INTERSECT, EXCEPT (—Ç–µ–æ—Ä–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤ –≤ –¥–µ–ª–µ!)</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="k">from</span> sqlalchemy <span class="k">import</span> union, intersect, except_

<span class="c"># UNION - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)</span>
query1 = session.query(<span class="n">User</span>.name).filter(<span class="n">User</span>.id < 5)
query2 = session.query(<span class="n">User</span>.name).filter(<span class="n">User</span>.id > 10)
result = union(query1, query2).all()

<span class="c"># INTERSECT - –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –æ–±—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã)</span>
result = intersect(query1, query2).all()

<span class="c"># EXCEPT - —Ä–∞–∑–Ω–æ—Å—Ç—å (—ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ query1, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ query2)</span>
result = except_(query1, query2).all()

<span class="c"># UNION ALL (—Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏, –±—ã—Å—Ç—Ä–µ–µ)</span>
result = union(query1, query2).union_all().all()</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="c">-- UNION (–±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)</span>
<span class="k">SELECT</span> name <span class="k">FROM</span> users <span class="k">WHERE</span> id < 5
<span class="k">UNION</span>
<span class="k">SELECT</span> name <span class="k">FROM</span> users <span class="k">WHERE</span> id > 10;

<span class="c">-- INTERSECT</span>
<span class="k">SELECT</span> name <span class="k">FROM</span> users <span class="k">WHERE</span> id < 5
<span class="k">INTERSECT</span>
<span class="k">SELECT</span> name <span class="k">FROM</span> users <span class="k">WHERE</span> id > 10;

<span class="c">-- EXCEPT</span>
<span class="k">SELECT</span> name <span class="k">FROM</span> users <span class="k">WHERE</span> id < 5
<span class="k">EXCEPT</span>
<span class="k">SELECT</span> name <span class="k">FROM</span> users <span class="k">WHERE</span> id > 10;

<span class="c">-- UNION ALL (—Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏)</span>
<span class="k">SELECT</span> name <span class="k">FROM</span> users <span class="k">WHERE</span> id < 5
<span class="k">UNION ALL</span>
<span class="k">SELECT</span> name <span class="k">FROM</span> users <span class="k">WHERE</span> id > 10;</code></pre></div>
</section>

<section>
<h2>ü§ù –í–∏–¥—ã JOIN (–∫–∞–∫ –ø–æ–¥—Ä—É–∂–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã)</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="k">from</span> sqlalchemy.orm <span class="k">import</span> joinedload

<span class="c"># INNER JOIN (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - —Ç–æ–ª—å–∫–æ —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ –∑–∞–ø–∏—Å–∏</span>
result = session.query(<span class="n">User</span>).join(<span class="n">Post</span>).all()

<span class="c"># LEFT JOIN - –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã + —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è</span>
result = session.query(<span class="n">User</span>).outerjoin(<span class="n">Post</span>).all()

<span class="c"># RIGHT JOIN (—á–µ—Ä–µ–∑ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç —Ç–∞–±–ª–∏—Ü)</span>
result = session.query(<span class="n">Post</span>).outerjoin(<span class="n">User</span>).all()

<span class="c"># FULL OUTER JOIN - –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü</span>
result = session.query(<span class="n">User</span>).outerjoin(<span class="n">Post</span>, full=<span class="k">True</span>).all()

<span class="c"># –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª–æ–≤–∏—è JOIN (–µ—Å–ª–∏ –Ω–µ—Ç relationship)</span>
result = session.query(<span class="n">User</span>).join(<span class="n">Post</span>, <span class="n">User</span>.id == <span class="n">Post</span>.user_id).all()</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="c">-- INNER JOIN</span>
<span class="k">SELECT</span> users.* <span class="k">FROM</span> users 
<span class="k">INNER JOIN</span> posts <span class="k">ON</span> users.id = posts.user_id;

<span class="c">-- LEFT JOIN</span>
<span class="k">SELECT</span> users.* <span class="k">FROM</span> users 
<span class="k">LEFT JOIN</span> posts <span class="k">ON</span> users.id = posts.user_id;

<span class="c">-- RIGHT JOIN</span>
<span class="k">SELECT</span> users.* <span class="k">FROM</span> users 
<span class="k">RIGHT JOIN</span> posts <span class="k">ON</span> users.id = posts.user_id;

<span class="c">-- FULL OUTER JOIN</span>
<span class="k">SELECT</span> users.* <span class="k">FROM</span> users 
<span class="k">FULL OUTER JOIN</span> posts <span class="k">ON</span> users.id = posts.user_id;

<span class="c">-- NATURAL JOIN (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ)</span>
<span class="k">SELECT</span> * <span class="k">FROM</span> users <span class="k">NATURAL JOIN</span> posts;</code></pre></div>
</section>

<section>
<h2>üì¶ –†–∞–±–æ—Ç–∞ —Å JSON –ø–æ–ª—è–º–∏ (NoSQL –≤ SQL - –ø–∞—Ä–∞–¥–æ–∫—Å!)</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="k">from</span> sqlalchemy.dialects.postgresql <span class="k">import</span> <span class="n">JSON</span>, <span class="n">JSONB</span>

<span class="k">class</span> <span class="n">Product</span>(<span class="n">Base</span>):
    __tablename__ = <span class="s">'products'</span>
    id = <span class="n">Column</span>(<span class="n">Integer</span>, primary_key=<span class="k">True</span>)
    name = <span class="n">Column</span>(<span class="n">String</span>(100))
    attributes = <span class="n">Column</span>(<span class="n">JSONB</span>)

<span class="c"># –°–æ–∑–¥–∞–Ω–∏–µ</span>
product = <span class="n">Product</span>(name=<span class="s">'Laptop'</span>, 
                 attributes={<span class="s">'color'</span>: <span class="s">'black'</span>, <span class="s">'ram'</span>: 16})
session.add(product)
session.commit()

<span class="c"># –ó–∞–ø—Ä–æ—Å –ø–æ JSON</span>
products = session.query(<span class="n">Product</span>).filter(
    <span class="n">Product</span>.attributes[<span class="s">'color'</span>].astext == <span class="s">'black'</span>
).all()

<span class="c"># –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
product.attributes[<span class="s">'ram'</span>] = 32
session.commit()</code></pre></div>
</section>

<section>
<h2>üéì –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ JSON –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="c"># –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–ª—é—á–∞</span>
products = session.query(<span class="n">Product</span>).filter(
    <span class="n">Product</span>.attributes.has_key(<span class="s">'color'</span>)
).all()

<span class="c"># –°–æ–¥–µ—Ä–∂–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ</span>
products = session.query(<span class="n">Product</span>).filter(
    <span class="n">Product</span>.attributes.contains({<span class="s">'color'</span>: <span class="s">'black'</span>})
).all()

<span class="c"># –í–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</span>
products = session.query(<span class="n">Product</span>).filter(
    <span class="n">Product</span>.attributes[<span class="s">'specs'</span>][<span class="s">'cpu'</span>].astext == <span class="s">'Intel'</span>
).all()</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="k">SELECT</span> * <span class="k">FROM</span> products <span class="k">WHERE</span> attributes ? <span class="s">'color'</span>;
<span class="k">SELECT</span> * <span class="k">FROM</span> products <span class="k">WHERE</span> attributes @> <span class="s">'{"color": "black"}'</span>;
<span class="k">SELECT</span> * <span class="k">FROM</span> products <span class="k">WHERE</span> attributes-><span class="s">'specs'</span>->><span class="s">'cpu'</span> = <span class="s">'Intel'</span>;</code></pre></div>
</section>

<section>
<h2>üìä –ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Å—á–∏—Ç–∞–µ–º –≤—Å—ë –ø–æ–¥—Ä—è–¥)</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="k">from</span> sqlalchemy <span class="k">import</span> func

<span class="c"># COUNT</span>
count = session.query(func.count(<span class="n">User</span>.id)).scalar()

<span class="c"># –ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</span>
total = session.query(func.sum(<span class="n">Product</span>.price)).scalar()
avg_price = session.query(func.avg(<span class="n">Product</span>.price)).scalar()

<span class="c"># GROUP BY</span>
result = session.query(<span class="n">User</span>.name, func.count(<span class="n">Post</span>.id))\
    .join(<span class="n">Post</span>).group_by(<span class="n">User</span>.name).all()

<span class="c"># HAVING</span>
result = session.query(<span class="n">User</span>.name, func.count(<span class="n">Post</span>.id))\
    .join(<span class="n">Post</span>).group_by(<span class="n">User</span>.name)\
    .having(func.count(<span class="n">Post</span>.id) > 5).all()</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="k">SELECT COUNT</span>(id) <span class="k">FROM</span> users;
<span class="k">SELECT</span> users.name, <span class="k">COUNT</span>(posts.id) <span class="k">FROM</span> users 
<span class="k">JOIN</span> posts <span class="k">ON</span> users.id = posts.user_id <span class="k">GROUP BY</span> users.name;</code></pre></div>
</section>

<section>
<h2>üé≠ –ü–æ–¥–∑–∞–ø—Ä–æ—Å—ã –∏ CTE (–∑–∞–ø—Ä–æ—Å—ã –≤–Ω—É—Ç—Ä–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ - inception!)</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="k">from</span> sqlalchemy <span class="k">import</span> select

<span class="c"># –ü–æ–¥–∑–∞–ø—Ä–æ—Å</span>
subq = session.query(func.avg(<span class="n">Product</span>.price)).scalar_subquery()
products = session.query(<span class="n">Product</span>).filter(<span class="n">Product</span>.price > subq).all()

<span class="c"># CTE</span>
cte = session.query(<span class="n">User</span>.id, <span class="n">User</span>.name).filter(<span class="n">User</span>.id < 10).cte()
result = session.query(cte, <span class="n">Post</span>)\
    .join(<span class="n">Post</span>, cte.c.id == <span class="n">Post</span>.user_id).all()

<span class="c"># –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π CTE</span>
cte = select([<span class="n">Category</span>.id, <span class="n">Category</span>.parent_id])\
    .where(<span class="n">Category</span>.id == 1).cte(recursive=<span class="k">True</span>)
cte = cte.union_all(
    select([<span class="n">Category</span>.id, <span class="n">Category</span>.parent_id])\
    .where(<span class="n">Category</span>.parent_id == cte.c.id)
)</code></pre></div>
</section>

<section>
<h2>üîí –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–Ω–µ —Ç—Ä–æ–≥–∞–π, —ç—Ç–æ –º–æ—ë!)</h2>
<div class="fragment"><h3>SQLAlchemy:</h3>
<pre><code><span class="c"># –Ø–≤–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è</span>
<span class="k">with</span> session.begin():
    user = <span class="n">User</span>(name=<span class="s">'John'</span>)
    session.add(user)

<span class="c"># –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</span>
<span class="k">with</span> session.begin_nested():
    session.add(user)

<span class="c"># –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ FOR UPDATE</span>
user = session.query(<span class="n">User</span>).filter(<span class="n">User</span>.id == 1)\
    .with_for_update().first()

<span class="c"># –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ FOR SHARE</span>
user = session.query(<span class="n">User</span>).filter(<span class="n">User</span>.id == 1)\
    .with_for_update(read=<span class="k">True</span>).first()</code></pre></div>
<div class="fragment"><h3>SQL (PostgreSQL):</h3>
<pre><code><span class="k">BEGIN</span>;
<span class="k">INSERT INTO</span> users (name) <span class="k">VALUES</span> (<span class="s">'John'</span>);
<span class="k">COMMIT</span>;

<span class="k">SELECT</span> * <span class="k">FROM</span> users <span class="k">WHERE</span> id = 1 <span class="k">FOR UPDATE</span>;</code></pre></div>
</section>

<section>
<h2>üéØ Best Practices –∏ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ</h2>
<div class="fragment"><h3>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (—Å–ª—É—à–∞–π—Ç–µ –¥—è–¥—é!):</h3>
<ul style="font-size:1.2em">
<li><strong>üèä Connection pooling</strong> - –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö (—ç–∫–æ–Ω–æ–º–∏–º —Ä–µ—Å—É—Ä—Å—ã!)</li>
<li><strong>‚ö° Eager loading</strong> - –∑–∞–≥—Ä—É–∑–∫–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º (–∏–∑–±–µ–≥–∞–µ–º N+1 –ø—Ä–æ–±–ª–µ–º—É - –≤—Ä–∞–≥ ‚Ññ1!)</li>
<li><strong>üöÄ –ò–Ω–¥–µ–∫—Å—ã</strong> - —É—Å–∫–æ—Ä—è—é—Ç –ø–æ–∏—Å–∫ –ø–æ –ø–æ–ª—è–º –≤ WHERE, JOIN, ORDER BY (—Ç—É—Ä–±–æ-–∫–Ω–æ–ø–∫–∞ –¥–ª—è –ë–î!)</li>
<li><strong>üì¶ Batch –æ–ø–µ—Ä–∞—Ü–∏–∏</strong> - –≤—Å—Ç–∞–≤–∫–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å (–æ–ø—Ç–æ–º –¥–µ—à–µ–≤–ª–µ!)</li>
<li><strong>‚ö° Async</strong> - –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î –¥–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ª–µ—Ç–∞–µ–º –±—ã—Å—Ç—Ä–µ–µ!)</li>
<li><strong>üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏ (Alembic)</strong> - –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î (Git –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö!)</li>
</ul></div>
<div class="fragment"><h3>‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–π—Ç–µ!):</h3>
<ul style="font-size:1.2em">
<li><strong>üò± –ó–∞–±—ã–≤–∞—Ç—å commit()</strong> - –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î (–∫–ª–∞—Å—Å–∏–∫–∞ –∂–∞–Ω—Ä–∞!)</li>
<li><strong>üí• N+1 –ø—Ä–æ–±–ª–µ–º–∞</strong> - 1 –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–ø–∏—Å–∫–∞ + N –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ë–î –ø–ª–∞—á–µ—Ç –∫—Ä–æ–≤–∞–≤—ã–º–∏ —Å–ª–µ–∑–∞–º–∏)</li>
<li><strong>üíß –ù–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Å–µ—Å—Å–∏–∏</strong> - —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–µ –ø—É–ª–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (–º–µ–¥–ª–µ–Ω–Ω–∞—è —Å–º–µ—Ä—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)</li>
<li><strong>üêå Sync –≤ async</strong> - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ event loop, –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∑–∞—á–µ–º —Ç–æ–≥–¥–∞ async?!)</li>
</ul></div>
<div class="fragment"><h3>üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã (—á–∏—Ç–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!):</h3>
<ul style="font-size:1.2em">
<li>üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: <a href="https://docs.sqlalchemy.org" style="color:#4A90E2">docs.sqlalchemy.org</a></li>
<li>üîÑ Alembic: <a href="https://alembic.sqlalchemy.org" style="color:#4A90E2">alembic.sqlalchemy.org</a></li>
<li>üêò PostgreSQL: <a href="https://www.postgresql.org/docs/" style="color:#4A90E2">postgresql.org/docs</a></li>
</ul></div>
<div class="fragment"><p style="font-size:2em;text-align:center;margin-top:40px">üéâ –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ! üöÄ<br><span style="font-size:0.6em">–¢–µ–ø–µ—Ä—å –∏–¥–∏—Ç–µ –∏ –ø–∏—à–∏—Ç–µ –∫—Ä–∞—Å–∏–≤—ã–π –∫–æ–¥! üíª‚ú®</span></p></div>
</section>

</div>
<div class="navigation"></div>
</div>

<script>
const sections=document.querySelectorAll('section');
const nav=document.querySelector('.navigation');
let current=0,fragmentIndex=0;

sections.forEach((_,i)=>{
const btn=document.createElement('div');
btn.className='nav-dot';
btn.textContent=i+1;
btn.onclick=()=>goTo(i);
nav.appendChild(btn);
});

function goTo(n){
if(n<0||n>=sections.length)return;
sections[current].classList.remove('present');
nav.children[current].classList.remove('active');
current=n;
fragmentIndex=0;
sections[current].classList.add('present');
nav.children[current].classList.add('active');
showFragments();
}

function showFragments(){
const fragments=sections[current].querySelectorAll('.fragment');
fragments.forEach((f,i)=>f.classList.toggle('visible',i<fragmentIndex));
}

function nextFragment(){
const fragments=sections[current].querySelectorAll('.fragment');
if(fragmentIndex<fragments.length){fragmentIndex++;showFragments();return true}
return false;
}

document.addEventListener('keydown',e=>{
if(e.code==='Space'||e.code==='ArrowRight'){e.preventDefault();if(!nextFragment())goTo(current+1)}
else if(e.code==='ArrowLeft'){e.preventDefault();if(fragmentIndex>0){fragmentIndex--;showFragments()}else goTo(current-1)}
});


goTo(0);
</script>
</body>
</html>