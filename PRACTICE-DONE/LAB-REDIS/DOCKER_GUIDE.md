# Docker Compose - –û–±—É—á–∞—é—â–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üê≥ Dockerfile vs Docker Compose

### Dockerfile
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –û–ø–∏—Å—ã–≤–∞–µ—Ç –ö–ê–ö —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∫–æ–ø–∏—Ä—É–µ—Ç –∫–æ–¥
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞

```dockerfile
FROM python:3.11-slim     # –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑
WORKDIR /app              # –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
COPY requirements.txt .   # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
RUN pip install -r requirements.txt  # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY app/ .               # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
CMD ["python", "main.py"] # –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
```

### Docker Compose
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –û–ø–∏—Å—ã–≤–∞–µ—Ç –ß–¢–û –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ –ö–ê–ö —Å–≤—è–∑–∞—Ç—å
- –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ—Ç—è–º–∏, —Ç–æ–º–∞–º–∏, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
- –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üîó –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

```yaml
services:
  app:
    build: .              # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Dockerfile –≤ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ
    ports:
      - "8000:8000"
  db:
    image: postgres:17    # –ì–æ—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑ (–±–µ–∑ Dockerfile)
```

**–ü—Ä–æ—Ü–µ—Å—Å**:
1. `docker-compose up --build` —á–∏—Ç–∞–µ—Ç docker-compose.yml
2. –î–ª—è —Å–µ—Ä–≤–∏—Å–∞ `app` –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–±–æ—Ä–∫—É –ø–æ Dockerfile
3. –°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–∑ –æ–±—Ä–∞–∑–æ–≤
4. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–µ—Ç–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
5. –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã

## üê≥ –û—Å–Ω–æ–≤—ã Docker Compose

Docker Compose –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –º–Ω–æ–≥–æ–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ –æ–¥–∏–Ω —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ docker-compose.yml

```yaml
services:          # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
  db:             # –ò–º—è —Å–µ—Ä–≤–∏—Å–∞
    image: postgres:17    # Docker –æ–±—Ä–∞–∑
    environment:          # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
      POSTGRES_DB: student_db
    ports:               # –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤ host:container
      - "5432:5432"
    networks:            # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏
      - app-network

networks:         # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–µ—Ç–µ–π
  app-network:
    driver: bridge

## üåê –ü–æ–¥—Ä–æ–±–Ω–æ –æ —Å–µ—Ç—è—Ö Docker

### –ó–∞—á–µ–º –Ω—É–∂–Ω—ã —Å–µ—Ç–∏?
- **–ò–∑–æ–ª—è—Ü–∏—è** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ç—è—Ö –Ω–µ –≤–∏–¥—è—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
- **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ** - –æ–±—Ä–∞—â–µ–Ω–∏–µ –ø–æ –∏–º–µ–Ω–∏ —Å–µ—Ä–≤–∏—Å–∞ –≤–º–µ—Å—Ç–æ IP
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

### –¢–∏–ø—ã –¥—Ä–∞–π–≤–µ—Ä–æ–≤ —Å–µ—Ç–µ–π
```yaml
networks:
  app-network:
    driver: bridge    # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ª–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å
  # driver: host     # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ç—å —Ö–æ—Å—Ç–∞
  # driver: overlay  # –î–ª—è Docker Swarm
```

### –ú–æ–∂–Ω–æ –ª–∏ –±–µ–∑ —Å–µ—Ç–µ–π?
**–î–ê!** Docker Compose –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

```yaml
# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –ë–ï–ó —è–≤–Ω—ã—Ö —Å–µ—Ç–µ–π
services:
  app:
    build: .
    ports:
      - "8000:8000"
  db:
    image: postgres:17
    environment:
      POSTGRES_DB: demo
  redis:
    image: redis:7-alpine
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏!
```

### –ö–æ–≥–¥–∞ –Ω—É–∂–Ω—ã —è–≤–Ω—ã–µ —Å–µ—Ç–∏?
1. **–ù–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø**:
```yaml
services:
  web:
    networks: [frontend]
  api:
    networks: [frontend, backend]
  db:
    networks: [backend]  # –¢–æ–ª—å–∫–æ API –≤–∏–¥–∏—Ç –ë–î

networks:
  frontend:
  backend:
```

2. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ç—è–º**:
```yaml
networks:
  existing_network:
    external: true
```

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä
```bash
# –ë–µ–∑ —è–≤–Ω—ã—Ö —Å–µ—Ç–µ–π - –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!
docker-compose exec app ping db     # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
docker-compose exec app ping redis  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

# –ò–º–µ–Ω–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ = DNS –∏–º–µ–Ω–∞
curl http://db:5432      # –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
curl http://redis:6379   # –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```

**–í—ã–≤–æ–¥**: –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å–µ—Ç–∏ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã - Docker Compose —Å–æ–∑–¥–∞–µ—Ç –∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
```

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up

# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up -d

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up --build
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs
docker-compose logs app  # –ª–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
```

### –†–∞–±–æ—Ç–∞ —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
```bash
# –ó–∞–ø—É—Å–∫ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose up app

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
docker-compose restart app

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker-compose exec app bash
```

## üîß –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```bash
docker-compose exec db psql -U student -d student_db
```

### 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
docker-compose exec app env
```

### 3. –û—Ç–ª–∞–¥–∫–∞ —Å–µ—Ç–∏
```bash
docker-compose exec app ping db
docker-compose exec app ping redis
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ—Å—É—Ä—Å–æ–≤
```bash
docker stats
```

### –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
docker-compose logs -f app
```

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

1. **Volumes** - –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:
```yaml
volumes:
  - postgres_data:/var/lib/postgresql/data
```

2. **Depends_on** - –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞:
```yaml
depends_on:
  - db
  - redis
```

3. **Environment —Ñ–∞–π–ª—ã**:
```yaml
env_file:
  - .env
```

## üîç –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
docker-compose logs service_name
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å—É
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å host –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (0.0.0.0 vs 127.0.0.1)

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–∏—Å—ã –Ω–µ –≤–∏–¥—è—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å networks –≤ docker-compose.yml
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ–Ω–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –∫–∞–∫ —Ö–æ—Å—Ç—ã

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
docker-compose down              # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose up --build -d     # –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose logs -f app       # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
curl http://localhost:8000/docs  # Swagger UI
python load_test.py             # –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Ç–µ—Å—Ç
```