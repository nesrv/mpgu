# üìö –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ Docker Compose

## –ó–∞–¥–∞–Ω–∏–µ 1: –î–æ–±–∞–≤–∏—Ç—å nginx
**–ß—Ç–æ –¥–µ–ª–∞–µ–º**: –î–æ–±–∞–≤–ª—è–µ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä nginx

### –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç—å docker-compose.yml
### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ redis:
```yaml
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å
```bash
docker-compose up nginx
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
–û—Ç–∫—Ä—ã—Ç—å http://localhost - –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ nginx

**–ß—Ç–æ –∏–∑—É—á–∏–ª–∏**: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤, –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤

---

## –ó–∞–¥–∞–Ω–∏–µ 2: –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
**–ß—Ç–æ –¥–µ–ª–∞–µ–º**: –ú–µ–Ω—è–µ–º –ø–æ—Ä—Ç —Å 8000 –Ω–∞ 3000

### –®–∞–≥ 1: –í docker-compose.yml –Ω–∞–π—Ç–∏:
```yaml
app:
  ports:
    - "8000:8000"
```

### –®–∞–≥ 2: –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞:
```yaml
app:
  ports:
    - "3000:8000"
```

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
```bash
docker-compose restart app
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
–û—Ç–∫—Ä—ã—Ç—å http://localhost:3000/docs

**–ß—Ç–æ –∏–∑—É—á–∏–ª–∏**: –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤ host:container

---

## –ó–∞–¥–∞–Ω–∏–µ 3: –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
**–ß—Ç–æ –¥–µ–ª–∞–µ–º**: –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é DEBUG=true

### –®–∞–≥ 1: –í docker-compose.yml –≤ —Å–µ—Ä–≤–∏—Å–µ app –¥–æ–±–∞–≤–∏—Ç—å:
```yaml
app:
  environment:
    DATABASE_URL: postgresql+asyncpg://student:password@db:5432/student_db
    REDIS_URL: redis://redis:6379
    DEBUG: "true"
```

### –®–∞–≥ 2: –í main.py –¥–æ–±–∞–≤–∏—Ç—å:
```python
import os

@app.get("/debug")
def debug_info():
    return {"debug": os.getenv("DEBUG", "false")}
```

### –®–∞–≥ 3: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
```bash
docker-compose up --build app
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
–û—Ç–∫—Ä—ã—Ç—å http://localhost:8000/debug

**–ß—Ç–æ –∏–∑—É—á–∏–ª–∏**: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞

---

---

## –ó–∞–¥–∞–Ω–∏–µ 4: –î–æ–±–∞–≤–∏—Ç—å volume –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
**–ß—Ç–æ –¥–µ–ª–∞–µ–º**: –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ PostgreSQL –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

### –®–∞–≥ 1: –í docker-compose.yml –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü:
```yaml
volumes:
  postgres_data:
```

### –®–∞–≥ 2: –í —Å–µ—Ä–≤–∏—Å–µ db –¥–æ–±–∞–≤–∏—Ç—å:
```yaml
db:
  image: postgres:17
  volumes:
    - postgres_data:/var/lib/postgresql/data
```

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
```bash
docker-compose down
docker-compose up -d
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
```bash
docker volume ls
```

**–ß—Ç–æ –∏–∑—É—á–∏–ª–∏**: volumes, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

---

## –ó–∞–¥–∞–Ω–∏–µ 5: –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
**–ß—Ç–æ –¥–µ–ª–∞–µ–º**: –í—ã–Ω–æ—Å–∏–º –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª .env:
```
DB_PASSWORD=mysecret123
DB_USER=student
DB_NAME=student_db
```

### –®–∞–≥ 2: –í docker-compose.yml –∏–∑–º–µ–Ω–∏—Ç—å db:
```yaml
db:
  environment:
    POSTGRES_DB: ${DB_NAME}
    POSTGRES_USER: ${DB_USER}
    POSTGRES_PASSWORD: ${DB_PASSWORD}
```

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
```bash
docker-compose up --build
```

**–ß—Ç–æ –∏–∑—É—á–∏–ª–∏**: .env —Ñ–∞–π–ª—ã, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ${}

---

## –ó–∞–¥–∞–Ω–∏–µ 6: –î–æ–±–∞–≤–∏—Ç—å healthcheck
**–ß—Ç–æ –¥–µ–ª–∞–µ–º**: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–æ–≤

### –®–∞–≥ 1: –í —Å–µ—Ä–≤–∏—Å–µ db –¥–æ–±–∞–≤–∏—Ç—å:
```yaml
db:
  healthcheck:
    test: ["CMD-SHELL", "pg_isready -U student"]
    interval: 30s
    timeout: 10s
    retries: 3
```

### –®–∞–≥ 2: –í —Å–µ—Ä–≤–∏—Å–µ app –∏–∑–º–µ–Ω–∏—Ç—å depends_on:
```yaml
app:
  depends_on:
    db:
      condition: service_healthy
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å
```bash
docker-compose up --build
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
```bash
docker-compose ps
```

**–ß—Ç–æ –∏–∑—É—á–∏–ª–∏**: healthcheck, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

---

## –ó–∞–¥–∞–Ω–∏–µ 7: –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ø–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
**–ß—Ç–æ –¥–µ–ª–∞–µ–º**: –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º app —Å–µ—Ä–≤–∏—Å

### –®–∞–≥ 1: –£–±—Ä–∞—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—Ç —É app:
```yaml
app:
  ports:
    - "8000-8002:8000"
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å 3 –∫–æ–ø–∏–∏
```bash
docker-compose up --scale app=3
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
```bash
docker-compose ps
curl http://localhost:8000/hit
curl http://localhost:8001/hit
curl http://localhost:8002/hit
```

**–ß—Ç–æ –∏–∑—É—á–∏–ª–∏**: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–∏–∞–ø–∞–∑–æ–Ω –ø–æ—Ä—Ç–æ–≤

---

## –ó–∞–¥–∞–Ω–∏–µ 8: –î–æ–±–∞–≤–∏—Ç—å nginx –∫–∞–∫ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫
**–ß—Ç–æ –¥–µ–ª–∞–µ–º**: nginx —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É app –∫–æ–ø–∏—è–º–∏

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª nginx.conf –≤ –ø–∞–ø–∫–µ LAB-REDIS:
```nginx
upstream app {
    server app:8000;
}

server {
    listen 80;
    location / {
        proxy_pass http://app;
    }
}
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞**:
- `upstream app` - –≥—Ä—É–ø–ø–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø–æ–¥ –∏–º–µ–Ω–µ–º "app"
- `server app:8000` - –∞–¥—Ä–µ—Å –Ω–∞—à–µ–≥–æ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `listen 80` - nginx —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 80
- `location /` - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã (/hit, /docs, –∏ —Ç.–¥.)
- `proxy_pass` - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ app:8000

**–ü–æ—ç—Ç–æ–º—É**:
- http://localhost/hit ‚Üí nginx:80 ‚Üí app:8000/hit
- http://localhost/docs ‚Üí nginx:80 ‚Üí app:8000/docs

### –®–∞–≥ 2: –í docker-compose.yml –∏–∑–º–µ–Ω–∏—Ç—å nginx:
```yaml
nginx:
  image: nginx:alpine
  ports:
    - "80:80"
  volumes:
    - ./nginx.conf:/etc/nginx/conf.d/default.conf
  depends_on:
    - app
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å
```bash
docker-compose up --scale app=2
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
```bash
curl http://localhost/hit
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
- nginx –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ—Ä—Ç 80
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –æ–¥–∏–Ω –∏–∑ app –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- app —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ –≤ PostgreSQL
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç {"count": —á–∏—Å–ª–æ}

**–ß—Ç–æ –∏–∑—É—á–∏–ª–∏**: volumes —Å —Ñ–∞–π–ª–∞–º–∏, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏

---

## –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose ps

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs app

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ
docker-compose down

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–Ω–æ–≤–æ
docker-compose up -d

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å volumes
docker volume ls

# –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
docker-compose up --scale app=3
```