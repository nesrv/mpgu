# –¢–µ–∫—Å—Ç –ª–µ–∫—Ü–∏–∏: PostgreSQL Full-Text Search (–ß–∞—Å—Ç—å 2)

## –°–ª–∞–π–¥ 11: –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä (Parser)

**–í—Ä–µ–º—è: 5 –º–∏–Ω**

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è:** –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä ‚Äî —ç—Ç–æ —Ç–æ–∫–µ–Ω–∞–π–∑–µ—Ä, –∫–∞–∫ –≤ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞—Ö (–ª–µ–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑).

–û–∫–µ–π, –∫–∞–∫ Postgres –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –≤ tsvector? –ü–µ—Ä–≤—ã–π —à–∞–≥ ‚Äî **–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä (parser)**.

**–ó–∞–¥–∞—á–∞ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞:** —Ä–∞–∑–±–∏—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Ç–æ–∫–µ–Ω—ã —Å —Ç–∏–ø–∞–º–∏.

**–ü—Ä–∏–º–µ—Ä:**

```
–í—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞:
"–ö—É–ø–∏ —Å–ª–æ–Ω–∞ –∑–∞ 1000$ –Ω–∞ example.com!"

–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞:
"–ö—É–ø–∏"        ‚Üí word (—Å–ª–æ–≤–æ)
"—Å–ª–æ–Ω–∞"       ‚Üí word
"1000"        ‚Üí uint (—á–∏—Å–ª–æ)
"$"           ‚Üí symbol
"example.com" ‚Üí url (–∞–¥—Ä–µ—Å)
"!"           ‚Üí symbol
```

**23 —Ç–∏–ø–∞ —Ç–æ–∫–µ–Ω–æ–≤:**
- **word** ‚Äî –æ–±—ã—á–Ω—ã–µ —Å–ª–æ–≤–∞
- **email** ‚Äî —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç `admin@example.com`
- **url** ‚Äî —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç `https://site.ru`
- **numword** ‚Äî "–¥–≤–∞–¥—Ü–∞—Ç—å —Ç—Ä–∏"
- **tag** ‚Äî XML/HTML —Ç–µ–≥–∏ `<div>`
- **entity** ‚Äî HTML entities `&nbsp;`

**–ó–∞—á–µ–º —Ç–∏–ø—ã?** –ß—Ç–æ–±—ã –ø–æ-—Ä–∞–∑–Ω–æ–º—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ª–æ–≤–∞ –∏ —á–∏—Å–ª–∞! –î–ª—è —Å–ª–æ–≤ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–µ–º–º–∏–Ω–≥, –¥–ª—è email ‚Äî –Ω–µ—Ç.

**–≠—Ç–æ –∫–∞–∫ AST (Abstract Syntax Tree) –≤ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞—Ö:** —Å–Ω–∞—á–∞–ª–∞ —Ä–∞–∑–±–∏—Ä–∞–µ–º –Ω–∞ —Ç–æ–∫–µ–Ω—ã, –ø–æ—Ç–æ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º.

**–®—Ç–∞—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä `default`:**
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤
- –ü–æ–Ω–∏–º–∞–µ—Ç –ª–∞—Ç–∏–Ω–∏—Ü—É, –∫–∏—Ä–∏–ª–ª–∏—Ü—É, —á–∏—Å–ª–∞, URL, email

**–ö–∞—Å—Ç–æ–º–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã (–¥–ª—è —Ö–∞—Ä–¥–∫–æ—Ä—â–∏–∫–æ–≤):**
- –ü–∏—à—É—Ç—Å—è –Ω–∞ C (–∫–∞–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ Postgres)
- –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á: –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∫–æ–¥–∞, —Ö–∏–º–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º—É–ª
- **pg_tsparser** ‚Äî –Ω–µ –ª–æ–º–∞–µ—Ç `snake_case` –∏ `kebab-case` (–¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∫–æ–¥–∞)

**–°–ª–µ–Ω–≥:** "–ó–∞—Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å" ‚Äî —Ä–∞–∑–±–∏—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Ç–æ–∫–µ–Ω—ã.

---

## –°–ª–∞–π–¥ 12: –®—Ç–∞—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä default

**–í—Ä–µ–º—è: 3 –º–∏–Ω**

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è:** default –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä ‚Äî —ç—Ç–æ —à–≤–µ–π—Ü–∞—Ä—Å–∫–∏–π –Ω–æ–∂ (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π).

**–®—Ç–∞—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä `default`:**
- 23 —Ç–∏–ø–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- –†–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Å–ª–æ–≤–∞, —á–∏—Å–ª–∞, –∞–¥—Ä–µ—Å–∞, —Ç–µ–≥–∏ XML, HTML entities

**–ö–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ:** 99% —Å–ª—É—á–∞–µ–≤. –ï—Å–ª–∏ –≤—ã –Ω–µ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç–µ –∫–æ–¥ –∏–ª–∏ —Ö–∏–º–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—É–ª—ã, default –≤–∞–º –ø–æ–¥–æ–π–¥–µ—Ç.

**–ö–∞—Å—Ç–æ–º–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã:**

–ü—Ä–∏–º–µ—Ä: –≤—ã –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç–µ –∫–æ–¥ –Ω–∞ Python. –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã `my_function` –Ω–µ —Ä–∞–∑–±–∏–≤–∞–ª–æ—Å—å –Ω–∞ `my` –∏ `function`.

–†–µ—à–µ–Ω–∏–µ: **pg_tsparser** ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–Ω–∏–º–∞–µ—Ç `snake_case`, `camelCase`, `kebab-case`.

```sql
CREATE TEXT SEARCH CONFIGURATION code_search (PARSER = pg_tsparser);
```

**–ù–æ —ç—Ç–æ —Ä–µ–¥–∫–æ—Å—Ç—å.** –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ default –±–æ–ª–µ–µ —á–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.

**–°–ª–µ–Ω–≥:** "–î–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø–∞—Ä—Å–µ—Ä" ‚Äî —à—Ç–∞—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä.

---

## –°–ª–∞–π–¥ 13: –°–ª–æ–≤–∞—Ä–∏ ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è

**–í—Ä–µ–º—è: 5 –º–∏–Ω**

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è:** –°–ª–æ–≤–∞—Ä—å ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä, –∫–∞–∫ `.toLowerCase()` –Ω–∞ —Å—Ç–µ—Ä–æ–∏–¥–∞—Ö.

–ü–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ —Ç–æ–∫–µ–Ω—ã –∏–¥—É—Ç –≤ **—Å–ª–æ–≤–∞—Ä—å**. –ó–∞–¥–∞—á–∞ —Å–ª–æ–≤–∞—Ä—è ‚Äî –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ **–ª–µ–∫—Å–µ–º—É**.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å (pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏):**

**1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç–æ–ø-—Å–ª–æ–≤**

```
"–∏", "–∏–ª–∏", "–≤", "–Ω–∞" ‚Üí —É–¥–∞–ª—è—é—Ç—Å—è
```

–≠—Ç–∏ —Å–ª–æ–≤–∞ –µ—Å—Ç—å –≤–µ–∑–¥–µ, –∏—Å–∫–∞—Ç—å –∏—Ö –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ. –ö–∞–∫ –≤ Google ‚Äî –æ–Ω –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç "the", "a", "is".

**2. –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ lowercase**

```
"PostgreSQL" ‚Üí "postgresql"
```

–ß—Ç–æ–±—ã "PostgreSQL" –∏ "postgresql" —Å—á–∏—Ç–∞–ª–∏—Å—å –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º.

**3. –°—Ç–µ–º–º–∏–Ω–≥ (–æ—Ç—Ä–µ–∑–∞–Ω–∏–µ –æ–∫–æ–Ω—á–∞–Ω–∏–π)**

```
"—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫"  ‚Üí "—Ä–∞–∑—Ä–∞–±–æ—Ç"
"—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞" ‚Üí "—Ä–∞–∑—Ä–∞–±–æ—Ç"
"—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"   ‚Üí "—Ä–∞–∑—Ä–∞–±–æ—Ç"
```

–í—Å–µ —Å–ª–æ–≤–æ—Ñ–æ—Ä–º—ã ‚Üí –æ–¥–Ω–∞ –ª–µ–∫—Å–µ–º–∞! –≠—Ç–æ –∏ –µ—Å—Ç—å –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫.

**4. –°–∏–Ω–æ–Ω–∏–º—ã (–∫–∞–∫ –∞–ª–∏–∞—Å—ã –≤ SQL)**

```
"PostgreSQL" ‚Üí "postgres"
"–ü–æ—Å—Ç–≥—Ä–µ—Å"   ‚Üí "postgres"
```

–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω–∏—è ‚Üí –æ–¥–Ω–∞ –ª–µ–∫—Å–µ–º–∞.

**–°–ª–µ–Ω–≥:** "–ó–∞—Å—Ç–µ–º–º–∏—Ç—å —Å–ª–æ–≤–æ" ‚Äî –æ—Ç—Ä–µ–∑–∞—Ç—å –æ–∫–æ–Ω—á–∞–Ω–∏–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Å–Ω–æ–≤–µ.

---

## –°–ª–∞–π–¥ 14: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–∏

**–í—Ä–µ–º—è: 5 –º–∏–Ω**

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è:** –°–ª–æ–≤–∞—Ä–∏ ‚Äî —ç—Ç–æ –∫–∞–∫ –ª–æ–∫–∞–ª–∏ –≤ i18n (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞ —Å–≤–æ–π).

**–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–∏:**

**1. simple ‚Äî –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π**

–¢–æ–ª—å–∫–æ lowercase + —Å—Ç–æ–ø-—Å–ª–æ–≤–∞. –ë—ã—Å—Ç—Ä–æ, –Ω–æ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–æ. –î–ª—è —è–∑—ã–∫–æ–≤ –±–µ–∑ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç).

**2. russian, english, etc. ‚Äî —Å—Ç–µ–º–º–∏–Ω–≥ –¥–ª—è 28 —è–∑—ã–∫–æ–≤**

–ê–ª–≥–æ—Ä–∏—Ç–º **Snowball** (Porter Stemmer 2.0). –°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –≤—ã–±–æ—Ä.

```sql
SELECT to_tsvector('russian', '—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏');
-- '—Ä–∞–∑—Ä–∞–±–æ—Ç':1
```

**–°—Ç–µ–º–º–∏–Ω–≥ vs –õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è:**

- **–°—Ç–µ–º–º–∏–Ω–≥** (–±—ã—Å—Ç—Ä–æ, –≥—Ä—É–±–æ): "–±–µ–∂–∞–ª" ‚Üí "–±–µ–∂" (–∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏–π)
- **–õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è** (–º–µ–¥–ª–µ–Ω–Ω–æ, —Ç–æ—á–Ω–æ): "–±–µ–∂–∞–ª" ‚Üí "–±–µ–∂–∞—Ç—å" (–ø–æ —Å–ª–æ–≤–∞—Ä—é)

Postgres –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–µ–º–º–∏–Ω–≥ ‚Äî —Å–∫–æ—Ä–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤.

**–ü–æ—á–µ–º—É —Å—Ç–µ–º–º–∏–Ω–≥, –∞ –Ω–µ –ª–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è?**

–õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –≤—Å–µ—Ö —Å–ª–æ–≤–æ—Ñ–æ—Ä–º. –î–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —ç—Ç–æ –º–∏–ª–ª–∏–æ–Ω—ã –∑–∞–ø–∏—Å–µ–π. –ú–µ–¥–ª–µ–Ω–Ω–æ –∏ –∂—Ä–µ—Ç –ø–∞–º—è—Ç—å.

–°—Ç–µ–º–º–∏–Ω–≥ ‚Äî —ç—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º. –ë—ã—Å—Ç—Ä–æ, –∫–æ–º–ø–∞–∫—Ç–Ω–æ, —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è 99% —Å–ª—É—á–∞–µ–≤.

**–ö–æ–≥–¥–∞ —Å—Ç–µ–º–º–∏–Ω–≥ –æ—à–∏–±–∞–µ—Ç—Å—è:**

```
"—Å—Ç–µ–∫–ª–æ" (–º–∞—Ç–µ—Ä–∏–∞–ª) ‚Üí "—Å—Ç–µ–∫–ª"
"—Å—Ç–µ–∫–ª–æ" (–æ—Ç "—Å—Ç–µ—á—å") ‚Üí "—Å—Ç–µ–∫–ª"
```

–†–∞–∑–Ω—ã–µ —Å–ª–æ–≤–∞ ‚Üí –æ–¥–Ω–∞ –ª–µ–∫—Å–µ–º–∞. –ù–æ —ç—Ç–æ —Ä–µ–¥–∫–æ—Å—Ç—å, –∏ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ.

**–°–ª–µ–Ω–≥:** "–°–Ω–µ–∂–æ–∫" ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º Snowball (–æ—Ç "—Å–Ω–µ–∂–Ω—ã–π –∫–æ–º").

---

## –°–ª–∞–π–¥ 15: –®–∞–±–ª–æ–Ω—ã —Å–ª–æ–≤–∞—Ä–µ–π

**–í—Ä–µ–º—è: 5 –º–∏–Ω**

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è:** –®–∞–±–ª–æ–Ω —Å–ª–æ–≤–∞—Ä—è ‚Äî —ç—Ç–æ –∫–∞–∫ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å –≤ –û–û–ü.

–°–ª–æ–≤–∞—Ä—å –≤ Postgres ‚Äî —ç—Ç–æ **–∏–Ω—Å—Ç–∞–Ω—Å —à–∞–±–ª–æ–Ω–∞** —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

```sql
CREATE TEXT SEARCH DICTIONARY my_russian (
  TEMPLATE = snowball,
  Language = russian,
  StopWords = russian
);
```

**–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã:**

**1. simple** ‚Äî –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π

Lowercase + —Å—Ç–æ–ø-—Å–ª–æ–≤–∞. –î–ª—è —è–∑—ã–∫–æ–≤ –±–µ–∑ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏.

**2. snowball** ‚Äî —Å—Ç–µ–º–º–µ—Ä (—Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π)

28 —è–∑—ã–∫–æ–≤ –∏–∑ –∫–æ—Ä–æ–±–∫–∏. –ë—ã—Å—Ç—Ä—ã–π, –Ω–æ –∏–Ω–æ–≥–¥–∞ "–æ—Ç—Ä–µ–∑–∞–µ—Ç –ª–∏—à–Ω–µ–µ".

**3. ispell** ‚Äî –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–ª–æ–≤–∞—Ä—å

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–æ–≤–∞—Ä–∏ MySpell/Hunspell (–∏–∑ OpenOffice/LibreOffice). –¢–æ—á–Ω–∞—è –ª–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ. –ù—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å —Å–ª–æ–≤–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã.

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ispell:**
- –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å (—é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –Ω–∞—É—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏)
- –ì–æ—Ç–æ–≤—ã –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å—é

**4. synonym** ‚Äî –º–∞–ø–ø–∏–Ω–≥ —Å–∏–Ω–æ–Ω–∏–º–æ–≤

```
postgres : postgresql
pg       : postgresql
```

–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã ‚Üí –æ–¥–Ω–∞ –ª–µ–∫—Å–µ–º–∞.

**5. thesaurus** ‚Äî –∑–∞–º–µ–Ω–∞ —Ñ—Ä–∞–∑ (–∫–∞–∫ –º–∞–∫—Ä–æ—Å—ã)

```
machine learning : ml
artificial intelligence : ai
```

–¶–µ–ª—ã–µ —Ñ—Ä–∞–∑—ã ‚Üí —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è.

**–°–ª–µ–Ω–≥:** "–¢–µ–º–ø–ª–µ–π—Ç —Å–ª–æ–≤–∞—Ä—è" ‚Äî —à–∞–±–ª–æ–Ω —Å–ª–æ–≤–∞—Ä—è.

---

## –°–ª–∞–π–¥ 16: –®–∞–±–ª–æ–Ω synonym –∏ thesaurus

**–í—Ä–µ–º—è: 4 –º–∏–Ω**

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è:** synonym ‚Äî —ç—Ç–æ –∞–ª–∏–∞—Å—ã –≤ SQL, thesaurus ‚Äî —ç—Ç–æ –º–∞–∫—Ä–æ—Å—ã –≤ C.

**Synonym ‚Äî –º–∞–ø–ø–∏–Ω–≥ —Å–∏–Ω–æ–Ω–∏–º–æ–≤:**

–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª `synonyms.txt`:

```
postgres : postgresql
pg       : postgresql
–ø–æ—Å—Ç–≥—Ä–µ—Å : postgresql
```

–°–æ–∑–¥–∞–µ–º —Å–ª–æ–≤–∞—Ä—å:

```sql
CREATE TEXT SEARCH DICTIONARY my_synonyms (
  TEMPLATE = synonym,
  SYNONYMS = synonyms
);
```

–¢–µ–ø–µ—Ä—å "postgres", "pg", "–ø–æ—Å—Ç–≥—Ä–µ—Å" ‚Üí –≤—Å–µ –ø—Ä–µ–≤—Ä–∞—Ç—è—Ç—Å—è –≤ "postgresql".

**Thesaurus ‚Äî –∑–∞–º–µ–Ω–∞ —Ñ—Ä–∞–∑:**

–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª `thesaurus.txt`:

```
machine learning : ml
artificial intelligence : ai
deep learning : dl
```

–¢–µ–ø–µ—Ä—å —Ñ—Ä–∞–∑–∞ "machine learning" ‚Üí –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—Å—è –≤ "ml".

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –£ –≤–∞—Å –µ—Å—Ç—å —É—Å—Ç–æ—è–≤—à–∏–µ—Å—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è (ML, AI, DL)
- –•–æ—Ç–∏—Ç–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è (PostgreSQL, Postgres, PG)

**–°–ª–µ–Ω–≥:** "–°–∏–Ω–æ–Ω–∏–º–∞–π–∑–µ—Ä" ‚Äî —Å–ª–æ–≤–∞—Ä—å —Å–∏–Ω–æ–Ω–∏–º–æ–≤.

---

## –°–ª–∞–π–¥ 17: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Äî routing –ø—Ä–∞–≤–∏–ª–∞

**–í—Ä–µ–º—è: 5 –º–∏–Ω**

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Äî —ç—Ç–æ routing –ø—Ä–∞–≤–∏–ª–∞, –∫–∞–∫ –≤ nginx.

–û–∫–µ–π, —É –Ω–∞—Å –µ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä (–≤—ã–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã —Å —Ç–∏–ø–∞–º–∏) –∏ —Å–ª–æ–≤–∞—Ä–∏ (–ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç —Ç–æ–∫–µ–Ω—ã –≤ –ª–µ–∫—Å–µ–º—ã). –ö–∞–∫ –∏—Ö —Å–≤—è–∑–∞—Ç—å?

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ —Å–ª–æ–≤–∞—Ä–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫ –∫–∞–∫–∏–º —Ç–∏–ø–∞–º —Ç–æ–∫–µ–Ω–æ–≤.

```sql
CREATE TEXT SEARCH CONFIGURATION my_config (COPY = russian);

ALTER TEXT SEARCH CONFIGURATION my_config
  ALTER MAPPING FOR word WITH synonym, russian_stem;
  -- –î–ª—è —Ç–∏–ø–∞ 'word': —Å–Ω–∞—á–∞–ª–∞ synonym, –ø–æ—Ç–æ–º russian_stem

ALTER TEXT SEARCH CONFIGURATION my_config
  ALTER MAPPING FOR email WITH simple;
  -- –î–ª—è —Ç–∏–ø–∞ 'email': —Ç–æ–ª—å–∫–æ simple
```

**–õ–æ–≥–∏–∫–∞:**
- –¢–æ–∫–µ–Ω—ã —Ç–∏–ø–∞ **word** ‚Üí —Å–Ω–∞—á–∞–ª–∞ —á–µ—Ä–µ–∑ synonym (–º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —Å–∏–Ω–æ–Ω–∏–º), –ø–æ—Ç–æ–º —á–µ—Ä–µ–∑ russian_stem (—Å—Ç–µ–º–º–∏–Ω–≥)
- –¢–æ–∫–µ–Ω—ã —Ç–∏–ø–∞ **email** ‚Üí —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ simple (lowercase, –±–µ–∑ —Å—Ç–µ–º–º–∏–Ω–≥–∞)

**–ó–∞—á–µ–º —Ä–∞–∑–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤?**

–î–ª—è email –Ω–µ –Ω—É–∂–µ–Ω —Å—Ç–µ–º–º–∏–Ω–≥! `admin@example.com` –Ω–µ –Ω–∞–¥–æ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –≤ `admin@exampl.com`.

–î–ª—è —á–∏—Å–µ–ª –Ω–µ –Ω—É–∂–Ω—ã —Å—Ç–æ–ø-—Å–ª–æ–≤–∞.

**–°–ª–µ–Ω–≥:** "–ö–æ–Ω—Ñ–∏–≥ –ø–æ–∏—Å–∫–∞" ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞.

---

## –°–ª–∞–π–¥ 18: –¶–µ–ø–æ—á–∫–∞ —Å–ª–æ–≤–∞—Ä–µ–π

**–í—Ä–µ–º—è: 5 –º–∏–Ω**

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è:** –¶–µ–ø–æ—á–∫–∞ —Å–ª–æ–≤–∞—Ä–µ–π ‚Äî —ç—Ç–æ Chain of Responsibility –ø–∞—Ç—Ç–µ—Ä–Ω (–∫–∞–∫ middleware –≤ Express.js).

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Ç–æ–∫–µ–Ω–∞ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å **—Ü–µ–ø–æ—á–∫—É —Å–ª–æ–≤–∞—Ä–µ–π**. –¢–æ–∫–µ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –Ω–∏—Ö –ø–æ –æ—á–µ—Ä–µ–¥–∏.

```
–¢–æ–∫–µ–Ω "PostgreSQL" (—Ç–∏–ø: word)
  ‚Üì
[synonym] ‚Üí –Ω–∞—à–µ–ª! ‚Üí "postgres" ‚Üí STOP
  ‚Üì (–µ—Å–ª–∏ –Ω–µ –Ω–∞—à–µ–ª)
[russian_stem] ‚Üí "postgresql" ‚Üí STOP
  ‚Üì (–µ—Å–ª–∏ –Ω–µ –Ω–∞—à–µ–ª)
[simple] ‚Üí "postgresql" ‚Üí STOP
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è –≤ —Ü–µ–ø–æ—á–∫–µ:**

**1. –§–∏–ª—å—Ç—Ä (return null)**

```
"–∏" ‚Üí —Å—Ç–æ–ø-—Å–ª–æ–≤–æ ‚Üí —É–¥–∞–ª–∏—Ç—å ‚Üí STOP
```

–°–ª–æ–≤–∞—Ä—å –≤–µ—Ä–Ω—É–ª null ‚Äî —Ç–æ–∫–µ–Ω —É–¥–∞–ª—è–µ—Ç—Å—è, –¥–∞–ª—å—à–µ –Ω–µ –∏–¥–µ—Ç.

**2. –ó–∞–º–µ–Ω–∞ –∏ STOP (return value)**

```
"PostgreSQL" ‚Üí "postgres" ‚Üí STOP
```

–°–ª–æ–≤–∞—Ä—å –≤–µ—Ä–Ω—É–ª –ª–µ–∫—Å–µ–º—É ‚Äî –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –¥–∞–ª—å—à–µ –Ω–µ –∏–¥–µ—Ç.

**3. –ü—Ä–æ–ø—É—Å–∫ (next())**

```
–°–∏–Ω–æ–Ω–∏–º –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ø–µ—Ä–µ–¥–∞—Ç—å –¥–∞–ª—å—à–µ
```

–°–ª–æ–≤–∞—Ä—å –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–ª —Ç–æ–∫–µ–Ω ‚Äî –ø–µ—Ä–µ–¥–∞–µ—Ç —Å–ª–µ–¥—É—é—â–µ–º—É –≤ —Ü–µ–ø–æ—á–∫–µ.

**–≠—Ç–æ –∫–∞–∫ Express.js middleware:**

```javascript
app.use(synonymMiddleware);  // –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
app.use(stemmingMiddleware); // –∏–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –¥–∞–ª—å—à–µ
app.use(simpleMiddleware);   // fallback
```

**–ü–µ—Ä–≤—ã–π —Å–ª–æ–≤–∞—Ä—å, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤—à–∏–π —Ç–æ–∫–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–µ–∫—Å–µ–º—É.**

**–°–ª–µ–Ω–≥:** "–ü—Ä–æ–≥–Ω–∞—Ç—å —á–µ—Ä–µ–∑ —Ü–µ–ø–æ—á–∫—É" ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä–∏.

---

## –°–ª–∞–π–¥ 19: –ò–Ω–¥–µ–∫—Å GiST

**–í—Ä–µ–º—è: 4 –º–∏–Ω**

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è:** GiST ‚Äî —ç—Ç–æ –∫–∞–∫ B-tree, –Ω–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤.

–û–∫–µ–π, –º—ã –Ω–∞—É—á–∏–ª–∏—Å—å –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å —Ç–µ–∫—Å—Ç –≤ tsvector –∏ –∏—Å–∫–∞—Ç—å. –ù–æ –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞ —ç—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ. –†–∞–∑–±–µ—Ä–µ–º –∏–Ω–¥–µ–∫—Å—ã.

**GiST (Generalized Search Tree)**

**–ü–ª—é—Å—ã:**
- ‚ö° **–ë—ã—Å—Ç—Ä—ã–π INSERT/UPDATE** ‚Äî –≤–∞–∂–Ω–æ –¥–ª—è highload —Å —á–∞—Å—Ç—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- üì¶ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ INCLUDE** ‚Äî covering index (–Ω–µ –ª–µ–∑–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É)
- üå≥ –ö–∞–∫ B-tree, –Ω–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤

**–ú–∏–Ω—É—Å—ã:**
- üêå **–ú–µ–¥–ª–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫** ‚Äî lossy index (–Ω–µ—Ç–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –Ω—É–∂–Ω–∞ recheck –ø–æ —Ç–∞–±–ª–∏—Ü–µ)
- üìâ **–î–µ–≥—Ä–∞–¥–∞—Ü–∏—è** –ø—Ä–∏ —Ä–æ—Å—Ç–µ —á–∏—Å–ª–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–ª–æ–≤

**–ß—Ç–æ —Ç–∞–∫–æ–µ lossy index?**

GiST —Ö—Ä–∞–Ω–∏—Ç –Ω–µ —Ç–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –∞ "–ø—Ä–∏–º–µ—Ä–Ω–æ–µ". –û–Ω –≥–æ–≤–æ—Ä–∏—Ç: "–í–æ—Ç —ç—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ú–û–ñ–ï–¢ –ë–´–¢–¨ –ø–æ–¥—Ö–æ–¥—è—Ç". –ü–æ—Ç–æ–º Postgres –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ —Ç–∞–±–ª–∏—Ü–µ.

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ë–ª–æ–≥–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–º–Ω–æ–≥–æ –∑–∞–ø–∏—Å–µ–π, –º–∞–ª–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞–∂–¥–æ–π)
- –ß–∞—Å—Ç—ã–µ INSERT/UPDATE

**–°–ª–µ–Ω–≥:** "–ì–∏—Å—Ç –∏–Ω–¥–µ–∫—Å" ‚Äî GiST –∏–Ω–¥–µ–∫—Å.

---

## –°–ª–∞–π–¥ 20: –ò–Ω–¥–µ–∫—Å GIN

**–í—Ä–µ–º—è: 5 –º–∏–Ω**

**–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è:** GIN ‚Äî —ç—Ç–æ HashMap<String, List<Integer>> –≤ –ø–∞–º—è—Ç–∏.

**GIN (Generalized Inverted Index) ‚Äî –∫–æ—Ä–æ–ª—å FTS**

**–ü–ª—é—Å—ã:**
- üöÄ **–û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫** ‚Äî inverted index –∫–∞–∫ –≤ Elasticsearch
- üìà **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –ø–∞–¥–∞–µ—Ç** —Å —Ä–æ—Å—Ç–æ–º —Å–ª–æ–≤–∞—Ä—è
- üíæ **–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π** ‚Äî —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –ª–µ–∫—Å–µ–º—ã

**–ú–∏–Ω—É—Å—ã:**
- üê¢ **–ú–µ–¥–ª–µ–Ω–Ω—ã–π INSERT/UPDATE** ‚Äî –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –º–Ω–æ–≥–æ –∫–ª—é—á–µ–π

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ):**

```
–õ–µ–∫—Å–µ–º–∞ ‚Üí [doc_id1, doc_id2, doc_id3, ...]
"postgres" ‚Üí [1, 5, 42, 100]
"python"   ‚Üí [2, 5, 99]
```

–≠—Ç–æ **inverted index** ‚Äî –æ—Ç —Å–ª–æ–≤–∞ –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º. –ö–∞–∫ –∏–Ω–¥–µ–∫—Å –≤ –∫–æ–Ω—Ü–µ —É—á–µ–±–Ω–∏–∫–∞: —Å–ª–æ–≤–æ ‚Üí —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

**–ü–æ—á–µ–º—É –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫?**

–ò—â–µ–º "postgres" ‚Üí —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ [1, 5, 42, 100]. –ù–µ –Ω–∞–¥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Å—é —Ç–∞–±–ª–∏—Ü—É!

**–ü–æ—á–µ–º—É –º–µ–¥–ª–µ–Ω–Ω—ã–π INSERT?**

–í—Å—Ç–∞–≤–∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç —Å 100 —Å–ª–æ–≤–∞–º–∏ ‚Üí –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å 100 –∫–ª—é—á–µ–π –≤ –∏–Ω–¥–µ–∫—Å–µ. –≠—Ç–æ –¥–æ—Ä–æ–≥–æ.

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: fastupdate=on**

```sql
CREATE INDEX idx_gin ON articles USING GIN (fts) WITH (fastupdate = on);
```

GIN –±–∞—Ç—á–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–∫–∞–∫ write-behind cache). –ù–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏, –ø–æ—Ç–æ–º –ø–∏—à–µ—Ç –ø–∞—á–∫–æ–π.

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, —Å—Ç–∞—Ç—å–∏, –ª–æ–≥–∏ (read-heavy –Ω–∞–≥—Ä—É–∑–∫–∞)
- –ú–Ω–æ–≥–æ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –º–∞–ª–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–°–ª–µ–Ω–≥:** "–î–∂–∏–Ω –∏–Ω–¥–µ–∫—Å" ‚Äî GIN –∏–Ω–¥–µ–∫—Å.
