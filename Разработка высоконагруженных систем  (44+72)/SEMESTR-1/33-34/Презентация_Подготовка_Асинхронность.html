<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><title>‚ö° –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –∏ WebSocket: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ GraphQL Subscriptions</title><link rel="stylesheet" href="../15-16/css/reveal.min.css"><link rel="stylesheet" href="../15-16/css/black.min.css"><link rel="stylesheet" href="../15-16/css/monokai.min.css"><style>.reveal .slides{width:80%!important;height:90%!important;transform:scale(1.2)!important;position:absolute!important;left:50%!important;top:0!important;transform:translateX(calc(-50% + 5%)) scale(1.2)!important;transform-origin:top center!important}.reveal h1{font-size:1.8em!important;margin-top:0!important;margin-bottom:.4em!important}.reveal h2{font-size:0.75em!important;margin-top:0!important;margin-bottom:.4em!important;text-transform:none!important;text-align:right!important;margin-right:10%!important}.reveal h3{font-size:1.1em!important;margin-top:0!important;margin-bottom:.3em!important;text-transform:none!important}.reveal .slides section{padding:15px!important;font-size:1em!important}.reveal p,.reveal ul,.reveal ol{font-size:.9em!important}pre code{font-size:.975em;max-height:none;overflow:hidden}pre{max-height:none;overflow:hidden;margin:10px 0!important}table{font-size:.75em!important}.fragment{opacity:0;transition:opacity .5s}.fragment.visible{opacity:1}</style></head><body><div class="reveal"><div class="slides">

<section data-background-color="#1a1a2e"><div style="background:rgba(22,33,62,0.9);padding:40px;border:8px solid #0f3460"><h1 style="color:#FFD700">‚ö° –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –∏ WebSocket</h1><h2 style="color:#90EE90">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ</h2><p style="color:#FFF;font-size:1em">GraphQL Subscriptions —Å WebSocket –∏ Redis</p><p style="color:#FFF;font-size:0.9em;margin-top:20px">üè´ –ú–ü–ì–£, 4 –∫—É—Ä—Å, 2025</p></div></section>

<section data-background-color="#16213e"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 2: –ü–ª–∞–Ω –∑–∞–Ω—è—Ç–∏—è</h2><div style="text-align:left;font-size:.7em"><ul style="margin-left:40px"><li>üîå <strong>–°–æ–∫–µ—Ç—ã</strong> - –æ—Å–Ω–æ–≤—ã —Å–µ—Ç–µ–≤–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è</li><li>‚ö° <strong>–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å</strong> - –ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ</li><li>üêç <strong>asyncio</strong> - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Python</li><li>üåê <strong>aiohttp</strong> - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç/—Å–µ—Ä–≤–µ—Ä</li><li>üîÑ <strong>AsyncIterator</strong> - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∏—Ç–µ—Ä–∞—Ç–æ—Ä—ã</li><li>üéØ <strong>asyncio.gather</strong> - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</li><li>üí° <strong>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã</strong></li></ul></div></section>

<section data-background-color="#2c3e50"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 3: –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–æ–∫–µ—Ç—ã?</h2><div style="text-align:left;font-size:.7em"><p style="margin-left:20px"><strong>–°–æ–∫–µ—Ç</strong> = –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–µ—Ç–µ–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è</p><pre><code class="language-text">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Python)
       ‚Üì
    –°–æ–∫–µ—Ç—ã (API)
       ‚Üì
   TCP/UDP (–û–°)
       ‚Üì
    IP (–û–°)
       ‚Üì
   –°–µ—Ç–µ–≤–∞—è –∫–∞—Ä—Ç–∞</code></pre><p style="margin-left:20px;margin-top:10px"><strong>–ê–Ω–∞–ª–æ–≥–∏—è:</strong> –°–æ–∫–µ—Ç = —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–∞—è —Ä–æ–∑–µ—Ç–∫–∞ –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º</p></div></section>

<section data-background-color="#16213e"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 4: –ó–∞—á–µ–º –Ω—É–∂–Ω—ã —Å–æ–∫–µ—Ç—ã?</h2><div style="text-align:left;font-size:.7em"><p style="margin-left:20px"><strong style="color:#2ecc71">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</strong></p><ul style="margin-left:40px"><li>‚úÖ <strong>–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø</strong> –∫ —Å–µ—Ç–µ–≤–æ–º—É —Å—Ç–µ–∫—É –û–°</li><li>‚úÖ <strong>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã</strong></li><li>‚úÖ <strong>–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å</strong> –Ω–∞–¥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º</li><li>‚úÖ <strong>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π API</strong> –¥–ª—è –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤/–û–°</li></ul><p style="margin-left:20px;margin-top:15px"><strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:</strong></p><ul style="margin-left:40px"><li>HTTP-—Å–µ—Ä–≤–µ—Ä—ã (FastAPI, Flask –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º)</li><li>WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</li><li>TCP/UDP –∫–ª–∏–µ–Ω—Ç—ã –∏ —Å–µ—Ä–≤–µ—Ä—ã</li><li>–ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Å–µ—Ç—å—é</li></ul></div></section>

<section data-background-color="#2c3e50"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 5: –ö–æ—Ä—É—Ç–∏–Ω—ã (Coroutines)</h2><div style="text-align:left;font-size:.7em"><p style="margin-left:20px"><strong>–ö–æ—Ä—É—Ç–∏–Ω–∞</strong> = —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</p><pre><code class="language-python"># –û–±—ã—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
def normal_function():
    return "Hello"

# –ö–æ—Ä—É—Ç–∏–Ω–∞ (async —Ñ—É–Ω–∫—Ü–∏—è)
async def coroutine_function():
    await asyncio.sleep(1)  # –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    return "Hello"</code></pre><p style="margin-left:20px;margin-top:10px"><strong>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</strong></p><ul style="margin-left:40px"><li><code>async def</code> - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ—Ä—É—Ç–∏–Ω—É</li><li><code>await</code> - –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∂–¥–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç</li><li><code>asyncio.run()</code> - –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ—Ä—É—Ç–∏–Ω—É –≤ Event Loop</li></ul></div></section>

<section data-background-color="#16213e"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 6: async/await —Å–∏–Ω—Ç–∞–∫—Å–∏—Å</h2><div style="text-align:left;font-size:.65em"><pre><code class="language-python">import asyncio

# –ö–æ—Ä—É—Ç–∏–Ω–∞ 1
async def fetch_data(url):
    await asyncio.sleep(1)  # –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞
    return f"Data from {url}"

# –ö–æ—Ä—É—Ç–∏–Ω–∞ 2
async def main():
    # await - –∂–¥–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    result = await fetch_data("http://api.com")
    print(result)

# –ó–∞–ø—É—Å–∫
asyncio.run(main())</code></pre><p style="margin-left:20px;margin-top:10px"><strong>–í–∞–∂–Ω–æ:</strong></p><ul style="margin-left:40px"><li><code>await</code> –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ <code>async def</code></li><li><code>await</code> –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–µ—Å—å –ø–æ—Ç–æ–∫, —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â—É—é –∫–æ—Ä—É—Ç–∏–Ω—É</li></ul></div></section>

<section data-background-color="#2c3e50"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 7: asyncio - –æ—Å–Ω–æ–≤—ã</h2><div style="text-align:left;font-size:.7em"><p style="margin-left:20px"><strong>asyncio</strong> = –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Python</p><pre><code class="language-python">import asyncio

# –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
async def my_task():
    print("–í—ã–ø–æ–ª–Ω—è—é –∑–∞–¥–∞—á—É...")
    await asyncio.sleep(1)
    return "–ì–æ—Ç–æ–≤–æ!"

# –ó–∞–ø—É—Å–∫
result = asyncio.run(my_task())</code></pre><p style="margin-left:20px;margin-top:10px"><strong>–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:</strong></p><ul style="margin-left:40px"><li><code>asyncio.run()</code> - –∑–∞–ø—É—Å–∫ Event Loop</li><li><code>asyncio.sleep()</code> - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞</li><li><code>asyncio.gather()</code> - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</li><li><code>asyncio.create_task()</code> - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</li></ul></div></section>

<section data-background-color="#16213e"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 8: asyncio.sleep vs time.sleep</h2><div style="text-align:left;font-size:.65em"><pre><code class="language-python">import asyncio
import time

# ‚ùå –ë–õ–û–ö–ò–†–£–ï–¢ –≤–µ—Å—å –ø–æ—Ç–æ–∫
def blocking_sleep():
    time.sleep(1)  # –í—Å–µ –∂–¥—É—Ç!

# ‚úÖ –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏
async def non_blocking_sleep():
    await asyncio.sleep(1)  # Event Loop —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥—Ä—É–≥–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏</code></pre><p style="margin-left:20px;margin-top:10px"><strong>–†–∞–∑–Ω–∏—Ü–∞:</strong></p><pre><code class="language-python"># –° time.sleep - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (2 —Å–µ–∫—É–Ω–¥—ã)
async def bad():
    time.sleep(1)
    time.sleep(1)

# –° asyncio.sleep - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (1 —Å–µ–∫—É–Ω–¥–∞)
async def good():
    await asyncio.gather(
        asyncio.sleep(1),
        asyncio.sleep(1)
    )</code></pre></div></section>

<section data-background-color="#2c3e50"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 9: asyncio.gather - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</h2><div style="text-align:left;font-size:.65em"><p style="margin-left:20px"><strong>gather</strong> = –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ—Ä—É—Ç–∏–Ω –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ</p><pre><code class="language-python">import asyncio

async def fetch_user(id):
    await asyncio.sleep(0.5)  # –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î
    return f"User {id}"

async def main():
    # ‚ùå –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (1.5 —Å–µ–∫—É–Ω–¥—ã)
    user1 = await fetch_user(1)
    user2 = await fetch_user(2)
    user3 = await fetch_user(3)
    
    # ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (0.5 —Å–µ–∫—É–Ω–¥—ã)
    users = await asyncio.gather(
        fetch_user(1),
        fetch_user(2),
        fetch_user(3)
    )
    # users = ["User 1", "User 2", "User 3"]</code></pre></div></section>

<section data-background-color="#16213e"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 10: asyncio.gather - –ø—Ä–∏–º–µ—Ä</h2><div style="text-align:left;font-size:.65em"><pre><code class="language-python">import asyncio
import aiohttp

async def fetch_url(session, url):
    async with session.get(url) as response:
        return await response.text()

async def main():
    urls = [
        "http://api1.com",
        "http://api2.com",
        "http://api3.com"
    ]
    
    async with aiohttp.ClientSession() as session:
        # –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ!
        results = await asyncio.gather(
            *[fetch_url(session, url) for url in urls]
        )
    
    print(results)  # –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ—Ç–æ–≤—ã

asyncio.run(main())</code></pre><p style="margin-left:20px;margin-top:10px"><strong style="color:#2ecc71">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:</strong> 3 –∑–∞–ø—Ä–æ—Å–∞ –∑–∞ –≤—Ä–µ–º—è 1 –∑–∞–ø—Ä–æ—Å–∞!</p></div></section>

<section data-background-color="#2c3e50"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 11: AsyncIterator - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∏—Ç–µ—Ä–∞—Ç–æ—Ä—ã</h2><div style="text-align:left;font-size:.65em"><p style="margin-left:20px"><strong>AsyncIterator</strong> = –∏—Ç–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ</p><pre><code class="language-python">from typing import AsyncIterator

# –û–±—ã—á–Ω—ã–π –∏—Ç–µ—Ä–∞—Ç–æ—Ä (–±–ª–æ–∫–∏—Ä—É—é—â–∏–π)
def normal_iterator():
    for i in range(10):
        yield i  # –ë–ª–æ–∫–∏—Ä—É–µ—Ç

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∏—Ç–µ—Ä–∞—Ç–æ—Ä (–Ω–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏–π)
async def async_iterator() -> AsyncIterator[int]:
    for i in range(10):
        await asyncio.sleep(0.1)  # –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º Event Loop!
        yield i

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
async def main():
    async for value in async_iterator():
        print(value)  # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ –º–µ—Ä–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è</code></pre></div></section>

<section data-background-color="#16213e"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 12: AsyncIterator –≤ GraphQL Subscriptions</h2><div style="text-align:left;font-size:.65em"><p style="margin-left:20px"><strong style="color:#2ecc71">GraphQL Subscriptions –∏—Å–ø–æ–ª—å–∑—É—é—Ç AsyncIterator!</strong></p><pre><code class="language-python">from typing import AsyncIterator
import strawberry

@strawberry.type
class Subscription:
    @strawberry.subscription
    async def message_added(self) -> AsyncIterator[MessageType]:
        # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∫–∞–Ω–∞–ª
        async for message_data in pubsub.subscribe("messages"):
            # yield –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ WebSocket
            yield MessageType(**message_data)</code></pre><p style="margin-left:20px;margin-top:10px"><strong>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong></p><ol style="margin-left:40px"><li>–ö–ª–∏–µ–Ω—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket</li><li><code>async for</code> –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ pub/sub</li><li><code>yield</code> –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –∫–ª–∏–µ–Ω—Ç—É</li><li>Event Loop –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è!</li></ol></div></section>

<section data-background-color="#2c3e50"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 13: aiohttp - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP</h2><div style="text-align:left;font-size:.65em"><p style="margin-left:20px"><strong>aiohttp</strong> = –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è HTTP –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞</p><pre><code class="language-python">import aiohttp
import asyncio

# HTTP –ö–ª–∏–µ–Ω—Ç
async def fetch_data():
    async with aiohttp.ClientSession() as session:
        async with session.get('http://api.com/data') as response:
            data = await response.json()
            return data

# HTTP –°–µ—Ä–≤–µ—Ä
from aiohttp import web

async def handler(request):
    return web.Response(text="Hello, aiohttp!")

app = web.Application()
app.router.add_get('/', handler)
web.run_app(app, port=8080)</code></pre><p style="margin-left:20px;margin-top:10px"><strong style="color:#2ecc71">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</strong> –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç Event Loop!</p></div></section>

<section data-background-color="#16213e"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 14: aiohttp vs requests</h2><div style="text-align:left;font-size:.65em"><pre><code class="language-python"># ‚ùå requests - –±–ª–æ–∫–∏—Ä—É—é—â–∏–π
import requests

def blocking_requests():
    response1 = requests.get('http://api1.com')  # ‚è∏Ô∏è –ñ–¥–µ–º
    response2 = requests.get('http://api2.com')  # ‚è∏Ô∏è –ñ–¥–µ–º
    response3 = requests.get('http://api3.com')  # ‚è∏Ô∏è –ñ–¥–µ–º
    # –í—Ä–µ–º—è: 3 —Å–µ–∫—É–Ω–¥—ã

# ‚úÖ aiohttp - –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π
import aiohttp

async def non_blocking_requests():
    async with aiohttp.ClientSession() as session:
        results = await asyncio.gather(
            session.get('http://api1.com'),
            session.get('http://api2.com'),
            session.get('http://api3.com')
        )
    # –í—Ä–µ–º—è: 1 —Å–µ–∫—É–Ω–¥–∞ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ!)</code></pre></div></section>

<section data-background-color="#2c3e50"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 15: aiohttp WebSocket —Å–µ—Ä–≤–µ—Ä</h2><div style="text-align:left;font-size:.65em"><p style="margin-left:20px"><strong>WebSocket</strong> = –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è real-time –æ–±—â–µ–Ω–∏—è</p><pre><code class="language-python">from aiohttp import web

async def websocket_handler(request):
    ws = web.WebSocketResponse()
    await ws.prepare(request)  # –ü–æ–¥–Ω–∏–º–∞–µ–º WebSocket
    
    async for msg in ws:
        if msg.type == web.MsgType.text:
            # –ü–æ–ª—É—á–∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
            await ws.send_str(f"Echo: {msg.data}")
        elif msg.type == web.MsgType.error:
            break
    
    return ws

app = web.Application()
app.router.add_get('/ws', websocket_handler)
web.run_app(app, port=8080)</code></pre><p style="margin-left:20px;margin-top:10px"><strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:</strong> GraphQL Subscriptions —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ WebSocket!</p></div></section>

<section data-background-color="#16213e"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 16: WebSocket –∫–ª–∏–µ–Ω—Ç (aiohttp)</h2><div style="text-align:left;font-size:.65em"><pre><code class="language-python">import aiohttp
import asyncio

async def websocket_client():
    async with aiohttp.ClientSession() as session:
        async with session.ws_connect('ws://localhost:8080/ws') as ws:
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            await ws.send_str("Hello, Server!")
            
            # –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            async for msg in ws:
                if msg.type == aiohttp.WSMsgType.TEXT:
                    print(f"–ü–æ–ª—É—á–µ–Ω–æ: {msg.data}")
                elif msg.type == aiohttp.WSMsgType.ERROR:
                    break

asyncio.run(websocket_client())</code></pre><p style="margin-left:20px;margin-top:10px"><strong>–í–∞–∂–Ω–æ:</strong> <code>async for</code> –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏!</p></div></section>

<section data-background-color="#2c3e50"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 17: Pub/Sub –ø–∞—Ç—Ç–µ—Ä–Ω</h2><div style="text-align:left;font-size:.7em"><p style="margin-left:20px"><strong>Pub/Sub (Publish/Subscribe)</strong> = –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–±—ã—Ç–∏–π</p><pre><code class="language-text">Publisher (–ò–∑–¥–∞—Ç–µ–ª—å)          Subscribers (–ü–æ–¥–ø–∏—Å—á–∏–∫–∏)
     ‚îÇ                              ‚îÇ
     ‚îÇ  publish("messages", data)   ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
     ‚îÇ                              ‚îÇ
     ‚îÇ                              ‚îú‚îÄ‚Üí –ö–ª–∏–µ–Ω—Ç 1 –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ
     ‚îÇ                              ‚îÇ
     ‚îÇ                              ‚îú‚îÄ‚Üí –ö–ª–∏–µ–Ω—Ç 2 –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ
     ‚îÇ                              ‚îÇ
     ‚îÇ                              ‚îî‚îÄ‚Üí –ö–ª–∏–µ–Ω—Ç 3 –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ</code></pre><p style="margin-left:20px;margin-top:10px"><strong>–í GraphQL Subscriptions:</strong></p><ul style="margin-left:40px"><li>–ú—É—Ç–∞—Ü–∏—è = Publisher (–ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ)</li><li>Subscription = Subscriber (–ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è)</li></ul></div></section>

<section data-background-color="#16213e"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 18: Pub/Sub —Å AsyncIterator</h2><div style="text-align:left;font-size:.65em"><pre><code class="language-python">import asyncio
from typing import AsyncIterator

class PubSubManager:
    def __init__(self):
        self.subscribers = {}
    
    async def subscribe(self, channel: str) -> AsyncIterator[dict]:
        queue = asyncio.Queue()
        self.subscribers.setdefault(channel, []).append(queue)
        
        try:
            while True:
                # async for –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏
                message = await queue.get()
                yield message  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫—É
        finally:
            # –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏
            self.subscribers[channel].remove(queue)
    
    async def publish(self, channel: str, message: dict):
        for queue in self.subscribers.get(channel, []):
            await queue.put(message)  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º</code></pre></div></section>

<section data-background-color="#2c3e50"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 19: –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä: Pub/Sub + AsyncIterator</h2><div style="text-align:left;font-size:.65em"><pre><code class="language-python">import asyncio
from typing import AsyncIterator

pubsub = PubSubManager()

# –ü–æ–¥–ø–∏—Å—á–∏–∫ (GraphQL Subscription)
async def subscriber():
    async for event in pubsub.subscribe("messages"):
        print(f"–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ: {event}")

# –ò–∑–¥–∞—Ç–µ–ª—å (GraphQL Mutation)
async def publisher():
    await asyncio.sleep(1)
    await pubsub.publish("messages", {"id": 1, "text": "Hello!"})

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
async def main():
    await asyncio.gather(
        subscriber(),  # –ñ–¥–µ—Ç —Å–æ–±—ã—Ç–∏—è
        publisher()    # –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ
    )

asyncio.run(main())
# –í—ã–≤–æ–¥: –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ: {'id': 1, 'text': 'Hello!'}</code></pre></div></section>

<section data-background-color="#16213e"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 20: asyncio.Queue - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å</h2><div style="text-align:left;font-size:.65em"><p style="margin-left:20px"><strong>Queue</strong> = –æ—á–µ—Ä–µ–¥—å –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ—Ä—É—Ç–∏–Ω–∞–º–∏</p><pre><code class="language-python">import asyncio

async def producer(queue):
    for i in range(5):
        await queue.put(f"Item {i}")
        await asyncio.sleep(0.5)
    await queue.put(None)  # –°–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

async def consumer(queue):
    while True:
        item = await queue.get()
        if item is None:
            break
        print(f"–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {item}")

async def main():
    queue = asyncio.Queue()
    await asyncio.gather(
        producer(queue),
        consumer(queue)
    )

asyncio.run(main())</code></pre><p style="margin-left:20px;margin-top:10px"><strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:</strong> –í Pub/Sub –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–±—ã—Ç–∏–π!</p></div></section>

<section data-background-color="#2c3e50"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 21: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ async –∫–æ–¥–µ</h2><div style="text-align:left;font-size:.65em"><pre><code class="language-python">import asyncio

async def risky_task():
    await asyncio.sleep(1)
    raise ValueError("–û—à–∏–±–∫–∞!")

# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
async def main():
    try:
        await risky_task()
    except ValueError as e:
        print(f"–ü–æ–π–º–∞–ª–∏ –æ—à–∏–±–∫—É: {e}")

# ‚úÖ –í asyncio.gather
async def main():
    results = await asyncio.gather(
        task1(),
        task2(),
        return_exceptions=True  # –ù–µ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ
    )
    for result in results:
        if isinstance(result, Exception):
            print(f"–û—à–∏–±–∫–∞: {result}")
        else:
            print(f"–£—Å–ø–µ—Ö: {result}")</code></pre></div></section>

<section data-background-color="#16213e"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 22: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: WebSocket —Å–µ—Ä–≤–µ—Ä</h2><div style="text-align:left;font-size:.6em"><pre><code class="language-python">from aiohttp import web
import asyncio

pubsub = PubSubManager()

async def websocket_handler(request):
    ws = web.WebSocketResponse()
    await ws.prepare(request)
    
    # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∫–∞–Ω–∞–ª —á–µ—Ä–µ–∑ AsyncIterator
    async for event in pubsub.subscribe("messages"):
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ WebSocket
        await ws.send_json(event)
    
    return ws

async def create_message():
    # –ò–º–∏—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
    await asyncio.sleep(2)
    await pubsub.publish("messages", {
        "id": 1,
        "text": "–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!"
    })

app = web.Application()
app.router.add_get('/ws', websocket_handler)

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ñ–æ–Ω–µ
asyncio.create_task(create_message())

web.run_app(app, port=8080)</code></pre></div></section>

<section data-background-color="#2c3e50"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 23: –°–≤—è–∑—å —Å GraphQL Subscriptions</h2><div style="text-align:left;font-size:.65em"><p style="margin-left:20px"><strong>–ö–∞–∫ –≤—Å–µ —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ:</strong></p><pre><code class="language-python"># 1. Pub/Sub –º–µ–Ω–µ–¥–∂–µ—Ä (asyncio.Queue)
pubsub = PubSubManager()

# 2. GraphQL Subscription (AsyncIterator)
@strawberry.subscription
async def message_added(self) -> AsyncIterator[MessageType]:
    async for message_data in pubsub.subscribe("messages"):
        yield MessageType(**message_data)

# 3. GraphQL Mutation (Publisher)
@strawberry.mutation
async def create_message(self, text: str):
    new_message = await create_in_db(text)
    # –ü—É–±–ª–∏–∫—É–µ–º —Å–æ–±—ã—Ç–∏–µ
    await pubsub.publish("messages", new_message.to_dict())
    return new_message

# 4. WebSocket (aiohttp/FastAPI)
# GraphQL Subscriptions —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ WebSocket!</code></pre></div></section>

<section data-background-color="#16213e"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 24: –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã</h2><div style="text-align:left;font-size:.7em"><p style="margin-left:20px"><strong style="color:#2ecc71">–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:</strong></p><ul style="margin-left:40px"><li>‚úÖ <strong>asyncio</strong> - –æ—Å–Ω–æ–≤–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ Python</li><li>‚úÖ <strong>async/await</strong> - —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –∫–æ—Ä—É—Ç–∏–Ω</li><li>‚úÖ <strong>AsyncIterator</strong> - –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö</li><li>‚úÖ <strong>asyncio.gather</strong> - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</li><li>‚úÖ <strong>aiohttp</strong> - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP/WebSocket</li><li>‚úÖ <strong>asyncio.Queue</strong> - –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ—Ä—É—Ç–∏–Ω–∞–º–∏</li><li>‚úÖ <strong>Pub/Sub</strong> - –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —Å–æ–±—ã—Ç–∏–π</li><li>‚úÖ <strong>WebSocket</strong> - real-time —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</li></ul><p style="margin-left:20px;margin-top:10px"><strong>–í GraphQL Subscriptions:</strong></p><ul style="margin-left:40px"><li>Subscription = AsyncIterator</li><li>WebSocket = —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</li><li>Pub/Sub = –º–µ—Ö–∞–Ω–∏–∑–º —Å–æ–±—ã—Ç–∏–π</li></ul></div></section>

<section data-background-color="#2c3e50"><h2 style="color:#FFD700">–°–ª–∞–π–¥ 25: –ß—Ç–æ –¥–∞–ª—å—à–µ?</h2><div style="text-align:left;font-size:.7em"><p style="margin-left:20px"><strong>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞:</strong></p><ol style="margin-left:40px"><li>–°–æ–∑–¥–∞–¥–∏–º Pub/Sub –º–µ–Ω–µ–¥–∂–µ—Ä —Å <code>asyncio.Queue</code></li><li>–†–µ–∞–ª–∏–∑—É–µ–º GraphQL Subscriptions —Å <code>AsyncIterator</code></li><li>–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º WebSocket —á–µ—Ä–µ–∑ FastAPI/Strawberry</li><li>–î–æ–±–∞–≤–∏–º Redis –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è</li></ol><p style="margin-left:20px;margin-top:15px"><strong>–ü–æ–º–Ω–∏—Ç–µ:</strong></p><ul style="margin-left:40px"><li><code>async def</code> - –∫–æ—Ä—É—Ç–∏–Ω–∞</li><li><code>await</code> - –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç Event Loop</li><li><code>async for</code> - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è</li><li><code>asyncio.gather()</code> - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</li><li><code>yield</code> –≤ AsyncIterator - –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç—É</li></ul><p style="margin-left:20px;margin-top:15px;color:#FFD700;font-size:1.1em"><strong>–£–¥–∞—á–∏ –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ! üéâ</strong></p></div></section>

</div></div><script src="../15-16/js/reveal.min.js"></script><script src="../15-16/js/notes.min.js"></script><script src="../15-16/js/markdown.min.js"></script><script src="../15-16/js/highlight.min.js"></script><script>Reveal.initialize({hash:true,transition:'slide',controls:true,progress:true,slideNumber:true,center:false,margin:0.02,plugins:[RevealMarkdown,RevealHighlight,RevealNotes]});</script></body></html>

