<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è: GraphQL —Å FastAPI</title>
<style media="print">
body{font-family:Arial,sans-serif;font-size:12px}.container{box-shadow:none;background:white}.header{background:white!important;color:black!important}.save-btn{display:none!important}.section{page-break-inside:avoid}
</style>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',sans-serif;line-height:1.6;color:#333;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh}.container{max-width:1200px;margin:20px auto;padding:20px;background:white;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.2)}.header{text-align:center;padding:30px;background:linear-gradient(135deg,#005EB8,#003D82);color:white;border-radius:10px;margin-bottom:30px}.header h1{font-size:2.5em;margin-bottom:10px}.student-info{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;margin-bottom:30px;padding:20px;background:#f8f9fa;border-radius:10px}.form-group{margin-bottom:20px}.form-group label{display:block;margin-bottom:5px;font-weight:bold;color:#003D82}.form-group input,.form-group textarea{width:100%;padding:12px;border:2px solid #e1e5e9;border-radius:8px;font-size:16px}.form-group input:focus,.form-group textarea:focus{outline:none;border-color:#005EB8}.section{margin-bottom:40px;padding:25px;background:#fff;border-left:5px solid #005EB8;border-radius:0 10px 10px 0;box-shadow:0 2px 10px rgba(0,0,0,0.1)}.section h2{color:#003D82;margin-bottom:20px;font-size:1.8em}.section h3{color:#005EB8;margin:20px 0 10px;font-size:1.3em}.code-block{background:#282c34;color:#e2e8f0;padding:20px;border-radius:8px;margin:15px 0;font-family:'Courier New',monospace;overflow-x:auto;white-space:pre;font-size:14px}.code-block.editable{background:#1e1e1e;border:2px solid #005EB8;position:relative}.code-block.editable:before{content:'‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π –∫–æ–¥';position:absolute;top:-10px;right:10px;background:#005EB8;color:white;padding:2px 8px;border-radius:4px;font-size:12px}.code-block textarea{width:100%;height:auto;min-height:100px;background:transparent;border:none;color:#e2e8f0;font-family:'Courier New',monospace;font-size:14px;resize:vertical;outline:none}.code-textarea-large{min-height:1600px!important}.code-block .editor-container{position:relative}.code-block .editor-container textarea{position:absolute;top:0;left:0;z-index:2;background:transparent;color:transparent;caret-color:#e2e8f0}.code-block .editor-container pre{margin:0;z-index:1;pointer-events:none}ul{list-style:none;padding-left:0}ul li{padding:8px 0 8px 30px;position:relative}ul li::before{content:'‚ñ∏';position:absolute;left:0;color:#005EB8;font-size:18px}.save-btn{background:linear-gradient(135deg,#005EB8,#003D82);color:white;border:none;padding:15px 30px;font-size:18px;border-radius:10px;cursor:pointer;display:block;margin:30px auto}.checkbox-item{margin:15px 0;padding:15px 20px;background:linear-gradient(135deg,#005EB8,#003D82);border-radius:10px;display:flex;align-items:center}.checkbox-item input[type="checkbox"]{appearance:none;width:24px;height:24px;border:3px solid white;border-radius:6px;margin-right:15px;cursor:pointer;background:transparent}.checkbox-item input[type="checkbox"]:checked{background:white}.checkbox-item input[type="checkbox"]:checked::after{content:'‚úì';position:absolute;font-size:18px;color:#005EB8;font-weight:bold}.checkbox-item label{color:white;font-weight:500;cursor:pointer}table{width:100%;border-collapse:collapse;margin:15px 0}table th,table td{border:1px solid #ddd;padding:12px;text-align:left}table th{background:#005EB8;color:white}table tr:nth-child(even){background:#f8f9fa}.diagram{background:#f8f9fa;padding:20px;border-radius:8px;margin:15px 0;font-family:monospace;white-space:pre;overflow-x:auto}.note{background:#e3f2fd;border-left:4px solid #2196f3;padding:15px;margin:15px 0;border-radius:0 8px 8px 0}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
</head>
<body>
<div class="container">
<div class="header">
<h1>üöÄ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞</h1>
<h2>–ò–∑—É—á–µ–Ω–∏–µ GraphQL —Å FastAPI</h2>
<p>GraphQL API –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ —Å PostgreSQL</p>
</div>

<div class="student-info">
<div class="form-group"><label for="student-name">–§–ò–û:</label><input type="text" id="student-name"></div>
<div class="form-group"><label for="group">–ì—Ä—É–ø–ø–∞:</label><input type="text" id="group"></div>
<div class="form-group"><label for="date">–î–∞—Ç–∞:</label><input type="date" id="date"></div>
</div>

<div class="section">
<h2>üéØ –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã</h2>
<p>–ò–∑—É—á–∏—Ç—å –æ—Å–Ω–æ–≤—ã GraphQL, —Å–æ–∑–¥–∞—Ç—å API –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∑–∞–ø—Ä–æ—Å–æ–≤, –º—É—Ç–∞—Ü–∏–π –∏ —Ä–∞–±–æ—Ç—ã —Å PostgreSQL. –û—Å–≤–æ–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–æ–ª–≤–µ—Ä–æ–≤, —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å FastAPI.</p>
</div>

<div class="section">
<h2>üìã –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–µ–Ω–¥–∞</h2>
<h3>1.1 Docker Compose</h3>
<div class="code-block"><code class="language-yaml">services:
  postgres:
    image: postgres:18
    container_name: postgres_graphql
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: messenger_channel
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql
      - ./sql.sql:/docker-entrypoint-initdb.d/init.sql
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  postgres_data:</code></div>

<h3>1.2 –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</h3>
<p>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–∏—Å—Ç–µ–º—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ —Å —Ç—Ä–µ–º—è –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏:</p>
<ul>
<li><strong>users</strong> - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä–æ—Ñ–∏–ª—è</li>
<li><strong>messages</strong> - —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π</li>
<li><strong>comments</strong> - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å–æ–æ–±—â–µ–Ω–∏—è–º —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏</li>
</ul>

<div class="diagram">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     users       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ PK id           ‚îÇ INTEGER (GENERATED ALWAYS AS IDENTITY)
‚îÇ UQ username     ‚îÇ VARCHAR(100) NOT NULL
‚îÇ    profile      ‚îÇ JSONB
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ 1:N
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    messages     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ PK id           ‚îÇ INTEGER (GENERATED ALWAYS AS IDENTITY)
‚îÇ FK author_id    ‚îÇ INTEGER ‚Üí users.id (ON DELETE CASCADE)
‚îÇ    title        ‚îÇ VARCHAR(200)
‚îÇ    content      ‚îÇ TEXT NOT NULL
‚îÇ    metadata     ‚îÇ JSONB
‚îÇ    stats        ‚îÇ JSONB
‚îÇ    created_at   ‚îÇ TIMESTAMP (DEFAULT CURRENT_TIMESTAMP)
‚îÇ    updated_at   ‚îÇ TIMESTAMP (DEFAULT CURRENT_TIMESTAMP)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ 1:N
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    comments     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ PK id           ‚îÇ INTEGER (GENERATED ALWAYS AS IDENTITY)
‚îÇ FK message_id   ‚îÇ INTEGER ‚Üí messages.id (ON DELETE CASCADE)
‚îÇ FK author_id    ‚îÇ INTEGER ‚Üí users.id (ON DELETE CASCADE)
‚îÇ FK parent_comment_id‚îÇ INTEGER ‚Üí comments.id (ON DELETE CASCADE)
‚îÇ    content      ‚îÇ TEXT NOT NULL
‚îÇ    metadata     ‚îÇ JSONB
‚îÇ    reactions    ‚îÇ JSONB
‚îÇ    created_at   ‚îÇ TIMESTAMP (DEFAULT CURRENT_TIMESTAMP)
‚îÇ    updated_at   ‚îÇ TIMESTAMP (DEFAULT CURRENT_TIMESTAMP)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>

<h3>1.3 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π</h3>
<div class="code-block"><code class="language-bash">fastapi[all]
strawberry-graphql[fastapi]
sqlalchemy[asyncio]
asyncpg
pydantic-settings
psycopg2-binary
uvicorn[standard]</code></div>

<h3>1.4 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è</h3>
<div class="code-block"><code class="language-bash">wsl
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ uv (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
curl -LsSf https://astral.sh/uv/install.sh | sh
export PATH="$HOME/.cargo/bin:$PATH"

# 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
uv venv ~/.venv/laba-graphql

# 3. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
source ~/.venv/laba-graphql/bin/activate
cd /mnt/c/W26/project/mpgu_practice/LABA-GRAPHQL
uv pip install -r requirements.txt</code></div>

<div class="checkbox-item"><input type="checkbox" id="t1"><label for="t1">–°—Ç–µ–Ω–¥ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</label></div>
</div>

<div class="section">
<h2>üöÄ –®–∞–≥ 2: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ FastAPI-GraphQL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
<p>–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ —Å–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É GraphQL API —Å FastAPI. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–µ–π—à—É—é —Å—Ö–µ–º—É –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã.</p>

<h3>2.1 main.py</h3>
<div class="code-block"><code class="language-python">from fastapi import FastAPI
from strawberry.fastapi import GraphQLRouter
from schema import schema

# –°–æ–∑–¥–∞–µ–º GraphQL —Ä–æ—É—Ç–µ—Ä
graphql_app = GraphQLRouter(schema)

# –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ FastAPI
app = FastAPI(title="Messenger Channel GraphQL API")

# –ü–æ–¥–∫–ª—é—á–∞–µ–º GraphQL —ç–Ω–¥–ø–æ–∏–Ω—Ç
app.include_router(graphql_app, prefix="/graphql")

# Health check
@app.get("/")
async def root():
    return {"message": "GraphQL API –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ /graphql"}

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)</code></div>

<h3>2.2 database.py</h3>
<p>–§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL —á–µ—Ä–µ–∑ SQLAlchemy —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.</p>
<div class="code-block"><code class="language-python">import os
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession
from sqlalchemy.orm import sessionmaker

DATABASE_URL = os.getenv(
    "DATABASE_URL",
    "postgresql+asyncpg://postgres:postgres@localhost:5432/messenger_channel"
)

engine = create_async_engine(DATABASE_URL, echo=False)
AsyncSessionLocal = sessionmaker(
    engine, class_=AsyncSession, expire_on_commit=False
)

async def get_db() -> AsyncSession:
    async with AsyncSessionLocal() as session:
        yield session</code></div>

<h3>2.3 schema.py</h3>
<p>–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç GraphQL —Å—Ö–µ–º—É —Å –±–∞–∑–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, Query –∏ Mutation –∫–ª–∞—Å—Å–∞–º–∏.</p>
<div class="code-block"><code class="language-python">from __future__ import annotations
import strawberry
from typing import Any
from datetime import datetime

# –°–∫–∞–ª—è—Ä–Ω—ã–π —Ç–∏–ø –¥–ª—è JSONB –ø–æ–ª–µ–π
JSON = strawberry.scalar(
    Any,
    serialize=lambda v: v,
    parse_value=lambda v: v,
)

@strawberry.type
class UserType:
    id: int
    username: str
    profile: JSON | None = None

@strawberry.type
class MessageType:
    id: int
    author_id: int
    title: str | None = None
    content: str
    metadata: JSON | None = None
    stats: JSON | None = None
    created_at: datetime
    updated_at: datetime

# Query –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
@strawberry.type
class Query:
    @strawberry.field
    def hello(self) -> str:
        return "Hello, GraphQL!"

# Mutation –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
@strawberry.type
class Mutation:
    @strawberry.mutation
    def test_mutation(self) -> str:
        return "Mutation works!"

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã
schema = strawberry.Schema(query=Query, mutation=Mutation)</code></div>

<h3>2.4 –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞</h3>
<div class="code-block"><code class="language-bash">python main.py</code></div>

<div class="checkbox-item"><input type="checkbox" id="t2"><label for="t2">–ë–∞–∑–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ</label></div>
</div>

<div class="section">
<h2>üîß –®–∞–≥ 3: –ü–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ CRUD-GraphQL</h2>
<p>–†–∞—Å—à–∏—Ä—è–µ–º –±–∞–∑–æ–≤—É—é —Å—Ö–µ–º—É, –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –ë–î. –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–æ–ª–≤–µ—Ä—ã –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ PostgreSQL.</p>

<h3>3.1 –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π main.py</h3>
<div class="code-block"><code class="language-python">from fastapi import FastAPI
from strawberry.fastapi import GraphQLRouter
from models_graphql import schema

# –°–æ–∑–¥–∞–µ–º GraphQL —Ä–æ—É—Ç–µ—Ä —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º GraphQL IDE
graphql_app = GraphQLRouter(
    schema,
    graphql_ide="graphiql",  # –í–∫–ª—é—á–∞–µ—Ç GraphQL Playground
)

app = FastAPI(
    title="Messenger Channel API",
    description="GraphQL API –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞",
    version="1.0.0",
)

app.include_router(graphql_app, prefix="/graphql")

@app.get("/")
async def root():
    return {
        "message": "API –¥–æ—Å—Ç—É–ø–µ–Ω",
        "graphql": "/graphql",
        "graphql_playground": "/graphql (–æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)",
    }</code></div>

<h3>3.2 models_graphql.py</h3>
<p>–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å GraphQL —Å—Ö–µ–º–æ–π. –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, —Ä–µ–∑–æ–ª–≤–µ—Ä—ã –∏ —Å—Ö–µ–º—É API.</p>
<div class="code-block"><code class="language-python">from __future__ import annotations
import strawberry
from typing import Any
from datetime import datetime
from database import AsyncSessionLocal
from sqlalchemy import text

# JSON —Å–∫–∞–ª—è—Ä–Ω—ã–π —Ç–∏–ø –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSONB –ø–æ–ª—è–º–∏
JSON = strawberry.scalar(Any, serialize=lambda v: v, parse_value=lambda v: v)

@strawberry.type
class UserType:
    id: int
    username: str
    profile: JSON | None = None

@strawberry.type
class MessageType:
    id: int
    author_id: int
    title: str | None = None
    content: str
    metadata: JSON | None = None
    stats: JSON | None = None
    created_at: datetime
    updated_at: datetime
    # –°–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Ç–∏–ø–∞–º–∏
    author: UserType | None = None
    comments: list[CommentType] = strawberry.field(default_factory=list)

@strawberry.type
class CommentType:
    id: int
    message_id: int
    author_id: int
    parent_comment_id: int | None = None
    content: str
    metadata: JSON | None = None
    reactions: JSON | None = None
    created_at: datetime
    updated_at: datetime
    # –°–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Ç–∏–ø–∞–º–∏
    author: UserType | None = None
    message: MessageType | None = None
    replies: list[CommentType] = strawberry.field(default_factory=list)

@strawberry.type
class Query:
    @strawberry.field
    def hello(self) -> str:
        return "Hello, GraphQL!"
    
    @strawberry.field
    async def messages(self) -> list[MessageType]:
        async with AsyncSessionLocal() as session:
            result = await session.execute(
                text("SELECT * FROM messages ORDER BY created_at DESC")
            )
            rows = result.mappings().all()
            return [MessageType(**row) for row in rows]

@strawberry.type
class Mutation:
    @strawberry.mutation
    def test_mutation(self) -> str:
        return "Mutation works!"

schema = strawberry.Schema(query=Query, mutation=Mutation)</code></div>

<div class="checkbox-item"><input type="checkbox" id="t3"><label for="t3">CRUD —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞</label></div>
</div>

<div class="section">
<h2>üìù –®–∞–≥ 4: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
<p>–î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑–æ–ª–≤–µ—Ä—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ ID –∏ —Å–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.</p>

<div class="code-block"><code class="language-python">@strawberry.type
class Query:
    @strawberry.field
    async def message(self, id: int) -> MessageType | None:
        async with AsyncSessionLocal() as session:
            result = await session.execute(
                text("SELECT * FROM messages WHERE id = :id"),
                {"id": id}
            )
            row = result.mappings().first()
            return MessageType(**row) if row else None</code></div>

<div class="form-group">
                <label>–í–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ:</label>
                <textarea class="code-textarea" placeholder="# –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ —Ä–µ–∑–æ–ª–≤–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
@strawberry.field
async def users(self) -> list[UserType]:
    async with AsyncSessionLocal() as session:
        result = ...  # –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å SELECT * FROM users
        rows = ...    # –ü–æ–ª—É—á–∏—Ç–µ –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ result.mappings().all()
        return ...    # –í–µ—Ä–Ω–∏—Ç–µ —Å–ø–∏—Å–æ–∫ [UserType(**row) for row in rows]"></textarea>
            </div>

<div class="form-group">
                <label>–í–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ:</label>
                <textarea class="code-textarea" placeholder="# –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ —Ä–µ–∑–æ–ª–≤–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
@strawberry.field
async def user(self, id: int) -> UserType | None:
    async with AsyncSessionLocal() as session:
        result = ...  # –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º :id
        row = ...     # –ü–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É result.mappings().first()
        return ...    # –í–µ—Ä–Ω–∏—Ç–µ UserType(**row) if row else None"></textarea>
            </div>

<div class="note">
<strong>–ó–∞–¥–∞–Ω–∏–µ:</strong> –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ä–µ–∑–æ–ª–≤–µ—Ä—ã users –∏ user —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å message.
</div>

<div class="checkbox-item"><input type="checkbox" id="t4"><label for="t4">–ë–∞–∑–æ–≤—ã–µ —Ä–µ–∑–æ–ª–≤–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã</label></div>
</div>

<div class="section">
<h2>üîÑ –®–∞–≥ 5: –ü–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –º—É—Ç–∞—Ü–∏–∏</h2>
<p>–°–æ–∑–¥–∞–µ–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –í—ã–Ω–æ—Å–∏–º –ª–æ–≥–∏–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Ä–µ–∑–æ–ª–≤–µ—Ä–æ–≤.</p>

<h3>5.1 Input —Ç–∏–ø—ã</h3>
<div class="code-block"><code class="language-python">@strawberry.input
class MessageCreateInput:
    author_id: int
    title: str | None = None
    content: str
    metadata: JSON | None = None

@strawberry.input
class CommentCreateInput:
    message_id: int
    author_id: int
    content: str
    parent_comment_id: int | None = None</code></div>

<h3>5.2 user_resolvers.py</h3>
<div class="code-block"><code class="language-python">import json
from database import AsyncSessionLocal
from sqlalchemy import text
from models_graphql import UserType

async def get_all_users() -> list[UserType]:
    async with AsyncSessionLocal() as session:
        result = await session.execute(
            text("SELECT * FROM users ORDER BY id")
        )
        rows = result.mappings().all()
        return [UserType(**row) for row in rows]

async def create_user(username: str, profile: dict | None = None) -> UserType:
    async with AsyncSessionLocal() as session:
        profile_json = json.dumps(profile) if profile else '{}'
        result = await session.execute(
            text("""
                INSERT INTO users (username, profile)
                VALUES (:username, CAST(:profile AS jsonb))
                RETURNING *
            """),
            {"username": username, "profile": profile_json}
        )
        await session.commit()
        row = result.mappings().first()
        return UserType(**row) if row else None

async def update_user(user_id: int, username: str | None = None, 
                     profile: dict | None = None) -> UserType | None:
    async with AsyncSessionLocal() as session:
        updates = []
        params = {"id": user_id}
        
        if username is not None:
            updates.append("username = :username")
            params["username"] = username
        
        if profile is not None:
            updates.append("profile = :profile::jsonb")
            params["profile"] = json.dumps(profile)
        
        if not updates:
            return await get_user_by_id(user_id)
        
        result = await session.execute(
            text(f"""
                UPDATE users SET {', '.join(updates)}
                WHERE id = :id RETURNING *
            """), params
        )
        await session.commit()
        row = result.mappings().first()
        return UserType(**row) if row else None

async def delete_user(user_id: int) -> bool:
    async with AsyncSessionLocal() as session:
        result = await session.execute(
            text("DELETE FROM users WHERE id = :id RETURNING id"),
            {"id": user_id}
        )
        await session.commit()
        return result.rowcount > 0</code></div>

<h3>5.3 –ú—É—Ç–∞—Ü–∏–∏ –≤ models_graphql.py</h3>
<div class="code-block"><code class="language-python">@strawberry.type
class Mutation:
    @strawberry.mutation
    async def create_user(self, username: str, profile: JSON | None = None) -> UserType:
        from user_resolvers import create_user
        profile_dict = profile if isinstance(profile, dict) else None
        return await create_user(username, profile_dict)
    
    @strawberry.mutation
    async def update_user(self, user_id: int, username: str | None = None, 
                         profile: JSON | None = None) -> UserType | None:
        from user_resolvers import update_user
        profile_dict = profile if isinstance(profile, dict) else None
        return await update_user(user_id, username, profile_dict)
    
    @strawberry.mutation
    async def delete_user(self, user_id: int) -> bool:
        from user_resolvers import delete_user
        return await delete_user(user_id)</code></div>

<div class="checkbox-item"><input type="checkbox" id="t5"><label for="t5">–ú—É—Ç–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã</label></div>
</div>

<div class="section">
<h2>üß™ –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ GraphQL API</h2>
<p>–û—Ç–∫—Ä–æ–π—Ç–µ <code>http://localhost:8000/graphql</code> –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ GraphQL Playground.</p>

<h3>–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤</h3>
<div class="code-block"><code class="language-graphql"># –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
query {
  messages {
    id
    title
    content
    authorId
    createdAt
  }
}

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ ID
query {
  message(id: 1) {
    id
    title
    content
    metadata
    stats
  }
}

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
mutation {
  createUser(
    username: "new_user"
    profile: {
      theme: "dark"
      notifications: true
      language: "ru"
    }
  ) {
    id
    username
    profile
  }
}</code></div>

<h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏</h3>
<div class="code-block"><code class="language-graphql">query GetUser($userId: Int!) {
  user(id: $userId) {
    id
    username
    profile
  }
}

# Variables:
{
  "userId": 1
}</code></div>

<div class="checkbox-item"><input type="checkbox" id="t6"><label for="t6">API –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ</label></div>
</div>

<div class="section">
<h2>üìö –®–∞–≥ 7: –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h2>
<p>–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–¥–∞–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞ <code>tasks_for_students.md</code> –∏—Å–ø–æ–ª—å–∑—É—è –∑–∞–≥–æ—Ç–æ–≤–∫–∏ –∏–∑ <code>student_resolvers.py</code></p>

<h3>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–¥–∞–Ω–∏–π</h3>
<table>
<tr><th>–°–ª–æ–∂–Ω–æ—Å—Ç—å</th><th>–ó–∞–¥–∞–Ω–∏—è</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>
<tr><td>‚≠ê‚≠ê –ü—Ä–æ—Å—Ç—ã–µ (1-5)</td><td>1-5</td><td>–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ</td></tr>
<tr><td>‚≠ê‚≠ê‚≠ê –°—Ä–µ–¥–Ω–∏–µ (6-10)</td><td>6-10</td><td>–ü–∞–≥–∏–Ω–∞—Ü–∏—è, –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, —Ä–∞–±–æ—Ç–∞ —Å JSONB</td></tr>
<tr><td>‚≠ê‚≠ê‚≠ê‚≠ê –°–ª–æ–∂–Ω—ã–µ (11-15)</td><td>11-15</td><td>JOIN –∑–∞–ø—Ä–æ—Å—ã, –∞–≥—Ä–µ–≥–∞—Ü–∏—è, —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã</td></tr>
<tr><td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –û—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã–µ (16-18)</td><td>16-18</td><td>–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫, –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã</td></tr>
</table>

<h3>–ú–æ–∏ —Ä–µ—à–µ–Ω–∏—è</h3>
<div class="form-group">
                <label>–ó–∞–¥–∞–Ω–∏–µ 1: –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é</label>
                <textarea class="code-textarea code-textarea-large" placeholder="# –ó–∞–¥–∞–Ω–∏–µ 1
async def get_comments_by_message_id(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 2
async def get_messages_by_author_id(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 3
async def create_comment(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 4
async def update_comment(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 5
async def delete_comment(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 6
async def get_messages_paginated(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 7
async def search_messages_by_title(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 8
async def get_messages_by_date_range(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 9
async def get_top_messages_by_views(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 10
async def get_messages_by_tag(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 11
async def get_message_with_author(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 12
async def get_comments_with_authors(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 13
async def get_message_comment_count(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 14
async def increment_message_views(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 15
async def get_comment_thread(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 16
async def get_user_statistics(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 17
async def search_messages_fulltext(...):
    ...

# –ó–∞–¥–∞–Ω–∏–µ 18
async def get_messages_advanced(...):
    ..."></textarea>
            </div>



<div class="checkbox-item"><input type="checkbox" id="t7"><label for="t7">–ó–∞–¥–∞–Ω–∏—è 1-5 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã</label></div>
<div class="checkbox-item"><input type="checkbox" id="t8"><label for="t8">–ó–∞–¥–∞–Ω–∏—è 6-10 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã</label></div>
<div class="checkbox-item"><input type="checkbox" id="t9"><label for="t9">–ó–∞–¥–∞–Ω–∏—è 11-15 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã</label></div>
<div class="checkbox-item"><input type="checkbox" id="t10"><label for="t10">–ó–∞–¥–∞–Ω–∏—è 16-18 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã</label></div>
</div>

<div class="section">
<h2>üìä –í—ã–≤–æ–¥—ã</h2>
<div class="form-group"><label>–ò–∑—É—á–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:</label><textarea rows="4" placeholder="GraphQL –æ—Å–Ω–æ–≤—ã, Strawberry GraphQL, FastAPI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å PostgreSQL, JSONB –ø–æ–ª—è..."></textarea></div>
<div class="form-group"><label>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏:</label><textarea rows="4" placeholder="–°–æ–∑–¥–∞–Ω–∏–µ GraphQL —Å—Ö–µ–º –∏ —Ä–µ–∑–æ–ª–≤–µ—Ä–æ–≤, CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏, —Ä–∞–±–æ—Ç–∞ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤..."></textarea></div>
<div class="form-group"><label>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ GraphQL:</label><textarea rows="4" placeholder="–ì–∏–±–∫–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–∞–Ω–Ω—ã—Ö, —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è, –µ–¥–∏–Ω—ã–π endpoint, –∏–Ω—Ç—Ä–æ—Å–ø–µ–∫—Ü–∏—è API..."></textarea></div>
<div class="form-group"><label>–°–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–µ–Ω–∏—è:</label><textarea rows="4" placeholder="–ü—Ä–æ–±–ª–µ–º—ã N+1 –∑–∞–ø—Ä–æ—Å–æ–≤, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è, –æ–±—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã..."></textarea></div>
</div>

<button class="save-btn" onclick="window.print()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PDF</button>
</div>

<script>
if(!sessionStorage.getItem('graphql-loaded')){localStorage.clear();sessionStorage.setItem('graphql-loaded','true')}
['student-name','group','date'].forEach(id=>{const el=document.getElementById(id);el.value=localStorage.getItem(id)||'';el.addEventListener('input',()=>localStorage.setItem(id,el.value))});
document.getElementById('date').value=document.getElementById('date').value||new Date().toISOString().split('T')[0];
document.querySelectorAll('input[type="checkbox"]').forEach(cb=>{if(localStorage.getItem(cb.id)==='true')cb.checked=true;cb.addEventListener('change',()=>localStorage.setItem(cb.id,cb.checked))});

function autoResize(textarea){if(!textarea.classList.contains('code-textarea-large')){textarea.style.height='auto';textarea.style.height=textarea.scrollHeight+'px'}}

function highlightPython(code){let result=code.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');result=result.replace(/(#.*$)/gm,'<span style="color:#6272a4;font-style:italic">$1</span>');result=result.replace(/(['"`])((?:\\.|(?!\1)[^\\\r\n])*?)\1/g,'<span style="color:#f1fa8c">$&</span>');result=result.replace(/\b(from|import|def|class|return|if|else|elif|for|while|try|except|finally|with|as|and|or|not|in|is|True|False|None|async|await|raise|pass)\b/g,'<span style="color:#ff79c6;font-weight:bold">$1</span>');result=result.replace(/\b(\d+)\b/g,'<span style="color:#bd93f9">$1</span>');result=result.replace(/\b(Session|UserType|MessageType|CommentType|AsyncSessionLocal|text|strawberry|JSON|int|str|dict|list)\b/g,'<span style="color:#8be9fd">$1</span>');result=result.replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)(?=\s*\()/g,'<span style="color:#50fa7b">$1</span>');return result}

document.querySelectorAll('.code-textarea').forEach(textarea=>{const wrapper=document.createElement('div');wrapper.style.position='relative';textarea.parentNode.insertBefore(wrapper,textarea);wrapper.appendChild(textarea);const preview=document.createElement('div');preview.className='code-block';preview.style.display='none';preview.style.cursor='pointer';wrapper.appendChild(preview);textarea.addEventListener('input',function(){autoResize(this);localStorage.setItem('ta-'+Array.from(document.querySelectorAll('textarea')).indexOf(this),this.value)});textarea.addEventListener('blur',()=>{setTimeout(()=>{if(textarea.value.trim()){preview.innerHTML=highlightPython(textarea.value);preview.style.display='block';textarea.style.display='none'}},200)});preview.addEventListener('click',()=>{preview.style.display='none';textarea.style.display='block';textarea.focus()});const saved=localStorage.getItem('ta-'+Array.from(document.querySelectorAll('textarea')).indexOf(textarea));if(saved){textarea.value=saved;if(textarea.value.trim()){preview.innerHTML=highlightPython(textarea.value);preview.style.display='block';textarea.style.display='none'}}autoResize(textarea)});

document.querySelectorAll('textarea:not(.code-textarea)').forEach((ta,i)=>{const saved=localStorage.getItem('ta-'+i);if(saved)ta.value=saved;ta.addEventListener('input',()=>{localStorage.setItem('ta-'+i,ta.value);autoResize(ta)});autoResize(ta)});

document.addEventListener('DOMContentLoaded',()=>document.querySelectorAll('code').forEach(el=>hljs.highlightElement(el)));
</script>
</body>
</html>