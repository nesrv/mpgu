# –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –≤ PostgreSQL

---

## –°–ª–∞–π–¥ 1

### –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

–õ–µ–∫—Ü–∏—è –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –≤ postgresql

- –ó–∞—á–µ–º –Ω—É–∂–µ–Ω –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫?
- –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –∑–∞–ø—Ä–æ—Å—ã
- –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
- –°–ª–æ–≤–∞—Ä–∏ –∏ —à–∞–±–ª–æ–Ω—ã
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ò–Ω–¥–µ–∫—Å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

---

## –°–ª–∞–π–¥ 2

### –ó–∞—á–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫?

**–°—Ä–µ–¥—Å—Ç–≤–∞ SQL ‚Äî LIKE, —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è**
- –Ω–µ—Ç –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –Ω–µ—Ç –∏–Ω–¥–µ–∫—Å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**–í–Ω–µ—à–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã**
- —Å–ª–æ–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç–∏
- –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º
- —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –¥–æ—Å—Ç—É–ø–∞

–í –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–∏ SQL —É–∂–µ –µ—Å—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–µ–∫—Å—Ç—É. –≠—Ç–æ –∏ —Å–æ–≤—Å–µ–º –ø—Ä–æ—Å—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã LIKE –∏ ILIKE, –∏ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è SIMILAR TO, –∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è (–æ–ø–µ—Ä–∞—Ç–æ—Ä ~). –ó–∞—á–µ–º –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º?

**–ü—Ä–æ–±–ª–µ–º–∞ LIKE ‚Äî —ç—Ç–æ –∫–∞–∫ –∏—Å–∫–∞—Ç—å –∏–≥–æ–ª–∫—É –≤ —Å—Ç–æ–≥–µ —Å–µ–Ω–∞ —Å –∑–∞–≤—è–∑–∞–Ω–Ω—ã–º–∏ –≥–ª–∞–∑–∞–º–∏:**
- `WHERE name LIKE '%–∏–≤–∞–Ω%'` –Ω–∞–π–¥–µ—Ç "–ò–≤–∞–Ω", –Ω–æ –Ω–µ –Ω–∞–π–¥–µ—Ç "–ò–≤–∞–Ω–∞", "–ò–≤–∞–Ω—É", "–ò–≤–∞–Ω–æ–º" ‚Äî –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ù–µ—Ç —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è: –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–≤–Ω—ã, —Ö–æ—Ç—è –æ–¥–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã —è–≤–Ω–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–µ–µ –¥—Ä—É–≥–∏—Ö
- Full table scan –¥–∞–∂–µ —Å –∏–Ω–¥–µ–∫—Å–æ–º (–µ—Å–ª–∏ –ø–∞—Ç—Ç–µ—Ä–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `%`) ‚Äî –±–∞–∑–∞ –ø—Ä–æ—Å—Ç–æ "—É–º–∏—Ä–∞–µ—Ç" –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö

**–í–Ω–µ—à–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤–∏–∫–∏ (Elasticsearch, Solr) ‚Äî —ç—Ç–æ –∫–∞–∫ –≤—ã–Ω–µ—Å—Ç–∏ –º–æ–∑–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞—Ä—É–∂—É:**
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–æ—Å—Ç—ã–ª–∏: –ø–∏—à–µ—à—å –≤ Postgres, –ø–æ—Ç–æ–º –ø—É—à–∏—à—å –≤ Elastic ‚Äî –∞ –µ—Å–ª–∏ —É–ø–∞–ª–æ –º–µ–∂–¥—É –Ω–∏–º–∏? Race condition, –ø—Ä–∏–≤–µ—Ç!
- –ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: –æ—Ç–∫–∞—Ç–∏–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ –ë–î, –∞ –≤ –ø–æ–∏—Å–∫–æ–≤–∏–∫–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –µ—Å—Ç—å ‚Äî inconsistency –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞
- –ü–æ–∏—Å–∫–æ–≤–∏–∫ –Ω–µ –≤–∏–¥–∏—Ç JOIN'—ã, –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏, –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ ‚Äî –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É
- –ï—â–µ –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ = –µ—â–µ –æ–¥–Ω–∞ —Ç–æ—á–∫–∞ –æ—Ç–∫–∞–∑–∞

**FTS –≤ PostgreSQL ‚Äî —ç—Ç–æ "best of both worlds":** –≤—Å—è –º–æ—â—å –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –¥–≤–∏–∂–∫–∞ –≤–Ω—É—Ç—Ä–∏ –±–∞–∑—ã, —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –∏ –±–µ–∑ –ª–∏—à–Ω–∏—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤.

---

## –°–ª–∞–π–¥ 3

### –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –∑–∞–ø—Ä–æ—Å—ã

**–î–æ–∫—É–º–µ–Ω—Ç**
- –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞ —Å–ª–æ–≤–∞ (–ª–µ–∫—Å–µ–º—ã)
- docx, pdf –∏ —Ç. –ø. –Ω–∞–¥–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —Ç–µ–∫—Å—Ç
- –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ `tsvector`

**–ó–∞–ø—Ä–æ—Å**
- –æ–¥–Ω–∞ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–µ–∫—Å–µ–º, —Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ —Å–≤—è–∑–∫–∞–º–∏:
  - `&` –∏
  - `|` –∏–ª–∏
  - `!` –Ω–µ
  - `<->` –ø—Ä–µ–¥—à–µ—Å—Ç–≤—É–µ—Ç (—Ñ—Ä–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫)
  - `( )` –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
- –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ `tsquery`

–î–æ–∫—É–º–µ–Ω—Ç, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –Ω—É–∂–µ–Ω –ø–æ–∏—Å–∫, –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ ‚Äî —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö tsvector. –ò—Å—Ö–æ–¥–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞ (—Ç–æ—á–Ω–µ–µ, –ª–µ–∫—Å–µ–º—ã ‚Äî —Ä–∞–∑–Ω–∏—Ü—É –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –¥–∞–ª—å—à–µ). –ü–æ –¥–≤–æ–∏—á–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º —Ç–æ–∂–µ –º–æ–∂–Ω–æ –∏—Å–∫–∞—Ç—å, –µ—Å–ª–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –∏—Ö –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–∏–¥ (—Å –ø–æ–º–æ—â—å—é —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫).

**tsvector ‚Äî —ç—Ç–æ –∫–∞–∫ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π JSON –¥–ª—è –ø–æ–∏—Å–∫–∞:**
```sql
SELECT to_tsvector('–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É');
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: '—Ä–∞–∑—Ä–∞–±–æ—Ç–∫':1,2,3
-- –í—Å–µ —Å–ª–æ–≤–æ—Ñ–æ—Ä–º—ã —Å—Ö–ª–æ–ø–Ω—É–ª–∏—Å—å –≤ –æ–¥–Ω—É –ª–µ–∫—Å–µ–º—É!
```

**tsquery ‚Äî —ç—Ç–æ DSL –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (Domain Specific Language):**
```sql
-- –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫
'postgres' 
-- –ë—É–ª–µ–≤–∞ –ª–æ–≥–∏–∫–∞ (–∫–∞–∫ –≤ Google)
'postgres & (performance | optimization)'
-- –§—Ä–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫ (—Å–ª–æ–≤–∞ —Ä—è–¥–æ–º)
'full <-> text <-> search'
-- NOT –æ–ø–µ—Ä–∞—Ç–æ—Ä (–∏—Å–∫–ª—é—á–∞–µ–º –º—É—Å–æ—Ä)
'python & !django'
```

–≠—Ç–æ –∫–∞–∫ –ø–∏—Å–∞—Ç—å WHERE —É—Å–ª–æ–≤–∏—è, –Ω–æ –¥–ª—è —Ç–µ–∫—Å—Ç–∞. Postgres —Å–∞–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å—ã.

---

## –°–ª–∞–π–¥ 4

### –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ

**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∑–∞–ø—Ä–æ—Å—É**
- –æ–ø–µ—Ä–∞—Ç–æ—Ä `@@`

**–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å**
- –≤–µ—Å–∞ –ª–µ–∫—Å–µ–º (A, B, C, D –≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è –≤–∞–∂–Ω–æ—Å—Ç–∏)
- `ts_rank` ‚Äî –ø–æ —á–∞—Å—Ç–æ—Ç–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ª–µ–∫—Å–µ–º
- `ts_rank_cd` ‚Äî —Ç–∞–∫–∂–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –±–ª–∏–∑–æ—Å—Ç—å –ª–µ–∫—Å–µ–º
- –æ–ø–µ—Ä–∞—Ç–æ—Ä —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è `<=>` (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ rum)

–ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç (—Ç–æ—á–Ω–µ–µ, –µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤ –≤–∏–¥–µ tsvector) –∑–∞–ø—Ä–æ—Å—É (—Ç–æ—á–Ω–µ–µ, –µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é tsquery), –Ω–∞–¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä @@.

**–û–ø–µ—Ä–∞—Ç–æ—Ä @@ ‚Äî —ç—Ç–æ –∫–∞–∫ `==` –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞:**
```sql
SELECT * FROM articles 
WHERE to_tsvector('russian', content) @@ to_tsquery('postgres & performance');
-- –í–µ—Ä–Ω–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ —Å—Ç–∞—Ç—å–∏, –≥–¥–µ –µ—Å—Ç—å –û–ë–ê —Å–ª–æ–≤–∞
```

**–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –∫–∞–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ Google (—Å–∞–º–æ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–µ –Ω–∞–≤–µ—Ä—Ö—É):**

**–í–µ—Å–∞ –ª–µ–∫—Å–µ–º (A, B, C, D) ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∫–∞–∫ –≤ CSS:**
- A = –∑–∞–≥–æ–ª–æ–≤–æ–∫ (—Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π)
- B = –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
- C = –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è
- D = —Ç–µ–ª–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (default)

```sql
SELECT ts_rank(
  setweight(to_tsvector(title), 'A') || 
  setweight(to_tsvector(body), 'D'),
  query
) as rank
-- –°–ª–æ–≤–æ –≤ title –≤–µ—Å–∏—Ç –±–æ–ª—å—à–µ, —á–µ–º –≤ body
```

**ts_rank vs ts_rank_cd:**
- `ts_rank` ‚Äî —Å—á–∏—Ç–∞–µ—Ç —á–∞—Å—Ç–æ—Ç—É (TF ‚Äî Term Frequency): —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å–ª–æ–≤–æ –≤—Å—Ç—Ä–µ—Ç–∏–ª–æ—Å—å
- `ts_rank_cd` ‚Äî —É—á–∏—Ç—ã–≤–∞–µ—Ç –±–ª–∏–∑–æ—Å—Ç—å (proximity): —Å–ª–æ–≤–∞ —Ä—è–¥–æ–º = –≤—ã—à–µ —Ä–∞–Ω–≥

**RUM –∏–Ω–¥–µ–∫—Å ‚Äî —ç—Ç–æ GIN –Ω–∞ —Å—Ç–µ—Ä–æ–∏–¥–∞—Ö:**
- –û–ø–µ—Ä–∞—Ç–æ—Ä `<=>` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ" –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–º –∏ –∑–∞–ø—Ä–æ—Å–æ–º
- –ú–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å `ORDER BY document <=> query` –ø—Ä—è–º–æ –ø–æ –∏–Ω–¥–µ–∫—Å—É ‚Äî –±–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –≤ –ø–∞–º—è—Ç–∏!
- –≠—Ç–æ –∫–∞–∫ LIMIT —Å –∏–Ω–¥–µ–∫—Å–æ–º, –Ω–æ –¥–ª—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏

**–ß–µ–≥–æ –Ω–µ—Ç:** TF-IDF –∏ "–Ω–∞–π–¥–∏ –ø–æ—Ö–æ–∂–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã" (–∫–∞–∫ –≤ Elasticsearch "More Like This"). –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω—ã –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –ë–î –∏–ª–∏ pgvector —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.

---

## –°–ª–∞–π–¥ 5

### –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä

**–¥–æ–∫—É–º–µ–Ω—Ç ‚Üí –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä ‚Üí —Ñ—Ä–∞–≥–º–µ–Ω—Ç+—Ç–∏–ø, —Ñ—Ä–∞–≥–º–µ–Ω—Ç+—Ç–∏–ø, ‚Ä¶**

- –í—ã–¥–µ–ª—è–µ—Ç –≤ —Ç–µ–∫—Å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
- –∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º —Ç–∏–ø—ã

**–®—Ç–∞—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä `default`**
- 23 —Ç–∏–ø–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ (—Å–ª–æ–≤–∞, —á–∏—Å–ª–∞, –∞–¥—Ä–µ—Å–∞, —Ç–µ–≥–∏ XML –∏ —Ç. –ø.)

**–î—Ä—É–≥–∏–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã**
- —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- –Ω–∞–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ —è–∑—ã–∫–µ C

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ tsvector, –∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ tsquery.

**–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä (parser) ‚Äî —ç—Ç–æ —Ç–æ–∫–µ–Ω–∞–π–∑–µ—Ä, –∫–∞–∫ –≤ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞—Ö:**

–í—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞:
```
"–ö—É–ø–∏ —Å–ª–æ–Ω–∞ –∑–∞ 1000$ –Ω–∞ example.com!"
```

–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Ä–∞–∑–±–∏–≤–∞–µ—Ç –Ω–∞ —Ç–æ–∫–µ–Ω—ã —Å —Ç–∏–ø–∞–º–∏:
```
"–ö—É–ø–∏"     ‚Üí word (—Å–ª–æ–≤–æ)
"—Å–ª–æ–Ω–∞"    ‚Üí word
"1000"     ‚Üí uint (—á–∏—Å–ª–æ)
"$"        ‚Üí symbol
"example.com" ‚Üí url (–∞–¥—Ä–µ—Å)
"!"        ‚Üí symbol
```

**23 —Ç–∏–ø–∞ —Ç–æ–∫–µ–Ω–æ–≤ ‚Äî —ç—Ç–æ –∫–∞–∫ AST (Abstract Syntax Tree):**
- `word` ‚Äî –æ–±—ã—á–Ω—ã–µ —Å–ª–æ–≤–∞
- `email` ‚Äî —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç `admin@example.com`
- `url` ‚Äî —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç `https://site.ru`
- `numword` ‚Äî "–¥–≤–∞–¥—Ü–∞—Ç—å —Ç—Ä–∏"
- `tag` ‚Äî XML/HTML —Ç–µ–≥–∏ `<div>`
- `entity` ‚Äî HTML entities `&nbsp;`

–ë–ª–∞–≥–æ–¥–∞—Ä—è —Ç–∏–ø–∞–º –º–æ–∂–Ω–æ –ø–æ-—Ä–∞–∑–Ω–æ–º—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ª–æ–≤–∞ –∏ —á–∏—Å–ª–∞!

**–ö–∞—Å—Ç–æ–º–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã (–¥–ª—è —Ö–∞—Ä–¥–∫–æ—Ä—â–∏–∫–æ–≤):**
- –ü–∏—à–µ—à—å –Ω–∞ C (–∫–∞–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ Postgres)
- –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á: –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∫–æ–¥–∞, —Ö–∏–º–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º—É–ª, –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
- `pg_tsparser` ‚Äî –Ω–µ –ª–æ–º–∞–µ—Ç `snake_case` –∏ `kebab-case` (–¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∫–æ–¥–∞)

–≠—Ç–æ –∫–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–π –ª–µ–∫—Å–µ—Ä –¥–ª—è —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## –°–ª–∞–π–¥ 6

### –°–ª–æ–≤–∞—Ä–∏

**—Ñ—Ä–∞–≥–º–µ–Ω—Ç ‚Üí —Å–ª–æ–≤–∞—Ä—å ‚Üí –ª–µ–∫—Å–µ–º–∞, –ª–µ–∫—Å–µ–º–∞, ‚Ä¶**

**–°–ª–æ–≤–∞—Ä—å –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç –≤ –ª–µ–∫—Å–µ–º—É**
- —É–±—Ä–∞—Ç—å —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
- –ø—Ä–∏–≤–µ—Å—Ç–∏ –±—É–∫–≤—ã –∫ –æ–¥–Ω–æ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
- –ø—Ä–∏–≤–µ—Å—Ç–∏ —Å–ª–æ–≤–æ—Ñ–æ—Ä–º—ã –∫ –æ–±—â–µ–º—É –≤–∏–¥—É
- –ø—Ä–∏–≤–µ—Å—Ç–∏ —Å–∏–Ω–æ–Ω–∏–º—ã –∫ –æ–¥–Ω–æ–º—É –≤–∞—Ä–∏–∞–Ω—Ç—É
- –∏ —Ç. –ø.

**–®—Ç–∞—Ç–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–∏**
- `simple` ‚Äî –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä –∏ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
- —Å—Ç–µ–º–º–∏–Ω–≥ –¥–ª—è 28 —è–∑—ã–∫–æ–≤

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä—å –∏ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ª–µ–∫—Å–µ–º—É (lexeme) –∏–ª–∏ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–µ–∫—Å–µ–º.

**–°–ª–æ–≤–∞—Ä—å ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä, –∫–∞–∫ `.toLowerCase()` –Ω–∞ —Å—Ç–µ—Ä–æ–∏–¥–∞—Ö:**

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å (pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏):**

1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç–æ–ø-—Å–ª–æ–≤ (–∫–∞–∫ `.filter()` –≤ JS):**
```
"–∏", "–∏–ª–∏", "–≤", "–Ω–∞" ‚Üí —É–¥–∞–ª—è—é—Ç—Å—è
// –≠—Ç–∏ —Å–ª–æ–≤–∞ –µ—Å—Ç—å –≤–µ–∑–¥–µ, –∏—Å–∫–∞—Ç—å –∏—Ö –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ
```

2. **–ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ lowercase:**
```
"PostgreSQL" ‚Üí "postgresql"
```

3. **–°—Ç–µ–º–º–∏–Ω–≥ (–æ—Ç—Ä–µ–∑–∞–Ω–∏–µ –æ–∫–æ–Ω—á–∞–Ω–∏–π):**
```
"—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫"  ‚Üí "—Ä–∞–∑—Ä–∞–±–æ—Ç"
"—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞" ‚Üí "—Ä–∞–∑—Ä–∞–±–æ—Ç"
"—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"   ‚Üí "—Ä–∞–∑—Ä–∞–±–æ—Ç"
// –í—Å–µ —Å–ª–æ–≤–æ—Ñ–æ—Ä–º—ã ‚Üí –æ–¥–Ω–∞ –ª–µ–∫—Å–µ–º–∞!
```

4. **–°–∏–Ω–æ–Ω–∏–º—ã (–∫–∞–∫ –∞–ª–∏–∞—Å—ã –≤ SQL):**
```
"PostgreSQL" ‚Üí "postgres"
"–ü–æ—Å—Ç–≥—Ä–µ—Å"   ‚Üí "postgres"
```

**–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–∏:**
- `simple` ‚Äî —Ç—É–ø–æ lowercase + —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ (–±—ã—Å—Ç—Ä–æ, –Ω–æ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–æ)
- `russian`, `english`, etc. ‚Äî —Å—Ç–µ–º–º–∏–Ω–≥ –¥–ª—è 28 —è–∑—ã–∫–æ–≤ (–∞–ª–≥–æ—Ä–∏—Ç–º Snowball)

**–°—Ç–µ–º–º–∏–Ω–≥ vs –õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è:**
- –°—Ç–µ–º–º–∏–Ω–≥ (–±—ã—Å—Ç—Ä–æ, –≥—Ä—É–±–æ): "–±–µ–∂–∞–ª" ‚Üí "–±–µ–∂" (–∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏–π)
- –õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è (–º–µ–¥–ª–µ–Ω–Ω–æ, —Ç–æ—á–Ω–æ): "–±–µ–∂–∞–ª" ‚Üí "–±–µ–∂–∞—Ç—å" (–ø–æ —Å–ª–æ–≤–∞—Ä—é)

Postgres –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–µ–º–º–∏–Ω–≥ ‚Äî —Å–∫–æ—Ä–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤.

---

## –°–ª–∞–π–¥ 7

### –®–∞–±–ª–æ–Ω—ã —Å–ª–æ–≤–∞—Ä–µ–π

**–°–ª–æ–≤–∞—Ä—å ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω**
- –Ω–∞–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ —è–∑—ã–∫–µ C

**–®—Ç–∞—Ç–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã**
- –ø—Ä–æ—Å—Ç–æ–π —Å–ª–æ–≤–∞—Ä—å
- —Å—Ç–µ–º–º–µ—Ä snowball
- —Å–ª–æ–≤–∞—Ä—å ispell
- —Å–∏–Ω–æ–Ω–∏–º—ã: –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –∫ –æ–¥–Ω–æ–º—É –≤–∏–¥—É
- —Ç–µ–∑–∞—É—Ä—É—Å: –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ñ—Ä–∞–∑ –∫ –æ–¥–Ω–æ–º—É –≤–∏–¥—É

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å, –Ω—É–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —à–∞–±–ª–æ–Ω–æ–º (template), –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–≤ –µ–≥–æ. –®–∞–±–ª–æ–Ω ‚Äî —ç—Ç–æ, –ø–æ —Å—É—Ç–∏, –Ω–∞–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ C, —Ä–µ–∞–ª–∏–∑—É—é—â–∏—Ö —Å–ª–æ–≤–∞—Ä—å.

**–®–∞–±–ª–æ–Ω —Å–ª–æ–≤–∞—Ä—è ‚Äî —ç—Ç–æ –∫–∞–∫ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å –≤ –û–û–ü:**

```sql
CREATE TEXT SEARCH DICTIONARY my_russian (
  TEMPLATE = snowball,
  Language = russian,
  StopWords = russian
);
-- –°–æ–∑–¥–∞–ª–∏ –∏–Ω—Å—Ç–∞–Ω—Å —Å–ª–æ–≤–∞—Ä—è –∏–∑ —à–∞–±–ª–æ–Ω–∞
```

**–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã (–∏–∑ –∫–æ—Ä–æ–±–∫–∏):**

1. **`simple` ‚Äî –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π (–∫–∞–∫ `String.prototype.toLowerCase()`):**
   - Lowercase + —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
   - –î–ª—è —è–∑—ã–∫–æ–≤ –±–µ–∑ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç)

2. **`snowball` ‚Äî —Å—Ç–µ–º–º–µ—Ä (—Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π):**
   - –ê–ª–≥–æ—Ä–∏—Ç–º Snowball (Porter Stemmer 2.0)
   - 28 —è–∑—ã–∫–æ–≤ –∏–∑ –∫–æ—Ä–æ–±–∫–∏
   - –ë—ã—Å—Ç—Ä—ã–π, –Ω–æ –∏–Ω–æ–≥–¥–∞ "–æ—Ç—Ä–µ–∑–∞–µ—Ç –ª–∏—à–Ω–µ–µ"

3. **`ispell` ‚Äî –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–ª–æ–≤–∞—Ä—å (–∫–∞–∫ –≤ Word):**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–æ–≤–∞—Ä–∏ MySpell/Hunspell (–∏–∑ OpenOffice/LibreOffice)
   - –¢–æ—á–Ω–∞—è –ª–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ
   - –ù—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å —Å–ª–æ–≤–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã

4. **`synonym` ‚Äî –º–∞–ø–ø–∏–Ω–≥ —Å–∏–Ω–æ–Ω–∏–º–æ–≤:**
   ```
   postgres : postgresql
   pg       : postgresql
   ```
   –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã ‚Üí –æ–¥–Ω–∞ –ª–µ–∫—Å–µ–º–∞

5. **`thesaurus` ‚Äî –∑–∞–º–µ–Ω–∞ —Ñ—Ä–∞–∑ (–∫–∞–∫ –º–∞–∫—Ä–æ—Å—ã):**
   ```
   machine learning : ml
   artificial intelligence : ai
   ```
   –¶–µ–ª—ã–µ —Ñ—Ä–∞–∑—ã ‚Üí —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è

**–≠—Ç–æ –∫–∞–∫ middleware –≤ Express.js:** –∫–∞–∂–¥—ã–π —Å–ª–æ–≤–∞—Ä—å ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ —Ü–µ–ø–æ—á–∫–µ.

---

## –°–ª–∞–π–¥ 8

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–¥–æ–∫—É–º–µ–Ω—Ç ‚Üí –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä ‚Üí —Ñ—Ä–∞–≥–º–µ–Ω—Ç+—Ç–∏–ø ‚Üí —Å–ª–æ–≤–∞—Ä–∏ ‚Üí –ª–µ–∫—Å–µ–º—ã**

**–°–≤–æ—è —Ü–µ–ø–æ—á–∫–∞ —Å–ª–æ–≤–∞—Ä–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞**
- –ø–µ—Ä–≤—ã–π —Å–ª–æ–≤–∞—Ä—å, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤—à–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–µ–∫—Å–µ–º—É
- —Ñ–∏–ª—å—Ç—Ä—É—é—â–∏–π —Å–ª–æ–≤–∞—Ä—å –ø–µ—Ä–µ–¥–∞–µ—Ç –ª–µ–∫—Å–µ–º—É –¥–∞–ª—å—à–µ –ø–æ —Ü–µ–ø–æ—á–∫–µ

–ò—Ç–∞–∫, –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–µ–ª—è–µ—Ç –≤ –Ω–µ–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã. –ö–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ —Å–ª–æ–≤–∞—Ä–∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –≤ –ª–µ–∫—Å–µ–º—ã, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –µ–≥–æ —Ç–∏–ø–æ–º. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º–æ–∂–Ω–æ –ø–æ-—Ä–∞–∑–Ω–æ–º—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ª–æ–≤–∞, —á–∏—Å–ª–∞ –∏ —Ç. –ø.

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Äî —ç—Ç–æ routing –ø—Ä–∞–≤–∏–ª–∞ (–∫–∞–∫ –≤ nginx):**

```sql
CREATE TEXT SEARCH CONFIGURATION my_config (COPY = russian);

ALTER TEXT SEARCH CONFIGURATION my_config
  ALTER MAPPING FOR word WITH synonym, russian_stem;
  -- –î–ª—è —Ç–∏–ø–∞ 'word': —Å–Ω–∞—á–∞–ª–∞ synonym, –ø–æ—Ç–æ–º russian_stem

ALTER TEXT SEARCH CONFIGURATION my_config
  ALTER MAPPING FOR email WITH simple;
  -- –î–ª—è —Ç–∏–ø–∞ 'email': —Ç–æ–ª—å–∫–æ simple
```

**–¶–µ–ø–æ—á–∫–∞ —Å–ª–æ–≤–∞—Ä–µ–π ‚Äî —ç—Ç–æ Chain of Responsibility –ø–∞—Ç—Ç–µ—Ä–Ω:**

```
–¢–æ–∫–µ–Ω "PostgreSQL" (—Ç–∏–ø: word)
  ‚Üì
[synonym] ‚Üí –Ω–∞—à–µ–ª! ‚Üí "postgres" ‚Üí STOP
  ‚Üì (–µ—Å–ª–∏ –Ω–µ –Ω–∞—à–µ–ª)
[russian_stem] ‚Üí "postgresql" ‚Üí STOP
  ‚Üì (–µ—Å–ª–∏ –Ω–µ –Ω–∞—à–µ–ª)
[simple] ‚Üí "postgresql" ‚Üí STOP
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è –≤ —Ü–µ–ø–æ—á–∫–µ:**

1. **–§–∏–ª—å—Ç—Ä (return null):**
   ```
   "–∏" ‚Üí —Å—Ç–æ–ø-—Å–ª–æ–≤–æ ‚Üí —É–¥–∞–ª–∏—Ç—å ‚Üí STOP
   ```

2. **–ó–∞–º–µ–Ω–∞ –∏ STOP (return value):**
   ```
   "PostgreSQL" ‚Üí "postgres" ‚Üí STOP
   ```

3. **–ó–∞–º–µ–Ω–∞ –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–ª—å—à–µ (middleware):**
   ```
   "PostgreSQL" ‚Üí "postgres" ‚Üí next()
   ```

4. **–ü—Ä–æ–ø—É—Å–∫ (next()):**
   ```
   –°–∏–Ω–æ–Ω–∏–º –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ø–µ—Ä–µ–¥–∞—Ç—å –¥–∞–ª—å—à–µ
   ```

**–≠—Ç–æ –∫–∞–∫ Express.js middleware:**
```javascript
app.use(synonymMiddleware);  // –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
app.use(stemmingMiddleware); // –∏–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –¥–∞–ª—å—à–µ
app.use(simpleMiddleware);   // fallback
```

---

## –°–ª–∞–π–¥ 9

### –ò–Ω–¥–µ–∫—Å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**GiST**
- –Ω–µ—Ç–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ —Ç–∞–±–ª–∏—Ü–µ
- —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–ª–æ–≤
- –ø–æ–¥–¥–µ—Ä–∂–∫–∞ INCLUDE
- –±—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —á–∏—Å–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)

**GIN**
- —Ç–æ—á–Ω–æ–µ –∏ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
- —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–ª–æ–≤
- –º–µ–¥–ª–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —á–∏—Å–ª–∞ —Å–ª–æ–≤ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö)

**RUM (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ GIN)**
- –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –∏–Ω–¥–µ–∫—Å–µ (–ø–æ–∑–∏—Ü–∏–∏ –ª–µ–∫—Å–µ–º –∏ –¥—Ä.)
- –≤—ã–¥–∞—á–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å—Ä–∞–∑—É –≤ –ø–æ—Ä—è–¥–∫–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏

–û—Ç –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –Ω–æ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã. –î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∏–ø–æ–≤.

**–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è FTS ‚Äî –≤—ã–±–æ—Ä –∫–∞–∫ –º–µ–∂–¥—É HashMap –∏ TreeMap:**

### **GiST (Generalized Search Tree) ‚Äî "–±—ã—Å—Ç—Ä—ã–µ –∞–ø–¥–µ–π—Ç—ã"**

**–ü–ª—é—Å—ã:**
- ‚ö° –ë—ã—Å—Ç—Ä—ã–π INSERT/UPDATE (–≤–∞–∂–Ω–æ –¥–ª—è highload —Å —á–∞—Å—Ç—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏)
- üì¶ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ INCLUDE (covering index ‚Äî –Ω–µ –ª–µ–∑–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É)
- üå≥ –ö–∞–∫ B-tree, –Ω–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤

**–ú–∏–Ω—É—Å—ã:**
- üêå –ú–µ–¥–ª–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (lossy index ‚Äî –Ω—É–∂–Ω–∞ recheck –ø–æ —Ç–∞–±–ª–∏—Ü–µ)
- üìâ –î–µ–≥—Ä–∞–¥–∞—Ü–∏—è –ø—Ä–∏ —Ä–æ—Å—Ç–µ —á–∏—Å–ª–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–ª–æ–≤
- ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ—Ä–ø—É—Å–æ–≤

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –±–ª–æ–≥–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–º–Ω–æ–≥–æ –∑–∞–ø–∏—Å–µ–π, –º–∞–ª–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞–∂–¥–æ–π)

---

### **GIN (Generalized Inverted Index) ‚Äî "–∫–æ—Ä–æ–ª—å FTS"**

**–ü–ª—é—Å—ã:**
- üöÄ –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ (inverted index –∫–∞–∫ –≤ Elasticsearch)
- üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –ø–∞–¥–∞–µ—Ç —Å —Ä–æ—Å—Ç–æ–º —Å–ª–æ–≤–∞—Ä—è
- üíæ –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π (—Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –ª–µ–∫—Å–µ–º—ã)

**–ú–∏–Ω—É—Å—ã:**
- üê¢ –ú–µ–¥–ª–µ–Ω–Ω—ã–π INSERT/UPDATE (–Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –º–Ω–æ–≥–æ –∫–ª—é—á–µ–π)
- üîÑ –ò—Å–ø–æ–ª—å–∑—É–π `fastupdate=on` –¥–ª—è –±–∞—Ç—á–∏–Ω–≥–∞ (–∫–∞–∫ write-behind cache)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ):**
```
–õ–µ–∫—Å–µ–º–∞ ‚Üí [doc_id1, doc_id2, doc_id3, ...]
"postgres" ‚Üí [1, 5, 42, 100]
"python"   ‚Üí [2, 5, 99]
```

–≠—Ç–æ –∫–∞–∫ HashMap<String, List<Integer>> –≤ –ø–∞–º—è—Ç–∏!

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, —Å—Ç–∞—Ç—å–∏, –ª–æ–≥–∏ (read-heavy –Ω–∞–≥—Ä—É–∑–∫–∞)

---

### **RUM (RUM Index) ‚Äî "GIN –Ω–∞ —Å—Ç–µ—Ä–æ–∏–¥–∞—Ö"**

**–ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫ GIN:**
- üìç –•—Ä–∞–Ω–∏—Ç –ø–æ–∑–∏—Ü–∏–∏ –ª–µ–∫—Å–µ–º –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
- ‚öñÔ∏è –•—Ä–∞–Ω–∏—Ç –≤–µ—Å–∞ (A, B, C, D)
- üéØ –û–ø–µ—Ä–∞—Ç–æ—Ä `<=>` –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –ë–ï–ó –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

**–ú–∞–≥–∏—è:**
```sql
-- GIN: —Å–Ω–∞—á–∞–ª–∞ –Ω–∞–π—Ç–∏, –ø–æ—Ç–æ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –ø–∞–º—è—Ç–∏
SELECT * FROM docs 
WHERE fts @@ query 
ORDER BY ts_rank(fts, query) DESC;

-- RUM: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø—Ä—è–º–æ –ø–æ –∏–Ω–¥–µ–∫—Å—É!
SELECT * FROM docs 
ORDER BY fts <=> query;
-- Index Scan using rum_idx (cost=...)
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (–ø–æ–∏—Å–∫–æ–≤–∏–∫–∏, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

---

**–í—ã–±–æ—Ä –∏–Ω–¥–µ–∫—Å–∞ (cheat sheet):**
- –ú–Ω–æ–≥–æ –∑–∞–ø–∏—Å–µ–π? ‚Üí **GIN**
- –ß–∞—Å—Ç—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è? ‚Üí **GiST**
- –ù—É–∂–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏? ‚Üí **RUM**
- –§—Ä–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫ –∫—Ä–∏—Ç–∏—á–µ–Ω? ‚Üí **RUM**

---

## –°–ª–∞–π–¥ 10

### –ò—Ç–æ–≥–∏

**–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç**
- –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å
- —É—á–µ—Ç —è–∑—ã–∫–æ–≤—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π
- —Ñ—Ä–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫
- —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –∏–Ω–¥–µ–∫—Å–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É

**–ü–æ–∏—Å–∫ –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –ª—é–±—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –ø—Ä–∏–≤–æ–¥–∏–º—É—é –∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –≤–∏–¥—É**

**–í–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –Ω—É–∂–¥—ã**

---

**PostgreSQL FTS ‚Äî —ç—Ç–æ –Ω–µ –∫–æ—Å—Ç—ã–ª—å, –∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**

### **1. –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (Real-time, –±–µ–∑ eventual consistency)**

```sql
BEGIN;
  INSERT INTO posts (title, body) VALUES ('–ù–æ–≤–æ—Å—Ç—å', '–¢–µ–∫—Å—Ç');
  -- –°—Ä–∞–∑—É –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞!
  SELECT * FROM posts WHERE fts @@ '–Ω–æ–≤–æ—Å—Ç—å';
COMMIT;
```

**Elasticsearch:**
```javascript
await es.index({ index: 'posts', body: doc });
await es.indices.refresh({ index: 'posts' }); // –ù—É–∂–µ–Ω refresh!
// –ò–ª–∏ –∂–¥–∞—Ç—å 1 —Å–µ–∫—É–Ω–¥—É (refresh_interval)
```

**–í—ã–≤–æ–¥:** –í Postgres –Ω–µ—Ç "–ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –ª–∞–≥–∞" ‚Äî –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.

---

### **2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å (ACID –∏–∑ –∫–æ—Ä–æ–±–∫–∏)**

**–ü—Ä–æ–±–ª–µ–º–∞ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –ø–æ–∏—Å–∫–æ–≤–∏–∫–∞–º–∏:**
```javascript
// –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –±–∞–≥:
try {
  await db.insert(post);        // ‚úÖ –£—Å–ø–µ—Ö
  await elastic.index(post);    // ‚ùå –£–ø–∞–ª–æ
} catch (e) {
  // –î–∞–Ω–Ω—ã–µ –≤ –ë–î –µ—Å—Ç—å, –≤ –ø–æ–∏—Å–∫–µ –Ω–µ—Ç ‚Äî —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω!
}
```

**–° PostgreSQL FTS:**
```sql
BEGIN;
  INSERT INTO posts ...;
  -- –ò–Ω–¥–µ–∫—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  -- –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —É–ø–∞–¥–µ—Ç ‚Äî –æ—Ç–∫–∞—Ç–∏—Ç—Å—è –í–°–Å
COMMIT;
```

**–≠—Ç–æ –∫–∞–∫ git commit:** –ª–∏–±–æ –≤—Å—ë, –ª–∏–±–æ –Ω–∏—á–µ–≥–æ. –ù–∏–∫–∞–∫–∏—Ö "orphaned documents".

---

### **3. –£—á–µ—Ç —è–∑—ã–∫–æ–≤—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π (28 —è–∑—ã–∫–æ–≤ –∏–∑ –∫–æ—Ä–æ–±–∫–∏)**

```sql
-- –†—É—Å—Å–∫–∏–π:
SELECT to_tsvector('russian', '—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç');
-- '—Ä–∞–∑—Ä–∞–±–æ—Ç':1,2  (–æ–±–µ —Ñ–æ—Ä–º—ã ‚Üí –æ–¥–Ω–∞ –ª–µ–∫—Å–µ–º–∞)

-- –ê–Ω–≥–ª–∏–π—Å–∫–∏–π:
SELECT to_tsvector('english', 'developers develop');
-- 'develop':1,2

-- –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å:
CREATE INDEX idx_multi ON docs USING GIN (
  to_tsvector('russian', title) || 
  to_tsvector('english', title)
);
```

**–≠—Ç–æ –∫–∞–∫ i18n –¥–ª—è –ø–æ–∏—Å–∫–∞:** –Ω–µ –Ω—É–∂–Ω–æ –≥–æ—Ä–æ–¥–∏—Ç—å –∫–æ—Å—Ç—ã–ª–∏ —Å ngrams.

---

### **4. –§—Ä–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫ (proximity search)**

```sql
-- –ù–∞–π—Ç–∏ "machine learning" –∏–º–µ–Ω–Ω–æ –≤ —Ç–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ:
SELECT * FROM articles 
WHERE fts @@ phraseto_tsquery('english', 'machine learning');

-- –° —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º (RUM index):
SELECT * FROM articles 
WHERE fts @@ 'machine <2> learning';  -- –¥–æ 2 —Å–ª–æ–≤ –º–µ–∂–¥—É
```

**Elasticsearch –∞–Ω–∞–ª–æ–≥:** `match_phrase` —Å `slop`.

---

### **5. –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (relevance scoring)**

```sql
SELECT 
  title,
  ts_rank(fts, query) AS rank,
  ts_headline('russian', body, query) AS snippet
FROM articles, to_tsquery('russian', 'postgres') query
WHERE fts @@ query
ORDER BY rank DESC;
```

**–§–∞–∫—Ç–æ—Ä—ã —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –ß–∞—Å—Ç–æ—Ç–∞ —Å–ª–æ–≤–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ (TF)
- –†–µ–¥–∫–æ—Å—Ç—å —Å–ª–æ–≤–∞ –≤ –∫–æ—Ä–ø—É—Å–µ (IDF)
- –î–ª–∏–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (normalization)
- –í–µ—Å–∞ –ø–æ–ª–µ–π (A > B > C > D)

**–≠—Ç–æ –∫–∞–∫ TF-IDF –≤ scikit-learn**, –Ω–æ –ø—Ä—è–º–æ –≤ SQL!

---

### **6. –ò–Ω–¥–µ–∫—Å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–Ω–µ full table scan)**

```sql
EXPLAIN ANALYZE
SELECT * FROM docs WHERE fts @@ 'postgres';

-- –ë–µ–∑ –∏–Ω–¥–µ–∫—Å–∞:
Seq Scan on docs  (cost=0.00..1500.00 rows=100)
  Filter: (fts @@ '''postgres'''::tsquery)
-- –ß–∏—Ç–∞–µ—Ç –í–°–ï —Å—Ç—Ä–æ–∫–∏ üêå

-- –° GIN –∏–Ω–¥–µ–∫—Å–æ–º:
Bitmap Index Scan using gin_idx  (cost=0.00..12.00 rows=100)
-- –ß–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ üöÄ
```

**–†–∞–∑–Ω–∏—Ü–∞ –∫–∞–∫ –º–µ–∂–¥—É `array.find()` –∏ `hashMap.get()`.**

---

### **7. –ü–æ–∏—Å–∫ –ø–æ –ª—é–±—ã–º –¥–∞–Ω–Ω—ã–º (–Ω–µ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç)**

```sql
-- JSON:
SELECT * FROM products 
WHERE to_tsvector(metadata::text) @@ 'waterproof';

-- JSONB —Å –∏–Ω–¥–µ–∫—Å–æ–º:
CREATE INDEX ON products USING GIN (
  to_tsvector('english', jsonb_path_query_array(metadata, '$.**.text')::text)
);

-- –ú–∞—Å—Å–∏–≤—ã:
SELECT * FROM posts 
WHERE to_tsvector(array_to_string(tags, ' ')) @@ 'postgresql';

-- –î–∞–∂–µ —á–∏—Å–ª–∞:
SELECT to_tsvector('simple', '192.168.1.1');
-- '192.168.1.1':1
```

**–í—Å—ë, —á—Ç–æ –º–æ–∂–Ω–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Å—Ç—Ä–æ–∫–µ ‚Üí –º–æ–∂–Ω–æ –∏—Å–∫–∞—Ç—å.**

---

### **8. –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–¥–ª—è –ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç–æ–≤)**

```sql
-- –°–≤–æ–π —Å–ª–æ–≤–∞—Ä—å —Å–∏–Ω–æ–Ω–∏–º–æ–≤:
CREATE TEXT SEARCH DICTIONARY my_synonyms (
  TEMPLATE = synonym,
  SYNONYMS = my_synonyms  -- —Ñ–∞–π–ª —Å –º–∞–ø–ø–∏–Ω–≥–æ–º
);

-- –°–≤–æ—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
CREATE TEXT SEARCH CONFIGURATION my_search (COPY = russian);
ALTER TEXT SEARCH CONFIGURATION my_search
  ALTER MAPPING FOR word WITH my_synonyms, russian_stem;

-- –°–≤–æ–∏ –≤–µ—Å–∞:
SETWEIGHT(to_tsvector('title'), 'A') ||  -- –≤–∞–∂–Ω–µ–µ
SETWEIGHT(to_tsvector('body'), 'B')     -- –º–µ–Ω–µ–µ –≤–∞–∂–Ω–æ
```

**–≠—Ç–æ –∫–∞–∫ –∫–æ–Ω—Ñ–∏–≥ Webpack:** –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥ –ª—é–±—É—é –∑–∞–¥–∞—á—É.

---

### **–ö–æ–≥–¥–∞ PostgreSQL FTS –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ:**

‚úÖ –î–æ 10-100 –º–ª–Ω –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤  
‚úÖ –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ (–Ω–µ ML-—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ)  
‚úÖ –ù—É–∂–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å  
‚úÖ –•–æ—á–µ—Ç—Å—è –∏–∑–±–µ–∂–∞—Ç—å "–∑–æ–æ–ø–∞—Ä–∫–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π"  
‚úÖ –ë—é–¥–∂–µ—Ç –Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ–≥—Ä–∞–Ω–∏—á–µ–Ω  

### **–ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω Elasticsearch/Solr:**

‚ùå –ú–∏–ª–ª–∏–∞—Ä–¥—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤  
‚ùå –°–ª–æ–∂–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (aggregations, facets)  
‚ùå ML-—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ (learning to rank)  
‚ùå –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (sharding)  
‚ùå Fuzzy search —Å –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é  

---

**–ò—Ç–æ–≥–æ–≤–∞—è –º—É–¥—Ä–æ—Å—Ç—å:**

> "Don't use Elasticsearch just because everyone else does.  
> PostgreSQL FTS ‚Äî —ç—Ç–æ 80% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–∞ 20% —Å–ª–æ–∂–Ω–æ—Å—Ç–∏."  
> ‚Äî –ó–∞–∫–æ–Ω –ü–∞—Ä–µ—Ç–æ –¥–ª—è –ø–æ–∏—Å–∫–∞

**–ù–∞—á–Ω–∏ —Å Postgres FTS, –º–∏–≥—Ä–∏—Ä—É–π –Ω–∞ Elastic —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —É–ø—Ä—ë—à—å—Å—è –≤ –ª–∏–º–∏—Ç—ã.**  
–≠—Ç–æ –∫–∞–∫ –Ω–∞—á–∏–Ω–∞—Ç—å —Å –º–æ–Ω–æ–ª–∏—Ç–∞, –∞ –Ω–µ —Å—Ä–∞–∑—É —Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤.
