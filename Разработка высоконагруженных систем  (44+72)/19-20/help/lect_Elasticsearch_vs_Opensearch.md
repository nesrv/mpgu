# Elasticsearch vs OpenSearch

---

## Слайд 1: полнотекстовый поиск в РФ

| Компания / Организация       | Продукт       | Как используется                                                                 | Источник / Комментарий |
|-----------------------------|---------------|----------------------------------------------------------------------------------|------------------------|
| **Сбер**                    | Elasticsearch | Мониторинг ИТ-инфраструктуры, сбор и анализ логов, внутренние системы поиска     | Вакансии, DevOps/SRE-кейсы, внутренние доклады на конференциях |
| **Тинькофф**                | Elasticsearch | Логгирование, поиск по транзакциям, аналитика безопасности, наблюдаемость сервисов | Публичные tech-блоги, выступления инженеров |
| **Яндекс**                  | Elasticsearch | Поиск по внутренним документам, лог-аналитика отдельных сервисов                 | Открытые презентации, вакансии (частично) |
| **МТС / MTS Digital**       | OpenSearch    | Миграция с Elasticsearch на OpenSearch для внутренних BI- и лог-систем           | Упоминания в технических обсуждениях и вакансиях |
| **Ростелеком**              | OpenSearch    | Системы мониторинга и анализа безопасности (SIEM-подобные решения)               | Госзакупки, требования к open source ПО |
| **ВТБ**                     | Elasticsearch / OpenSearch | Анализ логов, поиск в документах, комплаенс-системы                   | Вакансии DevOps/Big Data, тренды на импортозамещение |
| **Ozon**                    | Elasticsearch | Поиск по товарам (частично), лог-аналитика, наблюдаемость микросервисов          | Публичные технические доклады (частично) |
| **VK (ВКонтакте)**          | Elasticsearch | Поиск по контенту, логирование, аналитика событий                                | Бывшие инженеры, выступления на IT-конференциях |
| **Госуслуги (РИА Новости, госпроекты)** | OpenSearch | Поиск в базах документов, мониторинг инфраструктуры госпорталов       | Тенденция перехода госсектора на open source и отечественное ПО |
| **СберОблако**              | OpenSearch    | Предоставление управляемого OpenSearch как облачного сервиса                     | [sbercloud.ru](https://sbercloud.ru) — официальная документация |

## Слайд 2: Elasticsearch vs OpenSearch vs ZincSearch vs ClickHouse + full-text vs Postgesql полнотекстовый поиск  

Сравнительный анализ поисковых движков
| Критерий                              | Elasticsearch                                     | OpenSearch                                      | ZincSearch                                    | ClickHouse + full-text                           | PostgreSQL (FTS)                              |
|--------------------------------------|---------------------------------------------------|-------------------------------------------------|-----------------------------------------------|--------------------------------------------------|-----------------------------------------------|
| **Основа**                           | Apache Lucene                                     | Форк Elasticsearch (на базе Lucene)             | Написан с нуля на Go, не использует Lucene   | Колоночная СУБД, встроенный n-gram / sparse index | Встроенный движок полнотекстового поиска     |
| **Лицензия**                         | SSPL + Elastic License (не OSI-approved)          | Apache 2.0 (полностью open source)             | Apache 2.0                                    | Apache 2.0                                       | PostgreSQL License (open source, MIT-подобная) |
| **Язык реализации**                  | Java                                              | Java                                            | Go                                            | C++                                              | C                                               |
| **Полнотекстовый поиск**             | ⭐⭐⭐⭐⭐ (мощный, гибкий, с поддержкой релевантности) | ⭐⭐⭐⭐⭐ (почти идентичен Elasticsearch)         | ⭐⭐⭐ (базовый, подходит для простых сценариев) | ⭐⭐ (ограниченный: n-gram, не BM25 по умолчанию) | ⭐⭐⭐ (хороший, поддержка ранжирования, словарей) |
| **Аналитика / агрегации**           | ⭐⭐⭐⭐⭐                                            | ⭐⭐⭐⭐⭐                                          | ⭐ (минимальные)                             | ⭐⭐⭐⭐⭐ (высокопроизводительная аналитика)        | ⭐⭐ (ограничено оконными функциями и CTE)     |
| **Масштабируемость (горизонтальная)**| Отличная (sharding, replication)                  | Отличная                                       | Ограниченная (без встроенного шардинга)      | Отличная (sharding через Distributed-движок)    | Сложная (через Citus или логическое шардирование) |
| **Простота развёртывания**           | Средняя (требует JVM)                             | Средняя (требует JVM)                          | Очень высокая (один бинарник)                | Средняя                                          | Высокая (часто уже установлен)                |
| **Поддержка BM25 / релевантности**   | Да                                                | Да                                              | Да                                            | Нет (по умолчанию); можно эмулировать           | Да (начиная с v8.3)                           |
| **Язык запросов**                    | Query DSL (JSON)                                  | Query DSL (совместим с ES)                     | Упрощённый Query DSL                         | SQL                                              | SQL + ts_query/ts_vector                      |
| **Визуализация**                     | Kibana                                            | OpenSearch Dashboards                          | Нет (сторонние решения)                      | Grafana, Metabase и др.                         | pgAdmin, внешние BI-системы                   |
| **Использование ресурсов**           | Высокое (JVM, память)                             | Высокое (JVM, память)                          | Низкое                                        | Среднее–высокое (зависит от данных)             | Низкое–среднее                                |
| **Идеальный сценарий**               | Логи, мониторинг, сложный поиск + аналитика       | Аналогично Elasticsearch, но с open source     | Лёгкие приложения, MVP, встраиваемые системы | Аналитика больших объёмов + базовый поиск       | Поиск в небольших БД, когда PostgreSQL уже используется |

> **Примечание**:  
> - ⭐ — условная оценка от 1 до 5 звёзд.  
> - ClickHouse не является специализированным поисковым движком, но с версии 22.8+ поддерживает полнотекстовый поиск через `sparse` и `ngrambf_v1` индексы.  
> - ZincSearch — не подходит для сложных аналитических задач или высоконагруженных production-сред, но отлично подходит для обучения или лёгких проектов.

---

## Слайд 3: Elasticsearch vs OpenSearch
- История и происхождение
- Архитектура
- Лицензирование
- Функциональность
- Производительность
- Экосистема
- Выбор решения

---

## Слайд 4: Что такое Elasticsearch?
- Распределенный поисковый и аналитический движок
- Основан на Apache Lucene
- Создан в 2010 году Shay Banon
- Часть Elastic Stack (ELK)
- Полнотекстовый поиск в реальном времени

---

## Слайд 5: Что такое OpenSearch?
- Форк Elasticsearch 7.10.2
- Создан AWS в 2021 году
- Open source под Apache 2.0
- Совместимость с Elasticsearch API
- Развивается сообществом и AWS

---

## Слайд 6: История раскола
**2021 год - критический момент**
- Elastic меняет лицензию на SSPL/Elastic License
- AWS создает форк последней Apache 2.0 версии
- Рождение OpenSearch
- Разделение сообщества

---

## Слайд 7: Временная линия Elasticsearch
- 2010: Создание Elasticsearch
- 2012: Основание Elastic NV
- 2015: Выход Elasticsearch 2.0
- 2018: IPO на NYSE
- 2021: Смена лицензии на SSPL

---

## Слайд 8: Временная линия OpenSearch
- 2021 (апрель): Анонс форка AWS
- 2021 (июль): Релиз OpenSearch 1.0
- 2022: OpenSearch 2.0
- 2023: Активное развитие функций
- 2024+: Независимая эволюция

---

## Слайд 9: Лицензирование Elasticsearch
**Двойная лицензия:**
- Server Side Public License (SSPL)
- Elastic License 2.0
- Ограничения на облачные сервисы
- Платные функции (X-Pack)

---

## Слайд 10: Лицензирование OpenSearch
**Полностью открытый:**
- Apache License 2.0
- Все функции бесплатны
- Нет ограничений на использование
- Коммерческое использование разрешено

---

## Слайд 11: Архитектура - Общие черты
- Распределенная система
- Основа: Apache Lucene
- Кластерная архитектура
- Шардирование и репликация
- RESTful API

---

## Слайд 12: Компоненты кластера
**Узлы (Nodes):**
- Master nodes
- Data nodes
- Coordinating nodes
- Ingest nodes
- ML nodes (различия в реализации)

---

## Слайд 13: Индексы и шарды
- Индекс = коллекция документов
- Шарды = горизонтальное разделение
- Primary и replica шарды
- Автоматическая балансировка
- Идентичная логика в обеих системах

---

## Слайд 14: API совместимость
**OpenSearch:**
- Совместим с Elasticsearch API 7.x
- Постепенное расхождение
- Собственные расширения

**Elasticsearch:**
- Развитие собственного API
- Версии 8.x+ с изменениями

---

## Слайд 15: Поисковые возможности
**Общие функции:**
- Full-text search
- Фильтрация и агрегации
- Геопространственный поиск
- Fuzzy search (нечеткий поиск с учетом опечаток, расстояние Левенштейна)
- Highlighting (подсветка найденных фрагментов в результатах)

---

## Слайд 16: Query DSL
```json
{
  "query": {
    "bool": {                              // Булев запрос (AND, OR, NOT)
      "must": [                            // Обязательное условие (влияет на релевантность)
        { "match": { "title": "search" }} // Полнотекстовый поиск по полю title
      ],
      "filter": [                          // Фильтр (не влияет на релевантность, кэшируется)
        { "range": { "date": { "gte": "2024" }}} // Диапазон: дата >= 2024
      ]
    }
  }
}
```
Синтаксис идентичен в обеих системах

---

## Слайд 17: Агрегации
- Metrics aggregations (метрики: avg, sum, min, max, stats)
- Bucket aggregations (группировка: terms, date_histogram, range)
- Pipeline aggregations (вычисления над результатами других агрегаций)
- Matrix aggregations (статистика по нескольким полям)
- Практически идентичны в обеих системах

---

## Слайд 18: Elasticsearch - Уникальные функции
- ECS (Elastic Common Schema) - стандартизация полей для логов и метрик
- Canvas визуализации - создание кастомных презентаций и отчетов
- Elastic APM - мониторинг производительности приложений
- SIEM возможности - анализ безопасности и обнаружение угроз
- Интеграция с Elastic Cloud - управляемый облачный сервис

---

## Слайд 19: OpenSearch - Уникальные функции
- Anomaly Detection (бесплатно) - ML-обнаружение аномалий без платной подписки
- Trace Analytics - распределенная трассировка для микросервисов
- Piped Processing Language (PPL) - SQL-подобный язык запросов
- Index Management улучшения - автоматизация жизненного цикла индексов
- Интеграция с AWS - нативная поддержка AWS сервисов

---

## Слайд 20: Machine Learning
**Elasticsearch:**
- ML в X-Pack (платно) - требует подписку для production
- Anomaly detection - автоматическое обнаружение отклонений
- Forecasting - прогнозирование временных рядов

**OpenSearch:**
- ML Commons (бесплатно) - открытый ML-фреймворк
- k-NN search - поиск ближайших соседей для векторов
- Anomaly detection - бесплатная альтернатива Elastic ML

---

## Слайд 21: Security
**Elasticsearch:**
- X-Pack Security (платно в старых версиях) - до версии 7.11
- Бесплатно с 7.11+ - базовая безопасность стала бесплатной
- RBAC, TLS, SSO - контроль доступа, шифрование, единый вход

**OpenSearch:**
- Security plugin (всегда бесплатно) - с самого начала
- Fine-grained access control - детальные права на уровне документов/полей
- Audit logging - журналирование всех действий пользователей

---

## Слайд 22: Alerting
**Elasticsearch:**
- Watcher (X-Pack) - мониторинг и оповещения (платная функция)
- Kibana Alerting - создание алертов через UI

**OpenSearch:**
- Alerting plugin (бесплатно) - полнофункциональные оповещения
- Monitors и triggers - настройка условий срабатывания
- Destinations (Slack, email, webhooks) - множество каналов уведомлений

---

## Слайд 23: Визуализация - Kibana
- Официальный UI для Elasticsearch - веб-интерфейс от Elastic
- Dashboards и visualizations - графики, таблицы, диаграммы
- Canvas, Maps - продвинутые визуализации и геокарты
- Платные функции в некоторых версиях - часть возможностей требует подписки

---

## Слайд 24: Визуализация - OpenSearch Dashboards
- Форк Kibana
- Полностью бесплатный
- Аналогичный функционал
- Собственные улучшения
- Trace Analytics UI

---

## Слайд 25: Производительность - Индексация
**Факторы:**
- Размер шардов - оптимально 20-50 GB на шард
- Refresh interval - по умолчанию 1s, увеличение ускоряет индексацию
- Bulk requests - пакетная загрузка данных (1000-5000 документов)
- Практически идентичны в обеих системах

**Бенчмарки:** Различия минимальны (<5%) при одинаковой конфигурации

---

## Слайд 26: Производительность - Поиск
- Скорость запросов сопоставима - миллисекунды на простые запросы
- Зависит от конфигурации - RAM, CPU, количество шардов
- Оптимизация кэша - query cache, field data cache, request cache
- Различия в ML функциях - OpenSearch может быть быстрее в k-NN поиске

---

## Слайд 27: Масштабируемость
**Оба поддерживают:**
- Горизонтальное масштабирование - добавление узлов без даунтайма
- Тысячи узлов - кластеры до 1000+ нод в production
- Петабайты данных - проверено на реальных нагрузках
- Cross-cluster search/replication - поиск и репликация между кластерами

---

## Слайд 28: Экосистема - Elasticsearch
- Logstash - ETL инструмент для обработки логов
- Beats - легковесные агенты сбора данных (Filebeat, Metricbeat)
- Elastic APM - Application Performance Monitoring
- Elastic Cloud - управляемый облачный сервис
- Обширная документация - детальные гайды и примеры
- Большое сообщество - активные форумы, Stack Overflow

---

## Слайд 29: Экосистема - OpenSearch
- Data Prepper - аналог Logstash для обработки данных
- Fluent Bit интеграция - легковесный сборщик логов
- AWS интеграции - нативная работа с S3, Lambda, CloudWatch
- OpenSearch Service (AWS) - полностью управляемый сервис
- Растущее сообщество - активное развитие с 2021 года
- AWS поддержка - коммерческая поддержка от Amazon

---

## Слайд 30: Клиентские библиотеки
**Elasticsearch:**
- Официальные клиенты (Java, Python, JS, Go, .NET, PHP, Ruby)
- Активная поддержка

**OpenSearch:**
- Форки Elasticsearch клиентов
- Собственные клиенты
- Обратная совместимость

---

## Слайд 31: Миграция Elasticsearch → OpenSearch
**Процесс:**
1. Snapshot существующих данных - создание резервной копии индексов
2. Развертывание OpenSearch кластера - установка и настройка нового кластера
3. Restore snapshot - восстановление данных из бэкапа
4. Обновление клиентов - переключение приложений на новый кластер
5. Тестирование - проверка работоспособности и производительности

Совместимость с 7.x упрощает миграцию - API практически идентичен

---

## Слайд 32: Стоимость владения (TCO)
**Elasticsearch:**
- Open source базовые функции
- Платные enterprise функции
- Elastic Cloud (managed)

**OpenSearch:**
- Полностью бесплатный
- AWS OpenSearch Service (managed)
- Потенциально ниже TCO

---

## Слайд 33: Поддержка и SLA
**Elasticsearch:**
- Коммерческая поддержка Elastic
- SLA для Elastic Cloud
- Платные подписки

**OpenSearch:**
- Community support
- AWS поддержка для OpenSearch Service
- Нет официальной коммерческой поддержки

---

## Слайд 34: Use Cases - Логирование
**Оба отлично подходят:**
- Централизованное логирование - сбор логов со всех серверов в одном месте
- Log analytics - анализ паттернов, ошибок, трендов
- Real-time monitoring - мониторинг событий в реальном времени
- Retention policies - автоматическое удаление старых логов

---

## Слайд 35: Use Cases - Поиск
**Application search:**
- E-commerce поиск - поиск товаров с фильтрами и ранжированием
- Документальный поиск - полнотекстовый поиск по базе документов
- Autocomplete - автодополнение при вводе запроса
- Faceted search - фасетная навигация (фильтры по категориям)

Функционал идентичен в обеих системах

---

## Слайд 36: Use Cases - Аналитика
- Метрики и KPI - отслеживание ключевых показателей бизнеса
- Business intelligence - построение аналитических дашбордов
- Time-series анализ - анализ временных рядов (метрики, события)
- Агрегации в реальном времени - вычисление статистики на лету

---

## Слайд 37: Use Cases - Security
**SIEM и Security Analytics:**
- Elasticsearch: более зрелое решение
- OpenSearch: активно развивается
- Threat detection
- Audit logging

---

## Слайд 38: Когда выбрать Elasticsearch
✅ Нужна коммерческая поддержка  
✅ Используете Elastic Cloud  
✅ Требуются специфичные Elastic функции  
✅ Существующая инфраструктура на Elastic Stack  
✅ Зрелая SIEM платформа

---

## Слайд 39: Когда выбрать OpenSearch
✅ Важна открытая лицензия  
✅ Инфраструктура на AWS  
✅ Нужны все функции бесплатно  
✅ Хотите избежать vendor lock-in  
✅ Community-driven развитие

---

## Слайд 40: Будущее развитие
**Elasticsearch:**
- Фокус на Elastic Cloud
- AI/ML интеграции
- Enterprise функции

**OpenSearch:**
- Независимое развитие
- AWS инновации
- Community contributions
- Новые функции (PPL, ML Commons)

---

## Слайд 41: Выводы
**Технически:** Очень похожи (общий корень)  
**Лицензия:** OpenSearch полностью открыт  
**Экосистема:** Elasticsearch более зрелая  
**Стоимость:** OpenSearch потенциально дешевле  
**Выбор:** Зависит от требований и инфраструктуры

**Оба - отличные решения для поиска и аналитики!**

---
