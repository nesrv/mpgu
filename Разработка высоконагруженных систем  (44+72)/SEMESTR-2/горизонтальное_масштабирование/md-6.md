–û—Ç–ª–∏—á–Ω–æ, —ç—Ç–æ –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ üí•
**–°—Ü–µ–Ω–∞—Ä–∏–π 6** ‚Äî –ø—Ä–æ —Ç–æ, —á—Ç–æ –æ—Ç–ª–∏—á–∞–µ—Ç ¬´–ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä¬ª –æ—Ç  **–∂–∏–≤—É—á–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞** .

---

# –°—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–Ω—è—Ç–∏—è 6

## –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: restart policy –∏ healthcheck –≤ Docker Compose

---

## üéØ –¶–µ–ª–∏ –∑–∞–Ω—è—Ç–∏—è

–°—Ç—É–¥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω:

* –ø–æ–Ω–∏–º–∞—Ç—å, –ø–æ—á–µ–º—É —Å–µ—Ä–≤–∏—Å—ã –ø–∞–¥–∞—é—Ç
* —É–º–µ—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å healthcheck –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è ¬´–∑–¥–æ—Ä–æ–≤—å—è¬ª —Å–µ—Ä–≤–∏—Å–∞
* —É–≤–∏–¥–µ—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ —Å–±–æ—è—Ö

---

## üß† –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å (20 –º–∏–Ω—É—Ç)

### 1. –ü–æ—á–µ–º—É —Å–µ—Ä–≤–∏—Å—ã –ø–∞–¥–∞—é—Ç

–†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

* –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ –∫–æ–¥–µ
* –Ω–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏ (OOM)
* –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ë–î
* –æ—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–í–∞–∂–Ω–æ:

> –ü–∞–¥–µ–Ω–∏–µ ‚Äî –Ω–æ—Ä–º–∞. –í–æ–ø—Ä–æ—Å –Ω–µ  *–µ—Å–ª–∏* , –∞  *–∫–æ–≥–¥–∞* .

---

### 2. Restart policy

–†–∞–∑–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `restart`:

```yaml
restart: no
restart: always
restart: on-failure
restart: unless-stopped
```

–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:

* `always` ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Å–µ–≥–¥–∞
* `on-failure` ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–æ–¥ –≤—ã—Ö–æ–¥–∞ ‚â† 0
* `unless-stopped` ‚Äî –∫–∞–∫ `always`, –Ω–æ —É–≤–∞–∂–∞–µ–º `docker stop`

---

### 3. Healthcheck

–ß—Ç–æ —Ç–∞–∫–æ–µ healthcheck:

* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ¬´–∂–∏–≤¬ª, –Ω–æ —Å–µ—Ä–≤–∏—Å –≤–Ω—É—Ç—Ä–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –º—ë—Ä—Ç–≤
* healthcheck ‚â† restart (–≤–∞–∂–Ω–æ!)

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

```yaml
healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
  interval: 10s
  timeout: 3s
  retries: 3
```

---

## üß™ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å (55 –º–∏–Ω—É—Ç)

### –®–∞–≥ 1. Backend —Å –æ—à–∏–±–∫–∞–º–∏ (15 –º–∏–Ω—É—Ç)

**app.py**

```python
from flask import Flask
import socket
import random
import time

app = Flask(__name__)

@app.route("/")
def hello():
    return f"Hello from {socket.gethostname()}\n"

@app.route("/health")
def health():
    return "OK\n"

@app.route("/crash")
def crash():
    time.sleep(1)
    raise RuntimeError("Simulated crash!")

@app.route("/unstable")
def unstable():
    if random.random() < 0.4:
        raise RuntimeError("Random failure")
    return "Still alive\n"

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)
```

–û–±—Å—É–¥–∏—Ç—å:

* `/crash` ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ
* `/unstable` ‚Äî —Å–ª—É—á–∞–π–Ω—ã–µ –æ—à–∏–±–∫–∏
* `/health` ‚Äî —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è healthcheck

---

### –®–∞–≥ 2. Docker Compose —Å restart policy (15 –º–∏–Ω—É—Ç)

```yaml
version: "3.9"

services:
  backend:
    build: ./app
    restart: on-failure
    deploy:
      resources:
        limits:
          memory: 256M

  nginx:
    image: nginx:alpine
    ports:
      - "8080:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - backend
```

---

### –®–∞–≥ 3. –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º (10 –º–∏–Ω—É—Ç)

1. –ó–∞–ø—É—Å–∫:

```bash
docker compose up --build
```

2. –í—ã–∑–æ–≤:

```bash
curl localhost:8080/crash
```

3. –ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
docker compose ps
docker compose logs backend
```

–ù–∞–±–ª—é–¥–µ–Ω–∏–µ:

* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–∞–¥–∞–µ—Ç
* Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ

---

### –®–∞–≥ 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ healthcheck (15 –º–∏–Ω—É—Ç)

–û–±–Ω–æ–≤–ª—è–µ–º `docker-compose.yml`:

```yaml
backend:
  build: ./app
  restart: on-failure
  healthcheck:
    test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
    interval: 10s
    timeout: 3s
    retries: 3
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
docker inspect --format='{{.State.Health.Status}}' backend-1
```

–°—Ç–∞—Ç—É—Å—ã:

* `starting`
* `healthy`
* `unhealthy`

---

## üîç –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å (15 –º–∏–Ω—É—Ç)

### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 1: —Å–ª–æ–º–∞—Ç—å healthcheck

* –∏–∑–º–µ–Ω–∏—Ç—å `/health` —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–ª 500
* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `unhealthy`
* **–Ω–æ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**

–ö–ª—é—á–µ–≤–∞—è –º—ã—Å–ª—å:

> Healthcheck —Å–æ–æ–±—â–∞–µ—Ç, –Ω–æ –Ω–µ –ª–µ—á–∏—Ç.

---

### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 2: –ø–∞–¥–µ–Ω–∏–µ + restart

* —Å–æ–≤–º–µ—Å—Ç–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏ healthcheck
* –Ω–∞–±–ª—é–¥–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ

–û–±—Å—É–∂–¥–µ–Ω–∏–µ:

* –ø–æ—á–µ–º—É Docker –Ω–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ç unhealthy –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä?
* –∫—Ç–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç –≤ Kubernetes?

---

## üß† –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã (10 –º–∏–Ω—É—Ç)

–§–∏–∫—Å–∏—Ä—É–µ–º:

* restart policy ‚Äî —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —Å–º–µ—Ä—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
* healthcheck ‚Äî —Å–∏–≥–Ω–∞–ª –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–∞
* —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã
* –≤–º–µ—Å—Ç–µ –æ–Ω–∏ –¥–∞—é—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

---

## üß™ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è

### –õ—ë–≥–∫–æ–µ

* –∏–∑–º–µ–Ω–∏—Ç—å `restart` –Ω–∞ `always`
* –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–Ω–∏—Ü—É

### –°—Ä–µ–¥–Ω–µ–µ

* —É–≤–µ–ª–∏—á–∏—Ç—å `retries`
* –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É before unhealthy

### –°–ª–æ–∂–Ω–æ–µ ‚≠ê

* –¥–æ–±–∞–≤–∏—Ç—å healthcheck –≤ Nginx
* –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å ¬´—á–∞—Å—Ç–∏—á–Ω–æ –∂–∏–≤–æ–π¬ª —Å–µ—Ä–≤–∏—Å

---

## üìù –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ

**–í–∞—Ä–∏–∞–Ω—Ç 1:**
–ü–æ—á–µ–º—É Docker –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç unhealthy –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?

**–í–∞—Ä–∏–∞–Ω—Ç 2 (–ø—Ä–∞–∫—Ç–∏–∫–∞):**

* —Å–¥–µ–ª–∞—Ç—å backend, –∫–æ—Ç–æ—Ä—ã–π:
  * —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–≤–µ—á–∞–µ—Ç OK
  * —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É –ª–æ–º–∞–µ—Ç—Å—è
* –Ω–∞–±–ª—é–¥–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

---

## üë®‚Äçüè´ –ú–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã

* –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–π—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É process –∏ service
* –Ω–µ –¥–∞–≤–∞–π—Ç–µ –∏–ª–ª—é–∑–∏–∏ ¬´—Å–∞–º–æ –ø–æ—á–∏–Ω–∏—Ç—Å—è¬ª
* –ø–æ–¥–≤–µ–¥–∏—Ç–µ –∫ Kubernetes liveness/readiness probes

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –¥–∞–ª—å—à–µ –º–æ–∂–µ–º:

* —Å–¥–µ–ª–∞—Ç—å **—Ñ–∏–Ω–∞–ª—å–Ω—ã–π –º–∏–Ω–∏-–ø—Ä–æ–µ–∫—Ç**
* –∏–ª–∏ –æ—Ñ–æ—Ä–º–∏—Ç—å **—ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ**
* –∏–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å **—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ Docker Compose vs Kubernetes**
