–û—Ç–ª–∏—á–Ω–æ, —Ç–æ–≥–¥–∞ –¥–µ–ª–∞–µ–º **–ø–æ–ª–Ω–æ—Å—Ç—å—é hands-on –ø—Ä–∞–∫—Ç–∏–∫—É–º**, –ø—Ä—è–º ¬´–∑–∞–ø—É—Å—Ç–∏–ª ‚Üí —Å–ª–æ–º–∞–ª ‚Üí –ø–æ—á–∏–Ω–∏–ª ‚Üí —É–≤–∏–¥–µ–ª —Ü–∏—Ñ—Ä—ã¬ª. –ù–∏–∂–µ ‚Äî **—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è junior-–≤–µ—Ä—Å–∏—è**, –±–µ–∑ –ª–∏—à–Ω–µ–π –º–∞–≥–∏–∏, –Ω–æ —Å –Ω–∞—Å—Ç–æ—è—â–∏–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º.

---

# üß™ –ü—Ä–∞–∫—Ç–∏–∫—É–º

## ¬´Django –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç—Ä–∏–∫–∏ —Å Docker Compose¬ª

**–£—Ä–æ–≤–µ–Ω—å:** junior
**–§–æ—Ä–º–∞—Ç:** –ø–æ—à–∞–≥–æ–≤–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞
**–í—Ä–µ–º—è:** ~2 —á–∞—Å–∞
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

* —Å—Ç—É–¥–µ–Ω—Ç **—É–≤–∏–¥–∏—Ç –ø—Ä–æ–±–ª–µ–º—É**
* **–ø–æ—á—É–≤—Å—Ç–≤—É–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É** –æ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
* **—É–≤–∏–¥–∏—Ç –≥—Ä–∞—Ñ–∏–∫–∏ –≤ Grafana**

---

## 0Ô∏è‚É£ –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ

–ú–∏–Ω–∏–º—É–º:

* Docker + Docker Compose
* –±–∞–∑–æ–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ Django (views, models)
* HTTP (–∑–∞–ø—Ä–æ—Å / –æ—Ç–≤–µ—Ç)

–ù–∏–∫–∞–∫–∏—Ö:
‚ùå Kubernetes
‚ùå —Å–ª–æ–∂–Ω—ã—Ö SQL
‚ùå production-–º–∞–≥–∏–∏

---

## 1Ô∏è‚É£ –°—Ç–∞—Ä—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç (–º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ v1

```
Browser ‚Üí Django ‚Üí Postgres
```

### docker-compose.yml (v1)

```yaml
version: "3.9"

services:
  web:
    build: .
    ports:
      - "8000:8000"
    depends_on:
      - db

  db:
    image: postgres:15
    environment:
      POSTGRES_DB: app
      POSTGRES_USER: app
      POSTGRES_PASSWORD: app
```

---

### Django: –ø—Ä–æ—Å—Ç–æ–π, –Ω–æ —Ç—è–∂—ë–ª—ã–π endpoint

```python
# views.py
from django.http import JsonResponse
from .models import Order

def orders(request):
    data = list(Order.objects.values())
    return JsonResponse({"count": len(data)})
```

> ‚ö†Ô∏è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ **–±–µ–∑ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**

---

### –ü—Ä–æ–≤–µ—Ä—è–µ–º

```bash
docker compose up --build
```

–û—Ç–∫—Ä—ã–≤–∞–µ–º:

```
http://localhost:8000/orders
```

‚úÖ –û—Ç–≤–µ—Ç –µ—Å—Ç—å
‚úÖ –í—Å—ë –±—ã—Å—Ç—Ä–æ

---

## 2Ô∏è‚É£ –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–≥—Ä—É–∑–∫—É (–ª–æ–º–∞–µ–º —Å–∏—Å—Ç–µ–º—É)

### –ü–æ–¥–∫–ª—é—á–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π –Ω–∞–≥—Ä—É–∑—á–∏–∫ ‚Äî **wrk**

```bash
wrk -t4 -c50 -d30s http://localhost:8000/orders
```

### –ß—Ç–æ —Å—Ç—É–¥–µ–Ω—Ç—ã –≤–∏–¥—è—Ç:

* –∑–∞–ø—Ä–æ—Å—ã –Ω–∞—á–∏–Ω–∞—é—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å
* –ø–æ—è–≤–ª—è—é—Ç—Å—è 500 –æ—à–∏–±–∫–∏
* CPU –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Django 100%

üí¨ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ (–ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏):

> Django –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å **–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**
> –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∂–¥—É—Ç ‚Üí –æ—á–µ—Ä–µ–¥—å ‚Üí —Ç–æ—Ä–º–æ–∑–∞

---

## 3Ô∏è‚É£ –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ (—Å–∞–º–∞—è –º–∞–≥–∏—è –¥–ª—è junior)

### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Browser ‚Üí Django ‚Üí Postgres
              ‚Üì
          Prometheus ‚Üí Grafana
```

---

### docker-compose.yml (v2)

```yaml
services:
  web:
    build: .
    ports:
      - "8000:8000"

  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml

  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
```

---

### Prometheus config (–æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–π)

```yaml
global:
  scrape_interval: 5s

scrape_configs:
  - job_name: "django"
    static_configs:
      - targets: ["web:8000"]
```

---

### Django: –¥–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏

```bash
pip install django-prometheus
```

```python
INSTALLED_APPS = [
    "django_prometheus",
]

MIDDLEWARE = [
    "django_prometheus.middleware.PrometheusBeforeMiddleware",
    ...
    "django_prometheus.middleware.PrometheusAfterMiddleware",
]
```

```python
urlpatterns = [
    path("metrics/", include("django_prometheus.urls")),
]
```

---

### –ó–∞—Ö–æ–¥–∏–º –≤ Grafana

```
http://localhost:3000
login: admin
password: admin
```

–î–æ–±–∞–≤–ª—è–µ–º:

* Data source ‚Üí Prometheus
* URL: `http://prometheus:9090`

üìä –°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫:

```
http_requests_total
```

---

## 4Ô∏è‚É£ –°–º–æ—Ç—Ä–∏–º –±–æ–ª—å –≤ –≥—Ä–∞—Ñ–∏–∫–∞—Ö üòà

–ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞–≥—Ä—É–∑–∫—É –µ—â—ë —Ä–∞–∑.

**–í Grafana –≤–∏–¥–Ω–æ:**

* —Ä–µ–∑–∫–∏–π —Ä–æ—Å—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
* —Ä–æ—Å—Ç –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
* plateau ‚Üí —Å–µ—Ä–≤–∏—Å ¬´—É–ø—ë—Ä—Å—è¬ª

üí¨ –ö–ª—é—á–µ–≤–∞—è –º—ã—Å–ª—å:

> –ü—Ä–æ–±–ª–µ–º–∞ **–≤–∏–¥–Ω–∞ –≥–ª–∞–∑–∞–º–∏**, –Ω–µ –Ω–∞ —Å–ª–æ–≤–∞—Ö

---

## 5Ô∏è‚É£ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º Django (–≥–ª–∞–≤–Ω—ã–π –º–æ–º–µ–Ω—Ç –∑–∞–Ω—è—Ç–∏—è)

### –û–±–Ω–æ–≤–ª—è–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

```
Browser ‚Üí Nginx ‚Üí Django x3 ‚Üí Postgres
```

---

### docker-compose.yml (v3)

```yaml
services:
  web:
    build: .
    expose:
      - "8000"

  nginx:
    image: nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - web
```

```bash
docker compose up --scale web=3
```

---

### Nginx config (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π)

```nginx
events {}

http {
  upstream django {
    server web:8000;
  }

  server {
    listen 80;

    location / {
      proxy_pass http://django;
    }
  }
}
```

---

## 6Ô∏è‚É£ –ü–æ–≤—Ç–æ—Ä—è–µ–º –Ω–∞–≥—Ä—É–∑–∫—É üöÄ

```bash
wrk -t4 -c50 -d30s http://localhost/orders
```

### –ß—Ç–æ –≤–∏–¥—è—Ç —Å—Ç—É–¥–µ–Ω—Ç—ã:

‚úÖ –∑–∞–ø—Ä–æ—Å–æ–≤ –±–æ–ª—å—à–µ
‚úÖ –æ—à–∏–±–æ–∫ –º–µ–Ω—å—à–µ
‚úÖ latency –Ω–∏–∂–µ
üìä Grafana –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–æ—Å—Ç throughput

üí¨ –ü—Ä–æ—Å—Ç–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ:

> –¢–µ–ø–µ—Ä—å –∑–∞–ø—Ä–æ—Å—ã –¥–µ–ª—è—Ç—Å—è –º–µ–∂–¥—É **–Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ Django**

---

## 7Ô∏è‚É£ –ü–æ—á–µ–º—É Postgres –≤—Å—ë –µ—â—ë –º–æ–∂–µ—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å

–ë–µ–∑ —É–≥–ª—É–±–ª–µ–Ω–∏—è:

* Django —Å—Ç–∞–ª–æ –º–Ω–æ–≥–æ
* Postgres –æ—Å—Ç–∞–ª—Å—è –æ–¥–∏–Ω
* –≤—Å–µ Django **–±–µ–≥—É—Ç –∫ –æ–¥–Ω–æ–π –±–∞–∑–µ**

üìå –í–∞–∂–Ω–æ –¥–ª—è junior:

> Docker Compose –ø–æ–º–æ–≥–∞–µ—Ç **–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã**,
> –Ω–æ **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ**

---

## 8Ô∏è‚É£ –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å)

**–°—Ç—É–¥–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –∑–Ω–∞–µ—Ç:**

* –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–∞–≥—Ä—É–∑–∫–∞
* –∫–∞–∫ —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–±–ª–µ–º—É –≤ –º–µ—Ç—Ä–∏–∫–∞—Ö
* –∑–∞—á–µ–º –Ω—É–∂–µ–Ω load balancer
* –ø–æ—á–µ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –Ω–µ –≤–æ–ª—à–µ–±—Å—Ç–≤–æ

---

## üèÅ –î–æ–º–∞—à–∫–∞ (–ø—Ä–æ—Å—Ç–∞—è)

1. –£–≤–µ–ª–∏—á–∏—Ç—å `web=5`
2. –°—Ä–∞–≤–Ω–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏
3. –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à Redis (–ø–æ –∂–µ–ª–∞–Ω–∏—é)

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –º–æ–≥—É:

* üß© –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —ç—Ç–æ –≤ **—á–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è**
* üéì –æ—Ñ–æ—Ä–º–∏—Ç—å –∫–∞–∫ **–º–µ—Ç–æ–¥–∏—á–∫—É**
* üß™ –¥–æ–±–∞–≤–∏—Ç—å **PgBouncer**
* üì¶ –≤—ã–ª–æ–∂–∏—Ç—å –∫–∞–∫ **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π-—Å–∫–µ–ª–µ—Ç**

–°–∫–∞–∂–∏, –¥–ª—è –∫–æ–≥–æ —ç—Ç–æ ‚Äî –∫—É—Ä—Å, –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —à–∫–æ–ª–∞ –∏–ª–∏ –º–∏—Ç–∞–ø üëÄ

