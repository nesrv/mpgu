# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –∫ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ: GraphQL Subscriptions

**–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞:** –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

---

## üìå –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
- –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—É—é —Ä–∞–±–æ—Ç—É
- –ò–º–µ—Ç—å —Ä–∞–±–æ—á–∏–π GraphQL API —Å Subscriptions
- –ü–æ–Ω–∏–º–∞—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã Pub/Sub –ø–∞—Ç—Ç–µ—Ä–Ω–∞

**–û—Ü–µ–Ω–∫–∞:** –ö–∞–∂–¥–æ–µ –∑–∞–¥–∞–Ω–∏–µ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –±–∞–ª–ª—ã –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ.

---

## –ó–∞–¥–∞–Ω–∏–µ 1: –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π (‚òÖ‚òÖ‚òÜ)

### –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Ç–∏–ø—É –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:**

```python
@strawberry.enum
class NotificationType:
    INFO = "info"
    WARNING = "warning"
    ERROR = "error"
    SUCCESS = "success"

@strawberry.enum
class NotificationPriority:
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"

@strawberry.type
class Notification:
    id: int
    user_id: int
    type: NotificationType
    priority: NotificationPriority
    title: str
    message: str
    created_at: datetime
    read: bool = False
```

2. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:**

```graphql
subscription OnNotification(
  $userId: Int!
  $types: [NotificationType!]
  $minPriority: NotificationPriority
) {
  onNotification(
    userId: $userId
    types: $types
    minPriority: $minPriority
  ) {
    id
    type
    priority
    title
    message
    createdAt
  }
}
```

3. **–î–æ–±–∞–≤—å—Ç–µ –º—É—Ç–∞—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**

```graphql
mutation SendNotification($input: NotificationInput!) {
  sendNotification(input: $input) {
    id
    title
    message
  }
}
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º—É –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (LOW < MEDIUM < HIGH)
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–¥–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—Ç–∫—Ä–æ–π—Ç–µ 3 –≤–∫–ª–∞–¥–∫–∏ GraphQL Playground –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–í–∫–ª–∞–¥–∫–∞ 1:** –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 1
2. **–í–∫–ª–∞–¥–∫–∞ 2:** –ü–æ–¥–ø–∏—Å–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ ERROR –∏ WARNING –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 1
3. **–í–∫–ª–∞–¥–∫–∞ 3:** –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## –ó–∞–¥–∞–Ω–∏–µ 2: Typing Indicator ("–ø–µ—á–∞—Ç–∞–µ—Ç...") (‚òÖ‚òÖ‚òÖ)

### –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑—É–π—Ç–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞ (–∫–∞–∫ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞—Ö), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª–µ.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö:**

```python
@strawberry.type
class TypingIndicator:
    channel_id: int
    user_id: int
    user_name: str
    is_typing: bool
    timestamp: datetime
```

2. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É:**

```graphql
subscription OnTyping($channelId: Int!) {
  onTyping(channelId: $channelId) {
    userId
    userName
    isTyping
    timestamp
  }
}
```

3. **–î–æ–±–∞–≤—å—Ç–µ –º—É—Ç–∞—Ü–∏—é:**

```graphql
mutation SetTyping($channelId: Int!, $isTyping: Boolean!) {
  setTyping(channelId: $channelId, isTyping: $isTyping) {
    success
  }
}
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `asyncio.create_task()` –¥–ª—è —Ç–∞–π–º–µ—Ä–∞
- –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–µ—á–∞—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –∫–∞–Ω–∞–ª–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –•—Ä–∞–Ω–∏—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ (—Å–ª–æ–≤–∞—Ä—å)

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ "–ø–µ—á–∞—Ç–∞–µ—Ç"
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤ –æ–¥–Ω–æ–º –∫–∞–Ω–∞–ª–µ
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ 2 –≤–∫–ª–∞–¥–∫–∏ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π –Ω–∞ –∫–∞–Ω–∞–ª
2. –í —Ç—Ä–µ—Ç—å–µ–π –≤–∫–ª–∞–¥–∫–µ –≤—ã–∑—ã–≤–∞–π—Ç–µ `setTyping(isTyping: true)`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ—è–≤–ª—è–µ—Ç—Å—è —É –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
4. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 3 —Å–µ–∫—É–Ω–¥—ã –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏—Å—á–µ–∑

---

## –ó–∞–¥–∞–Ω–∏–µ 3: –°—á–µ—Ç—á–∏–∫ –æ–Ω–ª–∞–π–Ω-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ–º (‚òÖ‚òÖ‚òÖ)

### –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ–Ω–ª–∞–π–Ω-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –º–µ—Ö–∞–Ω–∏–∑–º–æ–º heartbeat (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏).

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:**

```python
@strawberry.type
class UserPresence:
    user_id: int
    user_name: str
    status: str  # "online", "away", "offline"
    last_seen: datetime

@strawberry.type
class OnlineStats:
    total_online: int
    total_away: int
    users: list[UserPresence]
```

2. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É:**

```graphql
subscription OnPresenceChange {
  onPresenceChange {
    totalOnline
    totalAway
    users {
      userId
      userName
      status
      lastSeen
    }
  }
}
```

3. **–î–æ–±–∞–≤—å—Ç–µ –º—É—Ç–∞—Ü–∏–∏:**

```graphql
mutation UpdatePresence($status: String!) {
  updatePresence(status: $status) {
    success
  }
}

mutation Heartbeat {
  heartbeat {
    success
    nextHeartbeatIn
  }
}
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- Heartbeat –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –ï—Å–ª–∏ heartbeat –Ω–µ –ø–æ–ª—É—á–µ–Ω 60 —Å–µ–∫—É–Ω–¥ ‚Üí —Å—Ç–∞—Ç—É—Å "away"
- –ï—Å–ª–∏ heartbeat –Ω–µ –ø–æ–ª—É—á–µ–Ω 120 —Å–µ–∫—É–Ω–¥ ‚Üí —Å—Ç–∞—Ç—É—Å "offline"
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ–Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –•—Ä–∞–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ Redis (–∏–ª–∏ in-memory –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è)

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –≤ "away" –∏ "offline"
- ‚úÖ Heartbeat –º–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å: —Ä–∞–±–æ—Ç–∞ —Å 100+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∫–ª–∞–¥–æ–∫ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π
2. –í –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–µ –≤—ã–∑—ã–≤–∞–π—Ç–µ `updatePresence(status: "online")`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ heartbeat –≤ –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ
4. –ó–∞–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏–ª—Å—è –Ω–∞ "offline"
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—á–µ—Ç—á–∏–∫–æ–≤

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–±–æ–Ω—É—Å)

–î–æ–±–∞–≤—å—Ç–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é:
- –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–π HTML/JS –∫–ª–∏–µ–Ω—Ç
- –û—Ç–æ–±—Ä–∞–∂–∞–π—Ç–µ —Å–ø–∏—Å–æ–∫ –æ–Ω–ª–∞–π–Ω-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ü–≤–µ—Ç–æ–≤—É—é –∏–Ω–¥–∏–∫–∞—Ü–∏—é —Å—Ç–∞—Ç—É—Å–æ–≤

---

## –ó–∞–¥–∞–Ω–∏–µ 4: –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ª–∞–π–∫–∏ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é (‚òÖ‚òÖ‚òÜ)

### –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –ª–∞–π–∫–æ–≤ —Å real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ª–∞–π–∫–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ª–∞–π–∫–∞—Ö –∫ —Å–≤–æ–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è–º.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:**

```python
@strawberry.type
class Like:
    id: int
    message_id: int
    user_id: int
    user_name: str
    created_at: datetime

@strawberry.type
class LikeStats:
    message_id: int
    total_likes: int
    recent_likes: list[Like]
    user_liked: bool  # –ª–∞–π–∫–Ω—É–ª –ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
```

2. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –ª–∞–π–∫–∏:**

```graphql
subscription OnMessageLikes($messageId: Int!) {
  onMessageLikes(messageId: $messageId) {
    messageId
    totalLikes
    recentLikes {
      id
      userId
      userName
      createdAt
    }
  }
}
```

3. **–î–æ–±–∞–≤—å—Ç–µ –º—É—Ç–∞—Ü–∏–∏:**

```graphql
mutation LikeMessage($messageId: Int!) {
  likeMessage(messageId: $messageId) {
    success
    totalLikes
  }
}

mutation UnlikeMessage($messageId: Int!) {
  unlikeMessage(messageId: $messageId) {
    success
    totalLikes
  }
}
```

4. **–î–æ–±–∞–≤—å—Ç–µ Query –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**

```graphql
query GetLikeStats($messageId: Int!) {
  likeStats(messageId: $messageId) {
    messageId
    totalLikes
    recentLikes {
      userId
      userName
    }
    userLiked
  }
}
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ª–∞–π–∫–Ω—É—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –ª–∞–π–∫–µ ‚Äî —É–±—Ä–∞—Ç—å –ª–∞–π–∫ (toggle)
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ª–∞–π–∫–æ–≤ –≤ `recentLikes`
- –•—Ä–∞–Ω–∏—Ç—å –ª–∞–π–∫–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ in-memory —Å–ª–æ–≤–∞—Ä–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–∏–º–µ—Ä)

```python
# In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
likes_storage = {
    # message_id: {user_id: Like}
    1: {
        10: Like(id=1, message_id=1, user_id=10, user_name="Alice", ...),
        20: Like(id=2, message_id=1, user_id=20, user_name="Bob", ...),
    }
}
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ª–∞–π–∫–æ–≤ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ)
- ‚úÖ Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
- ‚úÖ –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–∏–Ω –ª–∞–π–∫ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ª–∞–π–∫–æ–≤
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ª–∞–π–∫–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**

1. **–í–∫–ª–∞–¥–∫–∞ 1:** –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ª–∞–π–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è #1
```graphql
subscription {
  onMessageLikes(messageId: 1) {
    totalLikes
    recentLikes {
      userName
    }
  }
}
```

2. **–í–∫–ª–∞–¥–∫–∞ 2:** –õ–∞–π–∫–Ω—É—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Alice
```graphql
mutation {
  likeMessage(messageId: 1) {
    success
    totalLikes
  }
}
```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í–∫–ª–∞–¥–∫–∞ 1 –¥–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å `totalLikes: 1`

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ª–∞–π–∫–∏**

1. –û—Ç–∫—Ä–æ–π—Ç–µ 3 –≤–∫–ª–∞–¥–∫–∏ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ #1
2. –í 3 –¥—Ä—É–≥–∏—Ö –≤–∫–ª–∞–¥–∫–∞—Ö –ª–∞–π–∫–Ω–∏—Ç–µ –æ—Ç —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `totalLikes` —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –£–¥–∞–ª–µ–Ω–∏–µ –ª–∞–π–∫–∞**

1. –õ–∞–π–∫–Ω–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –ü–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–∑–æ–≤–∏—Ç–µ `likeMessage` (–∏–ª–∏ `unlikeMessage`)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ª–∞–π–∫ —É–¥–∞–ª–µ–Ω –∏ —Å—á–µ—Ç—á–∏–∫ —É–º–µ–Ω—å—à–∏–ª—Å—è

### –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–æ–¥—Å–∫–∞–∑–∫–∞)

```python
# –í schema.py

@strawberry.type
class Mutation:
    @strawberry.mutation
    async def like_message(
        self,
        message_id: int,
        info: strawberry.Info
    ) -> LikeResult:
        user_id = info.context["user_id"]  # –ò–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        user_name = info.context["user_name"]
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
        if message_id not in messages:
            raise Exception("Message not found")
        
        # Toggle –ª–∞–π–∫–∞
        if message_id not in likes_storage:
            likes_storage[message_id] = {}
        
        if user_id in likes_storage[message_id]:
            # –£–¥–∞–ª–∏—Ç—å –ª–∞–π–∫
            del likes_storage[message_id][user_id]
        else:
            # –î–æ–±–∞–≤–∏—Ç—å –ª–∞–π–∫
            like = Like(
                id=generate_id(),
                message_id=message_id,
                user_id=user_id,
                user_name=user_name,
                created_at=datetime.now()
            )
            likes_storage[message_id][user_id] = like
        
        # –ü–æ–¥—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        total = len(likes_storage[message_id])
        recent = list(likes_storage[message_id].values())[-5:]
        
        # –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è
        await pubsub.publish(
            f"message_likes:{message_id}",
            {
                "message_id": message_id,
                "total_likes": total,
                "recent_likes": recent
            }
        )
        
        return LikeResult(success=True, total_likes=total)
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–±–æ–Ω—É—Å)

- **+3 –±–∞–ª–ª–∞:** –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –ª–∞–π–∫–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- **+3 –±–∞–ª–ª–∞:** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –ª–∞–π–∫–Ω—É–ª–∏ (tooltip)
- **+4 –±–∞–ª–ª–∞:** –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —Ä–µ–∞–∫—Ü–∏–π (üëç, ‚ù§Ô∏è, üòÇ, üòÆ, üò¢)

---

## üìä –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π

| –ó–∞–¥–∞–Ω–∏–µ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –ú–∞–∫—Å. –±–∞–ª–ª—ã | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è |
|---------|-----------|-------------|------------|
| –ó–∞–¥–∞–Ω–∏–µ 1 | ‚òÖ‚òÖ‚òÜ | 10 –±–∞–ª–ª–æ–≤ | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ |
| –ó–∞–¥–∞–Ω–∏–µ 2 | ‚òÖ‚òÖ‚òÖ | 15 –±–∞–ª–ª–æ–≤ | –¢–∞–π–º–µ—Ä—ã, —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è |
| –ó–∞–¥–∞–Ω–∏–µ 3 | ‚òÖ‚òÖ‚òÖ | 20 –±–∞–ª–ª–æ–≤ | Heartbeat, —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å |
| –ó–∞–¥–∞–Ω–∏–µ 4 | ‚òÖ‚òÖ‚òÜ | 12 –±–∞–ª–ª–æ–≤ | –õ–∞–π–∫–∏, toggle –ª–æ–≥–∏–∫–∞, real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ë–æ–Ω—É—Å—ã:**
- +5 –±–∞–ª–ª–æ–≤ –∑–∞ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ (pytest)
- +5 –±–∞–ª–ª–æ–≤ –∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API (docstrings)
- +10 –±–∞–ª–ª–æ–≤ –∑–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é (HTML/JS –∫–ª–∏–µ–Ω—Ç)

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é

1. **–ù–∞—á–Ω–∏—Ç–µ —Å –ó–∞–¥–∞–Ω–∏—è 1** ‚Äî –æ–Ω–æ –ø—Ä–æ—â–µ –∏ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
2. **–ó–∞–¥–∞–Ω–∏–µ 2** —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–π–º–µ—Ä–∞–º–∏ ‚Äî –∏–∑—É—á–∏—Ç–µ `asyncio.create_task()`
3. **–ó–∞–¥–∞–Ω–∏–µ 3** —Å–∞–º–æ–µ —Å–ª–æ–∂–Ω–æ–µ ‚Äî –Ω–∞—á–Ω–∏—Ç–µ —Å –ø—Ä–æ—Å—Ç–æ–π –≤–µ—Ä—Å–∏–∏ –±–µ–∑ heartbeat

### –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Strawberry GraphQL Subscriptions](https://strawberry.rocks/docs/types/subscriptions)
- [asyncio ‚Äî –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ](https://docs.python.org/3/library/asyncio.html)
- [Redis Pub/Sub](https://redis.io/docs/manual/pubsub/)

---

## üìù –û—Ç—á–µ—Ç –ø–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –∑–∞–¥–∞–Ω–∏—è–º

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:

1. **–ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** (—Ñ–∞–π–ª—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏)
2. **–°–∫—Ä–∏–Ω—à–æ—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** (GraphQL Playground)
3. **–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º** –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–π
4. **–ò–∑–º–µ—Ä–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

### –§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞

```markdown
# –û—Ç—á–µ—Ç: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ ‚ÑñX

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
[–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞]

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
[–°–∫—Ä–∏–Ω—à–æ—Ç—ã + –æ–ø–∏—Å–∞–Ω–∏–µ]

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è
[–ß—Ç–æ –±—ã–ª–æ —Å–ª–æ–∂–Ω–æ, –∫–∞–∫ —Ä–µ—à–∏–ª–∏]

## –í—ã–≤–æ–¥—ã
[–ß—Ç–æ —É–∑–Ω–∞–ª–∏, —á–µ–º—É –Ω–∞—É—á–∏–ª–∏—Å—å]
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Å–¥–∞—á–µ–π

- [ ] –ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Å–æ–±—ã—Ç–∏—è
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ)
- [ ] –ö–æ–¥ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω (docstrings)
- [ ] –°–æ–∑–¥–∞–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –ù–∞–ø–∏—Å–∞–Ω –æ—Ç—á–µ—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

**–£–¥–∞—á–∏ –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π! üöÄ**
