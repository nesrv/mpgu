<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞: FastAPI - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</title>
    <style media="print">
        body { font-family: Arial, sans-serif; font-size: 12px; }
        .container { box-shadow: none; background: white; }
        .header { background: white !important; color: black !important; }
        .save-btn { display: none !important; }
        .section { page-break-inside: avoid; }
        input, textarea { border: 1px solid #ccc; background: white; color: black; }
        .code-block { background: white !important; color: black !important; border: 1px solid #ccc; }
    </style>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            margin-top: 20px;
            margin-bottom: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .student-info {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #4A90E2;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .form-group textarea {
            min-height: auto;
            resize: vertical;
        }

        .section textarea.code-textarea {
            min-height: 300px;
        }

        .code-textarea {
            font-family: 'Courier New', monospace;
            background: #2d3748;
            color: #e2e8f0;
            white-space: pre;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #fff;
            border-left: 5px solid #4A90E2;
            border-radius: 0 10px 10px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #4A90E2;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .section h3 {
            color: #357ABD;
            margin: 20px 0 10px 0;
            font-size: 1.3em;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            white-space: pre;
        }

        .code-block .keyword { color: #ff79c6; font-weight: bold; }
        .code-block .string { color: #f1fa8c; }
        .code-block .function { color: #50fa7b; }
        .code-block .class { color: #8be9fd; }
        .code-block .decorator { color: #ff79c6; }
        .code-block .comment { color: #6272a4; font-style: italic; }
        .code-block .number { color: #bd93f9; }
        .code-block .operator { color: #ff79c6; }

        .checkbox-item {
            margin: 15px 0;
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .checkbox-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .checkbox-item input[type="checkbox"] {
            appearance: none;
            width: 24px;
            height: 24px;
            border: 3px solid white;
            border-radius: 6px;
            margin-right: 15px;
            cursor: pointer;
            position: relative;
            background: transparent;
            transition: all 0.3s;
        }

        .checkbox-item input[type="checkbox"]:checked {
            background: white;
        }

        .checkbox-item input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            top: -2px;
            left: 4px;
            font-size: 18px;
            color: #667eea;
            font-weight: bold;
        }

        .checkbox-item label {
            color: white;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
        }

        .save-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: transform 0.3s;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        ul {
            list-style: none;
            padding-left: 0;
        }

        ul li {
            padding: 8px 0 8px 30px;
            position: relative;
        }

        ul li::before {
            content: '‚ñ∏';
            position: absolute;
            left: 0;
            color: #4A90E2;
            font-size: 18px;
            font-weight: bold;
        }

        ol {
            padding-left: 25px;
            counter-reset: item;
        }

        ol li {
            padding: 8px 0;
            position: relative;
            list-style: none;
        }

        ol li::before {
            content: counter(item) ". ";
            counter-increment: item;
            color: #4A90E2;
            font-weight: bold;
            margin-right: 8px;
        }

        @media (max-width: 768px) {
            .student-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞</h1>
            <h2>FastAPI - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ)</h2>
            <p>–ò–∑—É—á–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö API —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π</p>
        </div>

        <div class="student-info">
            <div class="form-group">
                <label for="student-name">–§–ò–û —Å—Ç—É–¥–µ–Ω—Ç–∞:</label>
                <input type="text" id="student-name" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
            </div>
            <div class="form-group">
                <label for="group">–ì—Ä—É–ø–ø–∞:</label>
                <input type="text" id="group" placeholder="–ò–°–¢-401">
            </div>
            <div class="form-group">
                <label for="date">–î–∞—Ç–∞:</label>
                <input type="date" id="date">
            </div>
        </div>

        <div class="section">
            <h2>üéØ –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã</h2>
            <p>–ò–∑—É—á–∏—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö API —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º FastAPI, –≤–∫–ª—é—á–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –º–µ—Ç–æ–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.</p>
        </div>

        <div class="section">
            <h2>üì¶ –ó–∞–¥–∞–Ω–∏–µ 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –µ–≥–æ –∫ –°–£–ë–î</h2>
            
            <p>–£–º–µ–Ω—å—à–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–≤—Å–µ–≥–æ –±—É–¥–µ—Ç 2 —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞)</p>

            <h3>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:</h3>
            <div class="code-block"><span class="comment"># –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞</span>
project-auth/
‚îú‚îÄ‚îÄ main.py     
‚îú‚îÄ‚îÄ api.py    
‚îú‚îÄ‚îÄ models.py    
‚îú‚îÄ‚îÄ schemas.py    
‚îî‚îÄ‚îÄ service.py</div>

            <h3>–ö–æ–¥ —Ñ–∞–π–ª–æ–≤:</h3>
            <div class="code-block"><span class="comment"># main.py</span>

<span class="comment"># –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</span>
<span class="decorator">@asynccontextmanager</span>
<span class="keyword">async def</span> <span class="function">lifespan</span>(app: <span class="class">FastAPI</span>):
    <span class="string">"""–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""</span>
    <span class="comment"># –ö–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ</span>
    <span class="keyword">try</span>:
        <span class="function">create_tables</span>()  <span class="comment"># –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î</span>
        <span class="function">print</span>(<span class="string">"Database tables created successfully"</span>)
    <span class="keyword">except</span> <span class="class">Exception</span> <span class="keyword">as</span> e:
        <span class="function">print</span>(<span class="string">f"Database connection failed: {e}"</span>)    
    <span class="keyword">yield</span>  <span class="comment"># –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</span>
    <span class="comment"># –ö–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)</span>
    <span class="comment"># –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—á–∏—Å—Ç–∫—É —Ä–µ—Å—É—Ä—Å–æ–≤</span>


app = <span class="class">FastAPI</span>(
    title=<span class="string">"Student Management API"</span>,  <span class="comment"># –ù–∞–∑–≤–∞–Ω–∏–µ API</span>
    version=<span class="string">"1.0.0"</span>,  <span class="comment"># –í–µ—Ä—Å–∏—è</span>
    lifespan=lifespan  <span class="comment"># –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º</span>
)

app.<span class="function">include_router</span>(router)</div>

            <div class="code-block"><span class="comment"># api.py</span>
router = <span class="class">APIRouter</span>()

<span class="keyword">def</span> <span class="function">get_service</span>(db: <span class="class">Session</span> = <span class="function">Depends</span>(get_db)) -> <span class="class">StudentService</span>:
    <span class="keyword">return</span> <span class="class">StudentService</span>(db)

<span class="decorator">@router.post</span>(<span class="string">"/students/load-fixture"</span>)
<span class="keyword">def</span> <span class="function">load_fixture</span>(service: <span class="class">StudentService</span> = <span class="function">Depends</span>(get_service)):
    <span class="keyword">try</span>:
        service.<span class="function">load_fixture</span>()
        <span class="keyword">return</span> {<span class="string">"message"</span>: <span class="string">"Loaded students from fixture"</span>}
    <span class="keyword">except</span> <span class="class">Exception</span> <span class="keyword">as</span> e:
        <span class="keyword">return</span> {<span class="string">"error"</span>: <span class="string">f"Failed to load fixture: {str(e)}"</span>}

<span class="decorator">@router.get</span>(<span class="string">"/students/"</span>)
<span class="keyword">def</span> <span class="function">get_students</span>(service: <span class="class">StudentService</span> = <span class="function">Depends</span>(get_service)):
    <span class="keyword">try</span>:
        <span class="keyword">return</span> service.<span class="function">get_all</span>()
    <span class="keyword">except</span> <span class="class">Exception</span> <span class="keyword">as</span> e:
        <span class="keyword">return</span> {<span class="string">"error"</span>: <span class="string">f"Failed to get students: {str(e)}"</span>}</div>

            <div class="code-block"><span class="comment"># models.py</span>
DATABASE_URL = <span class="string">"postgresql://student:password@localhost:5435/students_db"</span>

engine = <span class="function">create_engine</span>(DATABASE_URL)
SessionLocal = <span class="function">sessionmaker</span>(bind=engine)
Base = <span class="function">declarative_base</span>()

<span class="keyword">class</span> <span class="class">StudentModel</span>(<span class="class">Base</span>):
    __tablename__ = <span class="string">"students"</span>
    id = <span class="function">Column</span>(<span class="class">Integer</span>, primary_key=<span class="keyword">True</span>)
    name = <span class="function">Column</span>(<span class="class">String</span>)
    data = <span class="function">Column</span>(<span class="class">JSON</span>, default={})
    courses = <span class="function">relationship</span>(<span class="string">"CourseModel"</span>, back_populates=<span class="string">"student"</span>)

<span class="keyword">class</span> <span class="class">CourseModel</span>(<span class="class">Base</span>):
    __tablename__ = <span class="string">"courses"</span>
    id = <span class="function">Column</span>(<span class="class">Integer</span>, primary_key=<span class="keyword">True</span>)
    name = <span class="function">Column</span>(<span class="class">String</span>)
    student_id = <span class="function">Column</span>(<span class="class">Integer</span>, <span class="function">ForeignKey</span>(<span class="string">"students.id"</span>))
    student = <span class="function">relationship</span>(<span class="string">"StudentModel"</span>, back_populates=<span class="string">"courses"</span>)

<span class="keyword">def</span> <span class="function">get_db</span>():
    db = <span class="function">SessionLocal</span>()
    <span class="keyword">try</span>:
        <span class="keyword">yield</span> db
    <span class="keyword">finally</span>:
        db.<span class="function">close</span>()

<span class="keyword">def</span> <span class="function">create_tables</span>():
    Base.metadata.<span class="function">create_all</span>(bind=engine)</div>

            <div class="code-block"><span class="comment"># schemas.py</span>
<span class="keyword">class</span> <span class="class">StudentResponse</span>(<span class="class">BaseModel</span>):
    id: <span class="class">int</span>
    name: <span class="class">str</span>
    data: <span class="class">dict</span></div>

            <div class="code-block"><span class="comment"># service.py</span>
<span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> <span class="class">Session</span>
<span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> text, func
<span class="keyword">from</span> models <span class="keyword">import</span> <span class="class">StudentModel</span>, <span class="class">CourseModel</span>, <span class="class">Base</span>, engine
<span class="keyword">from</span> schemas <span class="keyword">import</span> <span class="class">StudentResponse</span>, <span class="class">StudentCreate</span>
<span class="keyword">import</span> json

<span class="keyword">class</span> <span class="class">StudentService</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, db: <span class="class">Session</span>):
        <span class="keyword">self</span>.db = db
    
    <span class="keyword">def</span> <span class="function">load_fixture</span>(<span class="keyword">self</span>):
        <span class="keyword">with</span> <span class="function">open</span>(<span class="string">"fixtures.json"</span>, <span class="string">"r"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:
            data = json.<span class="function">load</span>(f)
        
        <span class="comment"># Load students</span>
        <span class="keyword">for</span> student_data <span class="keyword">in</span> data[<span class="string">"students"</span>]:
            student = <span class="class">StudentModel</span>(**student_data)
            <span class="keyword">self</span>.db.<span class="function">merge</span>(student)
        
        <span class="comment"># Load courses with enrollments</span>
        <span class="keyword">for</span> course_data <span class="keyword">in</span> data[<span class="string">"courses"</span>]:
            course_id = course_data[<span class="string">"id"</span>]
            course_name = course_data[<span class="string">"name"</span>]
            
            <span class="comment"># Find students enrolled in this course</span>
            enrolled_students = [e[<span class="string">"student_id"</span>] <span class="keyword">for</span> e <span class="keyword">in</span> data[<span class="string">"enrollments"</span>] <span class="keyword">if</span> e[<span class="string">"course_id"</span>] == course_id]
            
            <span class="keyword">for</span> student_id <span class="keyword">in</span> enrolled_students:
                course = <span class="class">CourseModel</span>(
                    name=course_name,
                    student_id=student_id
                )
                <span class="keyword">self</span>.db.<span class="function">merge</span>(course)
        
        <span class="keyword">self</span>.db.<span class="function">commit</span>()        
       <span class="comment"># –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ID</span>  
        max_id = <span class="keyword">self</span>.db.<span class="function">query</span>(<span class="function">func.max</span>(<span class="class">StudentModel</span>.id)).<span class="function">scalar</span>() <span class="keyword">or</span> <span class="number">0</span>
        <span class="keyword">self</span>.db.<span class="function">execute</span>(<span class="function">func.setval</span>(<span class="string">'students_id_seq'</span>, max_id))
    
    <span class="keyword">def</span> <span class="function">get_all</span>(<span class="keyword">self</span>) -> <span class="class">List</span>[<span class="class">StudentResponse</span>]:
        students = <span class="keyword">self</span>.db.<span class="function">query</span>(<span class="class">StudentModel</span>).<span class="function">all</span>()
        <span class="keyword">return</span> [<span class="class">StudentResponse</span>(
            id=s.id,
            name=s.name,
            data=s.data <span class="keyword">or</span> {}
        ) <span class="keyword">for</span> s <span class="keyword">in</span> students]</div>

            <h3>–ó–∞–ø—É—Å–∫ PostgreSQL –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:</h3>
            <div class="code-block"><span class="keyword">docker</span> <span class="function">run</span> <span class="operator">-d</span> <span class="operator">-p</span> <span class="number">5432</span>:<span class="number">5432</span> postgres-students</div>

            <h3>Dockerfile –¥–ª—è PostgreSQL:</h3>
            <div class="code-block"><span class="keyword">FROM</span> postgres:<span class="number">17</span>

<span class="keyword">ENV</span> POSTGRES_DB=students_db
<span class="keyword">ENV</span> POSTGRES_USER=student
<span class="keyword">ENV</span> POSTGRES_PASSWORD=password

<span class="keyword">EXPOSE</span> <span class="number">5432</span></div>

            <div class="checkbox-item">
                <input type="checkbox" id="task1-1">
                <label for="task1-1">–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –°–£–ë–î</label>
            </div>

            <div class="checkbox-item">
                <input type="checkbox" id="task1-2">
                <label for="task1-2">API –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω</label>
            </div>
        </div>

        <div class="section">
            <h2>üîê –ó–∞–¥–∞–Ω–∏–µ 2. –ò–∑—É—á–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é HTTP Basic Auth</h2>
            
            <p>–°–¥–µ–ª–∞–π—Ç–µ –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ @router.get("/students/") –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é HTTP Basic Auth</p>
            <p>–î–ª—è —ç—Ç–æ–≥–æ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ:</p>

            <div class="code-block"><span class="comment"># auth.py - –ú–æ–¥—É–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</span>

<span class="keyword">from</span> fastapi <span class="keyword">import</span> <span class="class">Depends</span>, <span class="class">HTTPException</span>, status
<span class="keyword">from</span> fastapi.security <span class="keyword">import</span> <span class="class">HTTPBasic</span>, <span class="class">HTTPBasicCredentials</span>
<span class="keyword">import</span> secrets

<span class="comment"># –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è HTTP Basic Auth</span>
security = <span class="class">HTTPBasic</span>()


VALID_USERNAME = <span class="string">"admin"</span>
VALID_PASSWORD = <span class="string">"secret123"</span>


<span class="keyword">def</span> <span class="function">authenticate_user</span>(credentials: <span class="class">HTTPBasicCredentials</span> = <span class="function">Depends</span>(security)):
  
    <span class="comment"># –ü—Ä–æ–≤–µ—Ä—è–µ–º username —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç timing attacks</span>
    is_correct_username = secrets.<span class="function">compare_digest</span>(
        credentials.username.<span class="function">encode</span>(<span class="string">"utf8"</span>), VALID_USERNAME.<span class="function">encode</span>(<span class="string">"utf8"</span>)
    )
    <span class="comment"># –ü—Ä–æ–≤–µ—Ä—è–µ–º password —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç timing attacks</span>
    is_correct_password = secrets.<span class="function">compare_digest</span>(
        credentials.password.<span class="function">encode</span>(<span class="string">"utf8"</span>), VALID_PASSWORD.<span class="function">encode</span>(<span class="string">"utf8"</span>)
    )
    
    <span class="comment"># –ï—Å–ª–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ–≤–µ—Ä–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É 401</span>
    <span class="keyword">if not</span> (is_correct_username <span class="keyword">and</span> is_correct_password):
        <span class="keyword">raise</span> <span class="class">HTTPException</span>(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail=<span class="string">"–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"</span>,
            headers={<span class="string">"WWW-Authenticate"</span>: <span class="string">"Basic"</span>},  <span class="comment"># –£–∫–∞–∑—ã–≤–∞–µ–º —Ç–∏–ø –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</span>
        )
    
    <span class="keyword">return</span> credentials.username


<span class="comment"># –î–æ–±–∞–≤—å—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é Depency Injection</span>

<span class="comment"># api.py</span>

<span class="keyword">from</span> auth <span class="keyword">import</span> authenticate_user 

<span class="decorator">@router.get</span>(<span class="string">"/students/"</span>)
<span class="keyword">def</span> <span class="function">get_students</span>(
    service: <span class="class">StudentService</span> = <span class="function">Depends</span>(get_service),
    current_user: <span class="class">str</span> = <span class="function">Depends</span>(authenticate_user)  <span class="comment"># –¢—Ä–µ–±—É–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é</span>
):

    <span class="keyword">try</span>:
        <span class="function">print</span>(<span class="string">f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {current_user} –∑–∞–ø—Ä–æ—Å–∏–ª —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤"</span>)  <span class="comment"># –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
        <span class="keyword">return</span> service.<span class="function">get_all</span>()
    <span class="keyword">except</span> <span class="class">Exception</span> <span class="keyword">as</span> e:
        <span class="keyword">return</span> {<span class="string">"error"</span>: <span class="string">f"Failed to get students: {str(e)}"</span>}</div>

            <div class="checkbox-item">
                <input type="checkbox" id="task2-1">
                <label for="task2-1">HTTP Basic Auth —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω</label>
            </div>

            <div class="checkbox-item">
                <input type="checkbox" id="task2-2">
                <label for="task2-2">–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞</label>
            </div>
        </div>

        <div class="section">
            <h2>üîë –ó–∞–¥–∞–Ω–∏–µ 3. –î–æ–±–∞–≤—å—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é OAuth</h2>

            <h3>–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–¥–∏–º —ç–Ω–¥–ø–æ–∏–Ω—Ç @router.post("/") –∏ –ª–æ–≥–∏–∫—É –¥–ª—è –Ω–µ–≥–æ</h3>

            <div class="code-block"><span class="comment">#api.py</span>

<span class="decorator">@router.post</span>(<span class="string">"/students/"</span>, response_model=<span class="class">StudentResponse</span>)
<span class="keyword">def</span> <span class="function">create_student</span>(
    student_data: <span class="class">StudentCreate</span>,
    service = <span class="function">Depends</span>(get_service),
    current_user = <span class="function">Depends</span>(authenticate_user)  <span class="comment"># –¢—Ä–µ–±—É–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é</span>
):
   
    <span class="keyword">try</span>:
        <span class="function">print</span>(<span class="string">f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {current_user} —Å–æ–∑–¥–∞–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞: {student_data.name}"</span>)  <span class="comment"># –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
        <span class="keyword">return</span> service.<span class="function">create</span>(student_data)
    <span class="keyword">except</span> <span class="class">Exception</span> <span class="keyword">as</span> e:
        <span class="keyword">return</span> {<span class="string">"error"</span>: <span class="string">f"Failed to create student: {str(e)}"</span>}

<span class="comment"># schemas.py</span>

<span class="keyword">class</span> <span class="class">StudentCreate</span>(<span class="class">BaseModel</span>):
    name: <span class="class">str</span>
    data: <span class="class">dict</span> = {}


<span class="comment"># service.py</span>
<span class="keyword">class</span> <span class="class">StudentService</span>:
    ...

     <span class="keyword">def</span> <span class="function">create</span>(<span class="keyword">self</span>, student_data):
        student = <span class="class">StudentModel</span>(name=student_data.name, data=student_data.data <span class="keyword">or</span> {})
        <span class="keyword">self</span>.db.<span class="function">add</span>(student)
        <span class="keyword">self</span>.db.<span class="function">commit</span>()
        <span class="keyword">self</span>.db.<span class="function">refresh</span>(student)
        <span class="keyword">return</span> <span class="class">StudentResponse</span>(id=student.id, name=student.name, data=student.data <span class="keyword">or</span> {})</div>

            <h3>–ù–∞—Å—Ç—Ä–æ–∏–º OAuth –¥–ª—è —ç—Ç–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ @router.post("/students/")</h3>

            <div class="code-block"><span class="comment"># oauth.py - OAuth2 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</span>

<span class="keyword">from</span> fastapi <span class="keyword">import</span> <span class="class">Depends</span>, <span class="class">HTTPException</span>, status
<span class="keyword">from</span> fastapi.security <span class="keyword">import</span> <span class="class">OAuth2PasswordBearer</span>
<span class="keyword">import</span> secrets


<span class="comment"># ========== –ù–ê–°–¢–†–û–ô–ö–ê OAUTH2 ==========</span>
<span class="comment"># –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è Bearer Token (–ø—Ä–æ—â–µ –¥–ª—è Swagger)</span>
oauth2_scheme = <span class="class">HTTPBearer</span>()

<span class="comment"># OAuth2 —Ç–æ–∫–µ–Ω (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è)</span>
VALID_TOKEN = <span class="string">"secret-oauth-token"</span>

<span class="comment"># ========== –§–£–ù–ö–¶–ò–Ø OAUTH2 –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò ==========</span>
<span class="keyword">def</span> <span class="function">authenticate_oauth</span>(credentials = <span class="function">Depends</span>(oauth2_scheme)):
    <span class="comment"># –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç timing attacks</span>
    is_valid_token = secrets.<span class="function">compare_digest</span>(
        credentials.credentials.<span class="function">encode</span>(<span class="string">"utf8"</span>), VALID_TOKEN.<span class="function">encode</span>(<span class="string">"utf8"</span>)
    )
    
    <span class="keyword">if not</span> is_valid_token:
        <span class="keyword">raise</span> <span class="class">HTTPException</span>(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail=<span class="string">"–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω"</span>,
            headers={<span class="string">"WWW-Authenticate"</span>: <span class="string">"Bearer"</span>},
        )
    
    <span class="keyword">return</span> <span class="string">"oauth_user"</span>


<span class="comment"># api.py</span>

<span class="keyword">from</span> oauth <span class="keyword">import</span> authenticate_oauth  <span class="comment"># OAuth2 Bearer Token</span>

<span class="comment"># –î–æ–±–∞–≤–ª—è–µ–º  –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é Depency Injection</span>
<span class="decorator">@router.post</span>(<span class="string">"/students/"</span>)
<span class="keyword">def</span> <span class="function">create_student</span>(
    student_data: <span class="class">StudentCreate</span>,
    service = <span class="function">Depends</span>(get_service),
    current_user = <span class="function">Depends</span>(authenticate_oauth)  <span class="comment"># –¢—Ä–µ–±—É–µ–º OAuth2 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é</span>
):
   
 ...</div>

            <h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>

            <h4>–í Swagger UI –¥–ª—è OAuth2 –Ω—É–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω –Ω–∞–ø—Ä—è–º—É—é:</h4>

            <h4>–í–∞—Ä–∏–∞–Ω—Ç 1 - –ü—Ä–æ—Å—Ç–æ–π (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–∫–µ–Ω –Ω–∞–ø—Ä—è–º—É—é):</h4>
            <ul>
                <li>–í Swagger UI –Ω–∞–∂–º–∏—Ç–µ "Authorize" –∏ –≤–≤–µ–¥–∏—Ç–µ:</li>
                <li>Token : secret-oauth-token</li>
                <li>–û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º–∏</li>
            </ul>

            <h4>–í–∞—Ä–∏–∞–Ω—Ç 2 –°–æ–∑–¥–∞–¥–∏–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:</h4>

            <div class="code-block"><span class="comment"># ========== OAUTH –°–ï–†–í–ï–† –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ==========</span>

<span class="keyword">def</span> <span class="function">authenticate_user_for_token</span>(username: <span class="class">str</span>, password: <span class="class">str</span>):
    <span class="string">"""–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤—ã–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–∞"""</span>
    <span class="comment"># –ó–∞–≥–ª—É—à–∫–∞ - –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î</span>
    <span class="keyword">if</span> username == <span class="string">"admin"</span> <span class="keyword">and</span> password == <span class="string">"password"</span>:
        <span class="keyword">return</span> {<span class="string">"id"</span>: <span class="number">1</span>, <span class="string">"username"</span>: username}
    <span class="keyword">return</span> <span class="keyword">None</span>


<span class="decorator">@router.post</span>(<span class="string">"/oauth/token"</span>)
<span class="keyword">def</span> <span class="function">get_token</span>(credentials: <span class="class">OAuth2PasswordRequestForm</span> = <span class="function">Depends</span>()):
    <span class="comment"># –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è</span>
    user = <span class="function">authenticate_user_for_token</span>(credentials.username, credentials.password)
    <span class="keyword">if not</span> user:
        <span class="keyword">raise</span> <span class="class">HTTPException</span>(<span class="number">401</span>, <span class="string">"Invalid credentials"</span>)
    
    <span class="comment"># –í—ã–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–∞</span>
    access_token = <span class="function">create_access_token</span>(data={<span class="string">"sub"</span>: user[<span class="string">"id"</span>]})
    <span class="keyword">return</span> {<span class="string">"access_token"</span>: access_token, <span class="string">"token_type"</span>: <span class="string">"bearer"</span>}



<span class="comment"># oauth.py</span>

<span class="comment"># ========== –§–£–ù–ö–¶–ò–Ø OAUTH2 –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò ==========</span>
<span class="keyword">def</span> <span class="function">authenticate_oauth</span>(credentials = <span class="function">Depends</span>(oauth2_scheme)):
    <span class="keyword">if</span> VALID_TOKEN <span class="keyword">is</span> <span class="keyword">None</span>:
        <span class="keyword">raise</span> <span class="class">HTTPException</span>(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail=<span class="string">"–¢–æ–∫–µ–Ω –Ω–µ —Å–æ–∑–¥–∞–Ω"</span>,
            headers={<span class="string">"WWW-Authenticate"</span>: <span class="string">"Bearer"</span>},
        )
    
    <span class="comment"># –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç timing attacks</span>
    is_valid_token = secrets.<span class="function">compare_digest</span>(
        credentials.credentials.<span class="function">encode</span>(<span class="string">"utf8"</span>), VALID_TOKEN.<span class="function">encode</span>(<span class="string">"utf8"</span>)
    )
    
    <span class="keyword">if not</span> is_valid_token:
        <span class="keyword">raise</span> <span class="class">HTTPException</span>(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail=<span class="string">"–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω"</span>,
            headers={<span class="string">"WWW-Authenticate"</span>: <span class="string">"Bearer"</span>},
        )
    
    <span class="keyword">return</span> <span class="string">"oauth_user"</span>

<span class="comment"># ========== –§–£–ù–ö–¶–ò–Ø –°–û–ó–î–ê–ù–ò–Ø –ü–†–û–°–¢–û–ì–û –¢–û–ö–ï–ù–ê ==========</span>
<span class="keyword">def</span> <span class="function">create_access_token</span>(data: <span class="class">dict</span>):
    <span class="string">"""–°–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Å—Ç–æ–π UUID —Ç–æ–∫–µ–Ω"""</span>
    <span class="keyword">global</span> VALID_TOKEN
    token = <span class="class">str</span>(<span class="class">uuid</span>.<span class="function">uuid4</span>())
    VALID_TOKEN = token  <span class="comment"># –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</span>
    <span class="keyword">return</span> token</div>

            <h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>

            <h4>–®–∞–≥ 1 - –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω:</h4>
            <ul>
                <li>–ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç POST /token</li>
                <li>–ù–∞–∂–º–∏—Ç–µ "Try it out"</li>
                <li>–í–≤–µ–¥–∏—Ç–µ: username: admin, password: password</li>
                <li>–ù–∞–∂–º–∏—Ç–µ "Execute"</li>
                <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ access_token –∏–∑ –æ—Ç–≤–µ—Ç–∞</li>
            </ul>

            <h4>–®–∞–≥ 2 - –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è:</h4>
            <ul>
                <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Authorize" –≤–≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã</li>
                <li>–í —Ä–∞–∑–¥–µ–ª–µ OAuth2PasswordBearer –≤–≤–µ–¥–∏—Ç–µ: username: admin, password: password</li>
                <li>–ù–∞–∂–º–∏—Ç–µ "Authorize"</li>
                <li>–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω</li>
            </ul>

            <p>–¢–µ–ø–µ—Ä—å —ç–Ω–¥–ø–æ–∏–Ω—Ç POST /students/ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å OAuth2 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Swagger</p>

            <h3>–õ–∏—Å—Ç–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞</h3>

            <div class="code-block"><span class="comment"># ========== OAUTH –°–ï–†–í–ï–† –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ==========</span>

<span class="keyword">class</span> <span class="class">TokenRequest</span>(<span class="class">BaseModel</span>):
    username: <span class="class">str</span>
    password: <span class="class">str</span>

<span class="keyword">def</span> <span class="function">authenticate_user_for_token</span>(username: <span class="class">str</span>, password: <span class="class">str</span>):    
    <span class="comment"># –ó–∞–≥–ª—É—à–∫–∞ - –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î</span>
    <span class="keyword">if</span> username == <span class="string">"admin"</span> <span class="keyword">and</span> password == <span class="string">"password"</span>:
        <span class="keyword">return</span> {<span class="string">"id"</span>: <span class="number">1</span>, <span class="string">"username"</span>: username}
    <span class="keyword">return</span> <span class="keyword">None</span>

<span class="decorator">@router.post</span>(<span class="string">"/oauth/token"</span>)
<span class="keyword">def</span> <span class="function">get_token</span>(credentials: <span class="class">TokenRequest</span>):  
    user = <span class="function">authenticate_user_for_token</span>(credentials.username, credentials.password)
    <span class="keyword">if not</span> user:
        <span class="keyword">raise</span> <span class="class">HTTPException</span>(<span class="number">401</span>, <span class="string">"Invalid credentials"</span>)
    
    <span class="comment"># –í—ã–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–∞</span>
    access_token = <span class="function">create_access_token</span>(data={<span class="string">"sub"</span>: user[<span class="string">"id"</span>]})
    <span class="keyword">return</span> {<span class="string">"access_token"</span>: access_token, <span class="string">"token_type"</span>: <span class="string">"bearer"</span>}

<span class="decorator">@router.post</span>(<span class="string">"/students/load-fixture"</span>)
<span class="keyword">def</span> <span class="function">load_fixture</span>(service = <span class="function">Depends</span>(get_service)):
    ...

<span class="decorator">@router.post</span>(<span class="string">"/students/"</span>)
<span class="keyword">def</span> <span class="function">create_student</span>(
    student_data: <span class="class">StudentCreate</span>,
    service = <span class="function">Depends</span>(get_service),
    current_user = <span class="function">Depends</span>(authenticate_oauth)  <span class="comment"># –¢—Ä–µ–±—É–µ–º OAuth2 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é</span>
):
   
   ...

<span class="decorator">@router.get</span>(<span class="string">"/students/"</span>)
<span class="keyword">def</span> <span class="function">get_students</span>(
    service = <span class="function">Depends</span>(get_service),
    current_user = <span class="function">Depends</span>(authenticate_user)  <span class="comment"># –¢—Ä–µ–±—É–µ–º Basic Auth</span>
):
   ...

<span class="comment"># oauth.py</span>
<span class="keyword">from</span> fastapi <span class="keyword">import</span> <span class="class">Depends</span>, <span class="class">HTTPException</span>, status
<span class="keyword">from</span> fastapi.security <span class="keyword">import</span> <span class="class">HTTPBearer</span>
<span class="keyword">import</span> secrets
<span class="keyword">import</span> uuid

<span class="comment"># ========== –ù–ê–°–¢–†–û–ô–ö–ê OAUTH2 ==========</span>
<span class="comment"># –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è Bearer Token (–ø—Ä–æ—â–µ –¥–ª—è Swagger)</span>
oauth2_scheme = <span class="class">HTTPBearer</span>()

<span class="comment"># OAuth2 —Ç–æ–∫–µ–Ω (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è)</span>
VALID_TOKEN = <span class="keyword">None</span>  <span class="comment"># –ë—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞</span>

<span class="comment"># ========== –§–£–ù–ö–¶–ò–Ø OAUTH2 –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò ==========</span>
<span class="keyword">def</span> <span class="function">authenticate_oauth</span>(credentials = <span class="function">Depends</span>(oauth2_scheme)):
    <span class="keyword">if</span> VALID_TOKEN <span class="keyword">is</span> <span class="keyword">None</span>:
        <span class="keyword">raise</span> <span class="class">HTTPException</span>(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail=<span class="string">"–¢–æ–∫–µ–Ω –Ω–µ —Å–æ–∑–¥–∞–Ω"</span>,
            headers={<span class="string">"WWW-Authenticate"</span>: <span class="string">"Bearer"</span>},
        )
    
    <span class="comment"># –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç timing attacks</span>
    is_valid_token = secrets.<span class="function">compare_digest</span>(
        credentials.credentials.<span class="function">encode</span>(<span class="string">"utf8"</span>), VALID_TOKEN.<span class="function">encode</span>(<span class="string">"utf8"</span>)
    )
    
    <span class="keyword">if not</span> is_valid_token:
        <span class="keyword">raise</span> <span class="class">HTTPException</span>(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail=<span class="string">"–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω"</span>,
            headers={<span class="string">"WWW-Authenticate"</span>: <span class="string">"Bearer"</span>},
        )
    
    <span class="keyword">return</span> <span class="string">"oauth_user"</span>

<span class="comment"># ========== –§–£–ù–ö–¶–ò–Ø –°–û–ó–î–ê–ù–ò–Ø –ü–†–û–°–¢–û–ì–û –¢–û–ö–ï–ù–ê ==========</span>
<span class="keyword">def</span> <span class="function">create_access_token</span>(data: <span class="class">dict</span>):
    <span class="string">"""–°–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Å—Ç–æ–π UUID —Ç–æ–∫–µ–Ω"""</span>
    <span class="keyword">global</span> VALID_TOKEN
    token = <span class="class">str</span>(<span class="class">uuid</span>.<span class="function">uuid4</span>())
    VALID_TOKEN = token  <span class="comment"># –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</span>
    <span class="keyword">return</span> token</div>

            <div class="checkbox-item">
                <input type="checkbox" id="task3-1">
                <label for="task3-1">OAuth2 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞</label>
            </div>

            <div class="checkbox-item">
                <input type="checkbox" id="task3-2">
                <label for="task3-2">–°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω</label>
            </div>

            <div class="checkbox-item">
                <input type="checkbox" id="task3-3">
                <label for="task3-3">OAuth2 –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Swagger</label>
            </div>
        </div>

        <div class="section">
            <h2>üë• –ó–∞–¥–∞–Ω–∏–µ 4. –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>

            <p><strong>–ó–∞–¥–∞—á–∞:</strong> –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–æ–ª–µ–π –≤ Basic Auth.</p>

            <p><strong>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:</strong></p>
            <ol>
                <li>–°–æ–∑–¥–∞—Ç—å 3 —Ä–æ–ª–∏: admin, teacher, student</li>
                <li>–¢–æ–ª—å–∫–æ admin –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</li>
                <li>admin –∏ teacher –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</li>
                <li>–í—Å–µ —Ä–æ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</li>
                <li>–†–æ–ª—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ username: admin_*, teacher_*, student_*</li>
            </ol>

            <h3>–ó–∞–º–µ–Ω–∏ HTTP Basic Auth –Ω–∞ OAuth2.</h3>
            <p>–û–±–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Bearer —Ç–æ–∫–µ–Ω—ã:</p>
            <ul>
                <li>GET /students/</li>
                <li>POST /students/</li>
            </ul>

            <div class="code-block"><span class="comment"># api.py</span>
<span class="decorator">@router.get</span>(<span class="string">"/students/"</span>)
<span class="keyword">def</span> <span class="function">get_students</span>(
    service = <span class="function">Depends</span>(get_service),
    current_user = <span class="function">Depends</span>(authenticate_oauth)  <span class="comment"># –¢—Ä–µ–±—É–µ–º OAuth2 Auth</span>
):</div>

            <h3>–°–æ–∑–¥–∞–¥–∏–º —Ä–æ–ª–∏ –∏ –≤–Ω–µ—Å–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π</h3>

            <div class="code-block"><span class="comment"># roles.py</span>
<span class="keyword">from</span> fastapi <span class="keyword">import</span> <span class="class">HTTPException</span>, status
<span class="keyword">from</span> enum <span class="keyword">import</span> <span class="class">Enum</span>

<span class="keyword">class</span> <span class="class">Role</span>(<span class="class">str</span>, <span class="class">Enum</span>):
    ADMIN = <span class="string">"admin"</span>
    TEACHER = <span class="string">"teacher"</span>
    STUDENT = <span class="string">"student"</span>

<span class="comment"># –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—è–º–∏</span>
USERS = {
    <span class="string">"admin"</span>: {<span class="string">"password"</span>: <span class="string">"admin123"</span>, <span class="string">"role"</span>: <span class="class">Role</span>.ADMIN},
    <span class="string">"teacher"</span>: {<span class="string">"password"</span>: <span class="string">"teacher123"</span>, <span class="string">"role"</span>: <span class="class">Role</span>.TEACHER},
    <span class="string">"student"</span>: {<span class="string">"password"</span>: <span class="string">"student123"</span>, <span class="string">"role"</span>: <span class="class">Role</span>.STUDENT}
}

<span class="keyword">def</span> <span class="function">get_user_role</span>(username: <span class="class">str</span>) -> <span class="class">Role</span>:
    <span class="string">"""–ü–æ–ª—É—á–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""</span>
    user = USERS.<span class="function">get</span>(username)
    <span class="keyword">if not</span> user:
        <span class="keyword">raise</span> <span class="class">HTTPException</span>(status.HTTP_401_UNAUTHORIZED, <span class="string">"User not found"</span>)
    <span class="keyword">return</span> user[<span class="string">"role"</span>]

<span class="keyword">def</span> <span class="function">check_permission</span>(user_role: <span class="class">Role</span>, required_roles: <span class="class">list</span>[<span class="class">Role</span>]):
    <span class="string">"""–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞"""</span>
    <span class="keyword">if</span> user_role <span class="keyword">not in</span> required_roles:
        <span class="keyword">raise</span> <span class="class">HTTPException</span>(
            status_code=status.HTTP_403_FORBIDDEN,
            detail=<span class="string">f"Access denied. Required roles: {[r.value for r in required_roles]}"</span>
        )

<span class="comment"># api.py</span>

<span class="keyword">def</span> <span class="function">authenticate_user_for_token</span>(username: <span class="class">str</span>, password: <span class="class">str</span>):
    <span class="string">"""–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤—ã–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–∞"""</span>
    <span class="keyword">from</span> roles <span class="keyword">import</span> USERS
    user = USERS.<span class="function">get</span>(username)
    <span class="keyword">if</span> user <span class="keyword">and</span> user[<span class="string">"password"</span>] == password:
        <span class="keyword">return</span> {<span class="string">"id"</span>: <span class="number">1</span>, <span class="string">"username"</span>: username, <span class="string">"role"</span>: user[<span class="string">"role"</span>]}
    <span class="keyword">return</span> <span class="keyword">None</span>


<span class="decorator">@router.post</span>(<span class="string">"/students/"</span>)
<span class="keyword">def</span> <span class="function">create_student</span>(
    student_data: <span class="class">StudentCreate</span>,
    service = <span class="function">Depends</span>(get_service),
    current_user = <span class="function">Depends</span>(authenticate_oauth)  <span class="comment"># –¢—Ä–µ–±—É–µ–º OAuth2 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é</span>
):
    <span class="comment"># –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞</span>
    user_role = <span class="function">get_user_role</span>(current_user)
    <span class="function">check_permission</span>(user_role, [<span class="class">Role</span>.ADMIN, <span class="class">Role</span>.TEACHER])
    
    <span class="keyword">try</span>:
        <span class="function">print</span>(<span class="string">f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {current_user} ({user_role}) —Å–æ–∑–¥–∞–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞: {student_data.name}"</span>)
        <span class="keyword">return</span> service.<span class="function">create</span>(student_data)
    <span class="keyword">except</span> <span class="class">Exception</span> <span class="keyword">as</span> e:
        <span class="keyword">return</span> {<span class="string">"error"</span>: <span class="string">f"Failed to create student: {str(e)}"</span>}

<span class="decorator">@router.get</span>(<span class="string">"/students/"</span>)
<span class="keyword">def</span> <span class="function">get_students</span>(
    service = <span class="function">Depends</span>(get_service),
    current_user = <span class="function">Depends</span>(authenticate_user_with_role)  <span class="comment"># –¢—Ä–µ–±—É–µ–º Basic Auth</span>
):
    <span class="comment"># –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (–≤—Å–µ —Ä–æ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å)</span>
    user_role = <span class="function">get_user_role</span>(current_user)
    <span class="function">check_permission</span>(user_role, [<span class="class">Role</span>.ADMIN, <span class="class">Role</span>.TEACHER, <span class="class">Role</span>.STUDENT])
    
    <span class="keyword">try</span>:
        <span class="function">print</span>(<span class="string">f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {current_user} ({user_role}) –∑–∞–ø—Ä–æ—Å–∏–ª —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤"</span>)
        <span class="keyword">return</span> service.<span class="function">get_all</span>()
    <span class="keyword">except</span> <span class="class">Exception</span> <span class="keyword">as</span> e:
        <span class="keyword">return</span> {<span class="string">"error"</span>: <span class="string">f"Failed to get students: {str(e)}"</span>}</div>

            <div class="checkbox-item">
                <input type="checkbox" id="task4-1">
                <label for="task4-1">–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π —Å–æ–∑–¥–∞–Ω–∞</label>
            </div>

            <div class="checkbox-item">
                <input type="checkbox" id="task4-2">
                <label for="task4-2">–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</label>
            </div>

            <div class="checkbox-item">
                <input type="checkbox" id="task4-3">
                <label for="task4-3">–†–æ–ª–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã</label>
            </div>
        </div>

        <div class="section">
            <h2>üóëÔ∏è –ó–∞–¥–∞–Ω–∏–µ 5. –î–æ–±–∞–≤—å—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h2>

            <p>DELETE /students/{student_id} - —Ç–æ–ª—å–∫–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å –ø–æ–º–æ—â—å—é oauth2 admin –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>

            <div class="code-block"><span class="comment"># app.py</span>
<span class="decorator">@router.delete</span>(<span class="string">"/students/{student_id}"</span>)
<span class="keyword">def</span> <span class="function">delete_student</span>(
    ...
):
   ...

<span class="comment"># service.py</span>

<span class="keyword">def</span> <span class="function">delete</span>(<span class="keyword">self</span>, student_id: <span class="class">int</span>):
    student = ...
    ...
    <span class="keyword">return</span> {<span class="string">"message"</span>: <span class="string">f"Student {student.name} deleted"</span>}</div>

            <h3>–†–µ—à–µ–Ω–∏–µ:</h3>
            <div class="form-group">
                <textarea class="code-textarea"></textarea>
            </div>

            <div class="checkbox-item">
                <input type="checkbox" id="task5-1">
                <label for="task5-1">–≠–Ω–¥–ø–æ–∏–Ω—Ç —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω</label>
            </div>

            <div class="checkbox-item">
                <input type="checkbox" id="task5-2">
                <label for="task5-2">–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è admin –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</label>
            </div>

            <div class="checkbox-item">
                <input type="checkbox" id="task5-3">
                <label for="task5-3">–£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ</label>
            </div>
        </div>

        <div class="section">
            <h2>üìä –í—ã–≤–æ–¥—ã –ø–æ –∑–∞–Ω—è—Ç–∏—é</h2>

            <div class="form-group">
                <label>–ù–∞ –¥–∞–Ω–Ω–æ–º –∑–∞–Ω—è—Ç–∏–∏ –º—ã –∏–∑—É—á–∏–ª–∏:</label>
                <textarea rows="3">–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã...</textarea>
            </div>

            <div class="form-group">
                <label>–ß—Ç–æ –Ω–æ–≤–æ–≥–æ —É–∑–Ω–∞–ª(–∞):</label>
                <textarea rows="3">–û–ø–∏—à–∏—Ç–µ –Ω–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è...</textarea>
            </div>

            <div class="form-group">
                <label>–ß—Ç–æ –±—ã–ª–æ —Ç—Ä—É–¥–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è:</label>
                <textarea rows="3">–û–ø–∏—à–∏—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏...</textarea>
            </div>
        </div>

        <button class="save-btn" onclick="saveToPDF()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PDF</button>
    </div>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
        function loadFromStorage() {
            document.getElementById('student-name').value = localStorage.getItem('student-name') || '';
            document.getElementById('group').value = localStorage.getItem('group') || '';
            document.getElementById('date').value = localStorage.getItem('date') || new Date().toISOString().split('T')[0];
            
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                if (localStorage.getItem(checkbox.id) === 'true') checkbox.checked = true;
            });
            
            document.querySelectorAll('textarea').forEach((textarea, index) => {
                const saved = localStorage.getItem('textarea-' + index);
                if (saved) textarea.value = saved;
            });
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ localStorage
        function saveToStorage() {
            localStorage.setItem('student-name', document.getElementById('student-name').value);
            localStorage.setItem('group', document.getElementById('group').value);
            localStorage.setItem('date', document.getElementById('date').value);
            
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                localStorage.setItem(checkbox.id, checkbox.checked);
            });
            
            document.querySelectorAll('textarea').forEach((textarea, index) => {
                localStorage.setItem('textarea-' + index, textarea.value);
            });
        }
        
        loadFromStorage();

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        function highlightPython(code) {
            let result = code
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
            
            result = result.replace(/(#.*$)/gm, '###COMMENT###$1###/COMMENT###');
            result = result.replace(/(['\"`])((?:\\.|(?!\1)[^\\\r\n])*?)\1/g, '###STRING###$&###/STRING###');
            result = result.replace(/@[\w.]+/g, '###DECORATOR###$&###/DECORATOR###');
            result = result.replace(/\b(from|import|def|class|return|if|else|elif|for|while|try|except|finally|with|as|and|or|not|in|is|True|False|None|async|await|raise)\b/g, '###KEYWORD###$1###/KEYWORD###');
            result = result.replace(/\b(\d+)\b/g, '###NUMBER###$1###/NUMBER###');
            result = result.replace(/([+\-*=<>!&|%^~])/g, '###OPERATOR###$1###/OPERATOR###');
            result = result.replace(/\b(FastAPI|Header|Body|Response|Query|Path|BaseModel|Field|Student|Course|EmailStr|Optional|int|str|float|list|dict|HTTPException|Depends|APIRouter|SessionLocal|Column|Integer|String|JSON|ForeignKey|relationship|declarative_base|create_engine|sessionmaker|HTTPBasic|HTTPBasicCredentials|HTTPBearer|OAuth2PasswordBearer|OAuth2PasswordRequestForm|Role|Enum|Session|Exception)\b/g, '###CLASS###$1###/CLASS###');
            result = result.replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)(?=\s*\()/g, '###FUNCTION###$1###/FUNCTION###');
            
            result = result.replace(/###COMMENT###/g, '<span class="comment">');
            result = result.replace(/###\/COMMENT###/g, '</span>');
            result = result.replace(/###STRING###/g, '<span class="string">');
            result = result.replace(/###\/STRING###/g, '</span>');
            result = result.replace(/###DECORATOR###/g, '<span class="decorator">');
            result = result.replace(/###\/DECORATOR###/g, '</span>');
            result = result.replace(/###KEYWORD###/g, '<span class="keyword">');
            result = result.replace(/###\/KEYWORD###/g, '</span>');
            result = result.replace(/###CLASS###/g, '<span class="class">');
            result = result.replace(/###\/CLASS###/g, '</span>');
            result = result.replace(/###FUNCTION###/g, '<span class="function">');
            result = result.replace(/###\/FUNCTION###/g, '</span>');
            result = result.replace(/###NUMBER###/g, '<span class="number">');
            result = result.replace(/###\/NUMBER###/g, '</span>');
            result = result.replace(/###OPERATOR###/g, '<span class="operator">');
            result = result.replace(/###\/OPERATOR###/g, '</span>');
            
            return result;
        }

        document.querySelectorAll('.code-textarea').forEach(textarea => {
            const wrapper = document.createElement('div');
            wrapper.style.position = 'relative';
            textarea.parentNode.insertBefore(wrapper, textarea);
            wrapper.appendChild(textarea);

            const preview = document.createElement('div');
            preview.className = 'code-block';
            preview.style.display = 'none';
            preview.style.cursor = 'pointer';
            wrapper.appendChild(preview);

            textarea.addEventListener('input', function() {
                autoResize(this);
                saveToStorage();
            });

            textarea.addEventListener('blur', () => {
                saveToStorage();
                setTimeout(() => {
                    if (textarea.value.trim()) {
                        preview.innerHTML = highlightPython(textarea.value);
                        preview.style.display = 'block';
                        textarea.style.display = 'none';
                    }
                }, 200);
            });

            textarea.addEventListener('paste', () => {
                setTimeout(() => {
                    autoResize(textarea);
                    saveToStorage();
                }, 10);
            });

            preview.addEventListener('click', () => {
                preview.style.display = 'none';
                textarea.style.display = 'block';
                textarea.focus();
            });
            
            if (textarea.value.trim()) {
                preview.innerHTML = highlightPython(textarea.value);
                preview.style.display = 'block';
                textarea.style.display = 'none';
            }

            autoResize(textarea);
        });

        document.querySelectorAll('textarea:not(.code-textarea)').forEach(textarea => {
            textarea.addEventListener('input', function() {
                autoResize(this);
                saveToStorage();
            });
            autoResize(textarea);
        });
        
        document.getElementById('student-name').addEventListener('input', saveToStorage);
        document.getElementById('group').addEventListener('input', saveToStorage);
        document.getElementById('date').addEventListener('change', saveToStorage);
        
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', saveToStorage);
        });

        function saveToPDF() {
            const studentName = document.getElementById('student-name').value || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const group = document.getElementById('group').value || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const date = document.getElementById('date').value || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            
            const originalTitle = document.title;
            document.title = `FastAPI_–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞_–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å_${studentName}_${group}_${date}`;
            
            window.print();
            
            setTimeout(() => {
                document.title = originalTitle;
            }, 1000);
        }
    </script>
</body>
</html>